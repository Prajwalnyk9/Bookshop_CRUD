(function(g){var window=this;'use strict';var i4c=function(B){var z=new g.ba("und",new g.Cj("Default","und",!0));z.captionTracks=B.captionTracks;return z},clq=function(B){return new g.QI(function(z,T){var R=B.length,h=[];
if(R)for(var W=function(q,c){R--;h[q]=c;R==0&&z(h)},b=function(q){T(q)},l,w=0;w<B.length;w++)l=B[w],g.X6Y(l,g.bW(W,w),b);
else z(h)})},kq=function(B){this.T=B},KK=function(){kq.apply(this,arguments)},Lzg=function(){KK.apply(this,arguments)},CQR=function(){KK.apply(this,arguments)},rlP=function(){KK.apply(this,arguments)},o5p=function(){KK.apply(this,arguments)},FzF=function(){KK.apply(this,arguments)},IJc=function(){KK.apply(this,arguments)},Gac=function(){kq.apply(this,arguments)},dFq=function(){KK.apply(this,arguments)},Al7=function(){KK.apply(this,arguments)},aJp=function(){KK.apply(this,arguments)},UF5=function(){KK.apply(this,
arguments)},Mw5=function(){KK.apply(this,arguments)},Vwh=function(){KK.apply(this,arguments)},Q0K=function(){KK.apply(this,arguments)},ylI=function(){KK.apply(this,arguments)},g55=function(){KK.apply(this,arguments)},JlR=function(){KK.apply(this,arguments)},pQq=function(){KK.apply(this,arguments)},$FP=function(){KK.apply(this,arguments)},PQF=function(){kq.apply(this,arguments)},xFW=function(){KK.apply(this,arguments)},v5g=function(){KK.apply(this,arguments)},DFW=function(){KK.apply(this,arguments)},
kaI=function(){KK.apply(this,arguments)},KzR=function(){KK.apply(this,arguments)},mFF=function(){KK.apply(this,arguments)},n5q=function(){KK.apply(this,arguments)},ud7=function(){KK.apply(this,arguments)},H4s=function(){KK.apply(this,arguments)},fJc=function(){kq.apply(this,arguments)},O4R=function(){kq.apply(this,arguments)},NsU=function(){kq.apply(this,arguments)},twh=function(){KK.apply(this,arguments)},j0W=function(){KK.apply(this,arguments)},XQW=function(){KK.apply(this,arguments)},Z4W=function(){KK.apply(this,
arguments)},eH5=function(){KK.apply(this,arguments)},s0F=function(){KK.apply(this,arguments)},E5c=function(){KK.apply(this,arguments)},SoK=function(){KK.apply(this,arguments)},Bb5=function(){KK.apply(this,arguments)},z6p=function(){KK.apply(this,arguments)},Tbg=function(){KK.apply(this,arguments)},R6W=function(){KK.apply(this,arguments)},h6W=function(){KK.apply(this,arguments)},Wr5=function(){KK.apply(this,arguments)},b8U=function(){KK.apply(this,arguments)},Y3R=function(){KK.apply(this,arguments)},
l4q=function(){KK.apply(this,arguments)},w5K=function(){KK.apply(this,arguments)},q37=function(){KK.apply(this,arguments)},i8c=function(){KK.apply(this,arguments)},cBg=function(){KK.apply(this,arguments)},LrF=function(){KK.apply(this,arguments)},CjP=function(){KK.apply(this,arguments)},rBF=function(){KK.apply(this,arguments)},oy5=function(){KK.apply(this,arguments)},Frh=function(){KK.apply(this,arguments)},I4K=function(){kq.apply(this,arguments)},GTK=function(){KK.apply(this,arguments)},dHq=function(){KK.apply(this,
arguments)},ABU=function(){KK.apply(this,arguments)},a4q=function(){KK.apply(this,arguments)},UHh=function(){KK.apply(this,arguments)},MYh=function(){KK.apply(this,arguments)},VYW=function(){KK.apply(this,arguments)},QNR=function(){KK.apply(this,arguments)},yBq=function(){KK.apply(this,arguments)},gyF=function(){KK.apply(this,arguments)},JBs=function(){KK.apply(this,arguments)},p5p=function(){KK.apply(this,arguments)},$Hs=function(){KK.apply(this,arguments)},Pjc=function(){KK.apply(this,arguments)},
xHh=function(){KK.apply(this,arguments)},vyh=function(){KK.apply(this,arguments)},DHs=function(){KK.apply(this,arguments)},kTU=function(){KK.apply(this,arguments)},KrU=function(){KK.apply(this,arguments)},mHF=function(){KK.apply(this,arguments)},nyp=function(){KK.apply(this,arguments)},u3W=function(){KK.apply(this,arguments)},H8F=function(){KK.apply(this,arguments)},f4P=function(){KK.apply(this,arguments)},O8h=function(){KK.apply(this,arguments)},NbU=function(){KK.apply(this,arguments)},tYI=function(){KK.apply(this,
arguments)},jNq=function(){KK.apply(this,arguments)},X55=function(){KK.apply(this,arguments)},Z8F=function(){KK.apply(this,arguments)},e6g=function(){KK.apply(this,arguments)},sN7=function(){KK.apply(this,arguments)},EyP=function(B){B=B.key||B.id;
if(!B)throw Error("Entity key is missing");return B},S3F=function(){if(mD)return mD();
var B={};mD=g.zm("PersistentEntityStoreDb",{DG:(B.EntityStore={mU:1},B.EntityAssociationStore={mU:2},B),shared:!1,upgrade:function(z,T){T(1)&&g.ki(g.p1(z,"EntityStore",{keyPath:"key"}),"entityType","entityType");T(2)&&(z=g.p1(z,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.ki(z,"byParentEntityKey","parentEntityKey"),g.ki(z,"byChildEntityKey","childEntityKey"))},
version:3});return mD()},BWq=function(B){return g.Nw(S3F(),B)},ztW=function(B){return g.Nw((0,g.nIc)(),B)},nK=function(B){this.token=B},u4=function(B,z){z=z===void 0?{}:z;
g.Z_.call(this,g.u8U[B],Object.assign({},{name:"PESEncoderError",type:B},z));this.type=B;this.level="WARNING";Object.setPrototypeOf(this,u4.prototype)},TWP=function(B){return new u4("WRONG_DATA_TYPE",{qv:B})},Rt5=function(B){return B instanceof Error?new u4("UNKNOWN_ENCODE_ERROR",{originalMessage:B.message}):new u4("UNKNOWN_ENCODE_ERROR")},htI=function(B){return B instanceof Error?new u4("UNKNOWN_DECODE_ERROR",{originalMessage:B.message}):new u4("UNKNOWN_DECODE_ERROR")},WWF=function(B,z){B=B instanceof
u4?B:z(B);
g.kV(B);throw B;},bhF=function(){},Ynh=function(B,z,T){try{return B.Y(z,T)}catch(R){WWF(R,Rt5)}},lEU=function(B){B=(new TextEncoder).encode(B).subarray(0,16);
var z=new Uint8Array(16);z.set(B);return z},H_=function(B){this.T=B},qnI=function(B){var z=w0U[B];
if(z)return z;g.KV(new g.Z_("Entity model not found.",{entityType:B}))},ihR=function(B,z){this.T=B;
this.U=z;this.Y={}},LWP=function(B,z){a:{B=cRU(B.U,z.version);
try{var T=B.U(z.data,z.key);break a}catch(R){WWF(R,htI)}T=void 0}return T},fK=function(B,z,T){return B.T.objectStore("EntityStore").get(z).then(function(R){if(R){if(T&&R.entityType!==T)throw Error("Incorrect entity type");
return LWP(B,R)}})},Oi=function(B,z,T){return T?(T=T.map(function(R){return fK(B,R,z)}),g.VD.all(T)):B.T.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(z)).then(function(R){return R.map(function(h){return LWP(B,h)})})},t6=function(B,z,T){var R=EyP(z),h=cRU(B.U,1),W=Object.assign({},z);
return B.T.objectStore("EntityStore").get(R).then(function(b){if(b){if(b.entityType!==T)throw Error("Incorrect entity type");W.entityMetadata||(b=LWP(B,b),W.entityMetadata=b.entityMetadata)}}).then(function(){var b={key:R,
entityType:T,data:Ynh(h,W,R),version:1};return g.VD.all([g.xi(B.T.objectStore("EntityStore"),b),Cc5(B,W,T)])}).then(function(){Ns(B,R,T);
return R})},rRI=function(B,z,T){z=z.map(function(R){return t6(B,R,T)});
return g.VD.all(z)},j7=function(B,z,T){if(T==null?0:T.Xx){var R=new Set;
return ots(B,z,R).then(function(){for(var W=[],b=g.d(R),l=b.next();!l.done;l=b.next())W.push(j7(B,l.value));return g.VD.all(W).then(function(){})})}var h=g.qq(z).entityType;
return g.VD.all([B.T.objectStore("EntityStore").delete(z),FW7(B,z)]).then(function(){Ns(B,z,h)})},IEh=function(B,z){return g.up(B.T.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(z)},function(T){return g.VD.all([T.delete(),
FW7(B,T.cursor.primaryKey)]).then(function(){Ns(B,T.cursor.primaryKey,z);return g.m1(T)})})},GSp=function(B,z,T,R){var h=cRU(B.U,1);
return fK(B,z,R).then(function(W){if(W){W=g.dI(W,T);var b={key:z,entityType:R,data:Ynh(h,W,z),version:1};return g.VD.all([g.xi(B.T.objectStore("EntityStore"),b),Cc5(B,W,R)])}}).then(function(){Ns(B,z,R);
return z})},Ns=function(B,z,T){var R=B.Y[T];
R||(R=new Set,B.Y[T]=R);R.add(z)},dWh=function(B,z,T){var R=EyP(z);
T=qnI(T);if(!T)return g.VD.resolve([]);T=new T(z);B=B.T.objectStore("EntityAssociationStore");z=[];T=g.d(T.U());for(var h=T.next();!h.done;h=T.next())z.push(g.xi(B,{parentEntityKey:R,childEntityKey:h.value}));return g.VD.all(z).then(function(W){return W.map(function(b){return b[1]})})},FW7=function(B,z){return B.T.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(z))},Cc5=function(B,z,T){var R=EyP(z);
return FW7(B,R).then(function(){return dWh(B,z,T)})},ots=function(B,z,T){if(T.has(z))return g.VD.resolve(void 0);
T.add(z);return ARh(B,z).then(function(R){return B.T.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(z)).then(function(){return R})}).then(function(R){var h=g.VD.resolve(void 0);
R=g.d(R);for(var W=R.next(),b={};!W.done;b={mG:void 0},W=R.next())b.mG=W.value,h=h.then(function(l){return function(){return ots(B,l.mG,T)}}(b));
return h}).then(function(){})},ARh=function(B,z){var T=B.T.objectStore("EntityAssociationStore");
return T.index("byParentEntityKey").getAll(IDBKeyRange.only(z)).then(function(R){var h=[];R=g.d(R);for(var W=R.next();!W.done;W=R.next())W=W.value,h.push(T.index("byChildEntityKey").getAll(W.childEntityKey));return g.VD.all(h)}).then(function(R){var h=[];
R=g.d(R);for(var W=R.next();!W.done;W=R.next())W=W.value,W.length===1&&h.push(W[0].childEntityKey);return h})},XG=function(){},aEp=function(){this.T={};
this.T[0]=new XG;if(!g.ac("aes_pes_encoder_killswitch")){var B=this.T;try{var z=g.eT();var T=lEU(z);var R=new H_(new g.Q5(T),new g.V5(T))}catch(h){throw B=h instanceof Error?new u4("KEY_CREATION_FAILED",{originalMessage:h.message}):new u4("KEY_CREATION_FAILED"),g.kV(B),B;}B[1]=R}},cRU=function(B,z){z=z===void 0?0:z;
B=B.T[z];if(!B)throw z=new u4("INVALID_ENCODER_VERSION",{qv:z}),g.kV(z),z;return B},ZB=function(B,z){g.K.call(this);
this.token=B;this.T=z;this.observers=[];B=new g.XK.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.eT());B.onmessage=this.U.bind(this);this.channel=B},e7=function(B,z,T){var R,h,W,b;
return g.D(function(l){if(l.U==1)return g.P(l,BWq(B.token),2);if(l.U!=3)return R=l.T,g.P(l,g.P4(R,["EntityStore","EntityAssociationStore"],z,function(w){h=new ihR(w,B.T);return T(h)}),3);
W=l.T;h&&(b=h.Y,Object.keys(b).length>0&&(B.channel.postMessage(b),UW5(B,b)));return l.return(W)})},si=function(B,z,T){return e7(B,{mode:"readwrite",
cB:!0},function(R){return t6(R,z,T)})},MNg=function(B,z){return e7(B,{mode:"readwrite",
cB:!0},function(T){return rRI(T,z,"offlineOrchestrationActionWrapperEntity")})},VN7=function(B,z){return e7(B,{mode:"readwrite",
cB:!0},function(T){return j7(T,z)})},Q9U=function(B){return e7(B,{mode:"readwrite",
cB:!0},function(z){return IEh(z,"videoPlaybackPositionEntity")})},Ei=function(B,z,T){return e7(B,{mode:"readonly",
cB:!0},function(R){return fK(R,z,T)})},S7=function(B,z,T){return e7(B,{mode:"readonly",
cB:!0},function(R){return Oi(R,z,T)})},UW5=function(B,z){B=g.d(B.observers);
for(var T=B.next();!T.done;T=B.next())T=T.value,T(z)},yRF=function(){var B,z,T;
return g.D(function(R){if(R.U==1)return g.AK(R,2),g.P(R,g.Sd(),4);if(R.U!=2){B=R.T;if(!B||!g.sW()||typeof g.XK.BroadcastChannel==="undefined")return R.return();z=new aEp;return R.return(new ZB(B,z))}T=g.JK(R);T instanceof Error&&g.kV(T);return R.return()})},B9=function(){gtq||(gtq=yRF());
return gtq},JRF=function(B){var z;
B=(z=B.options)==null?void 0:z.persistenceOption;return B==="ENTITY_PERSISTENCE_OPTION_PERSIST"||B==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},p0U=function(B){var z;
return g.D(function(T){return T.U==1?g.P(T,B9(),2):(z=T.T)?g.P(T,e7(z,"readwrite",function(R){for(var h={},W=g.d(B),b=W.next(),l={};!b.done;l={Kk:void 0,Nz:void 0},b=W.next())l.Kk=b.value,l.Kk.entityKey&&JRF(l.Kk)&&(l.Nz=g.Ng(l.Kk.payload),b=void 0,l.Kk.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(b=function(w){return function(){return t6(R,w.Kk.payload[w.Nz],w.Nz)}}(l)),l.Kk.type==="ENTITY_MUTATION_TYPE_DELETE"&&(b=function(w){return function(){return j7(R,w.Kk.entityKey)}}(l)),l.Kk.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(b=function(w){return function(){return GSp(R,w.Kk.entityKey,w.Kk.payload[w.Nz],w.Nz)}}(l)),b&&(h[l.Kk.entityKey]=h[l.Kk.entityKey]?h[l.Kk.entityKey].then(b):b()));
return g.VD.all(Object.values(h))}),0):T.return()})},$WF=function(B){var z;
return g.D(function(T){if(T.U==1){z=B.mutations;if(!z||z.length<=0)return T.return();if(g.zG){var R={type:"ENTITY_LOADED"};z!==void 0&&(R.payload=z);g.zG.dispatch(R)}return g.P(T,p0U(z),2)}z.length=0;g.dX(T)})},PcF=function(B){return B!==void 0},xWg=function(B){var z=g.Jb();
z=Object.assign({},z);B=Object.assign({},B);for(var T in z)B[T]?(z[T]!==4&&(z[T]=B[T]),delete B[T]):z[T]!==2&&(z[T]=4);Object.assign(z,B);g.rMz(z);JSON.stringify(z);return z},vtR=function(B){var z,T;
return g.D(function(R){if(R.U==1)return g.P(R,g.Sd(),2);if(R.U!=3)return(z=R.T)?g.P(R,g.P3(z),3):R.return();T=R.T;return R.return(g.P4(T,["index","media","captions"],{mode:"readwrite",cB:!0},function(h){var W=IDBKeyRange.bound(B+"|",B+"~");h=[h.objectStore("index").delete(W),h.objectStore("media").delete(W),h.objectStore("captions").delete(W)];return g.VD.all(h).then(function(){})}))})},DWU=function(){var B,z;
return g.D(function(T){if(T.U==1)return g.P(T,g.Sd(),2);if(T.U!=3){B=T.T;if(!B)throw g.Uj("rvdfd");return g.P(T,g.P3(B),3)}z=T.T;return T.return(g.P4(z,["index","media"],{mode:"readwrite",cB:!0},function(R){var h={};return g.K1(R.objectStore("index"),{},function(W){var b=W.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),l=g.VD.resolve(void 0);if(b){var w=b[1];b=b[2];h[w]=h[w]||{};var q;h[w][b]=g.dQb((q=W.getValue())==null?void 0:q.fmts)}else l=W.delete().then(function(){});
return g.VD.all([g.m1(W),l]).then(function(c){return g.d(c).next().value})}).then(function(){for(var W={},b=g.d(Object.keys(h)),l=b.next();!l.done;l=b.next()){l=l.value;
var w=h[l].v;W[l]=h[l].a&&w?1:2}var q=xWg(W);return g.pib(R.objectStore("media"),{},function(c){var L=c.cursor.key.match(g.MfB);L&&W[L[1]]||R.objectStore("media").delete(c.cursor.key);return g.Anz(c)}).then(function(){return q})})}))})},kSq=function(B,z){var T,R;
return g.D(function(h){if(h.U==1)return g.P(h,g.Sd(),2);if(h.U!=3){T=h.T;if(!T)throw g.Uj("wct");return g.P(h,g.P3(T),3)}R=h.T;return g.P(h,g.P4(R,["captions"],{mode:"readwrite",cB:!0},function(W){var b=[];W=W.objectStore("captions");for(var l=0;l<z.length;l++){var w=g.xi(W,z[l],B+"|"+z[l].metadata.vss_id);b.push(w)}return g.VD.all(b)}),0)})},KWc=function(B){var z,T,R;
return g.D(function(h){if(h.U==1)return z=IDBKeyRange.bound(B+"|",B+"~"),g.P(h,g.Sd(),2);if(h.U!=3){T=h.T;if(!T)throw g.Uj("gactfv");return g.P(h,g.P3(T),3)}R=h.T;return h.return(R.getAll("captions",z))})},mWq=function(B){return g.D(function(z){g.$O(B,0);
return z.return(vtR(B))})},ntP=function(B){return{context:g.cS(),
videoIds:B}},uwh=function(B){return{context:g.cS(),
playlistIds:B}},Hhp=function(B){return{context:g.cS(),
offlinePlaylistSyncChecks:B}},fEK=function(){this.T=new Map},NW5=function(){OhF||(OhF=new fEK);
return OhF},tNq=function(B,z){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:B},metadata:z,statusCode:void 0,csn:void 0,can:void 0}},j9R=function(B,z,T){if(!T){var R=R===void 0?!1:R;
T=B.T.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!T||R)T=g.V6(16),B.T.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",T)}B={flowNonce:T,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:z.eventType};z.metadata&&(B.flowMetadata=z.metadata);z.statusCode!==void 0&&(B.flowEventStatus=z.statusCode);z.csn&&(B.csn=z.csn);z.can&&(B.can=z.can);g.ip("flowEvent",B,void 0)},X0s=function(B){var z,T,R,h,W,b,l,w,q,c,L,C,r,F,A,a,V,M,x,v,n,Z,N,TP,hK,zP,ld,t,UH,Qz,vb,AI,lW,gX,Vz,hI,U,Yr,tI,Av;
return g.D(function(gF){if(gF.U==1)return g.P(gF,e7(B,{mode:"readonly",cB:!0},function(rF){return Oi(rF,"playbackData").then(function(mB){var v7=mB.map(function(p){return p.transfer}).filter(function(p){return!!p}),JI=mB.map(function(p){return p.offlineVideoPolicy}).filter(function(p){return!!p}),y=mB.filter(function(p){return!!p.key}).map(function(p){return g.iZ(g.qq(p.key).entityId,"downloadStatusEntity")});
v7=Oi(rF,"transfer",v7);JI=Oi(rF,"offlineVideoPolicy",JI);y=Oi(rF,"downloadStatusEntity",y);var J=v7.then(function(p){p=p.reduce(function(k,H){(H==null?0:H.offlineVideoStreams)&&k.push.apply(k,g.Q(H.offlineVideoStreams));return k},[]).filter(function(k){return!!k});
return Oi(rF,"offlineVideoStreams",p)});
return g.VD.all([v7,JI,J,y]).then(function(p){var k=g.d(p);p=k.next().value;var H=k.next().value;var az=k.next().value;k=k.next().value;return[mB,p,H,az,k]})})}),2);
if(gF.U!=3)return z=gF.T,g.P(gF,e7(B,{mode:"readonly",cB:!0},function(rF){return Oi(rF,"mainDownloadsListEntity").then(function(mB){var v7,JI;return(JI=(v7=mB[0])==null?void 0:v7.downloads)!=null?JI:[]})}),3);
T=gF.T;R=g.d(z);h=R.next().value;W=R.next().value;b=R.next().value;l=R.next().value;w=R.next().value;q=h;c=W;L=b;C=l;r=w;F={};A={};a={};V={};M={};x=[];v=g.d(c);for(n=v.next();!n.done;n=v.next())(Z=n.value)&&(F[Z.key]=Z);N=g.d(L);for(TP=N.next();!TP.done;TP=N.next())(hK=TP.value)&&(A[hK.key]=hK);zP=g.d(r);for(ld=zP.next();!ld.done;ld=zP.next())(t=ld.value)&&(a[t.key]=t);UH=g.d(C);for(Qz=UH.next();!Qz.done;Qz=UH.next())(vb=Qz.value)&&(V[vb.key]=vb);AI=g.d(T);for(lW=AI.next();!lW.done;lW=AI.next())gX=
lW.value,Vz=void 0,M[(Vz=gX.videoItem)!=null?Vz:""]=!0,gX.videoItem&&(U=hI=void 0,Yr=(U=(hI=g.qq(gX.videoItem))==null?void 0:hI.entityId)!=null?U:"",x.push({externalVideoId:Yr}));tI=q.filter(function(rF){if(!rF||!rF.key||!rF.offlineVideoPolicy)return!1;rF=g.qq(rF.key).entityId;rF=g.iZ(rF,"downloadStatusEntity");var mB;return!(rF&&((mB=a[rF])==null?void 0:mB.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
Av=tI.map(function(rF){var mB=F[rF.transfer],v7=[];if(mB==null?0:mB.offlineVideoStreams)for(var JI=g.d(mB.offlineVideoStreams),y=JI.next();!y.done;y=JI.next())(y=V[y.value])&&v7.push(y);JI=A[rF.offlineVideoPolicy];y=M;var J=rF==null?void 0:rF.playerResponseTimestamp,p=g.qq(JI.key).entityId;rF=g.iZ(p,"mainVideoEntity");if(JI.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var k="OFFLINE_VIDEO_STATE_DISABLED";JI.expirationTimestamp&&Number(JI.expirationTimestamp)<Date.now()/1E3&&(k="OFFLINE_VIDEO_STATE_EXPIRED")}else if(JI.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")k="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(mB==null?void 0:mB.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":k="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":k="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":k="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":k="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":k="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":k="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:k="OFFLINE_VIDEO_STATE_UNKNOWN"}if(k==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(mB==null?void 0:mB.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":k="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":k="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":k=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}p={id:p,videoState:k};if(mB==null?0:mB.cotn)p.cotn=mB.cotn;if(mB==null?0:mB.maximumDownloadQuality)p.selectedVideoQuality=mB==null?void 0:mB.maximumDownloadQuality;if(mB==null?0:mB.lastProgressTimeMs)p.lastProgressTimeMs=mB.lastProgressTimeMs;J&&(p.playerResponseSavedTimeMs=String(Number(J)*1E3));mB=String;J=0;v7=g.d(v7);for(k=v7.next();!k.done;k=v7.next())if(k=k.value,k.streamsProgress){k=g.d(k.streamsProgress);for(var H=k.next();!H.done;H=k.next()){var az=void 0;
J+=Number((az=H.value.numBytesDownloaded)!=null?az:0)}}p.downloadedBytes=mB(J);p.selectedOfflineMode=y[rF]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";JI.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(p.offlinePlaybackDisabledReason=JI.offlinePlaybackDisabledReason);return p});
return gF.return({offlineVideos:Av,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:x}}})})},Zhs=function(){this.locks=navigator.locks},etP=function(){try{var B=g.sH("ytglobal.locks_");
if(B)return B;var z;if(z=navigator){var T=navigator;z="locks"in T&&!!T.locks}if(z)return g.XK.localStorage&&g.XK.localStorage.getItem("noop"),B=new Zhs,g.Zz("ytglobal.locks_",B),B}catch(R){}},z6=function(){},s9R=function(){},Etq=function(B){if(B.includes(":"))throw Error("Invalid user cache name: "+B);
return B+":"+g.eT("CacheStorage get")},Snq=function(){return g.D(function(B){if(T6!==void 0)return B.return(T6);
T6=new Promise(function(z){var T;return g.D(function(R){switch(R.U){case 1:return g.AK(R,2),g.P(R,RO.open("test-only"),4);case 4:return g.P(R,RO.delete("test-only"),5);case 5:g.yz(R,3);break;case 2:if(T=g.JK(R),T instanceof Error&&T.name==="SecurityError")return z(!1),R.return();case 3:z("caches"in window),g.dX(R)}})});
return B.return(T6)})},zMP=function(){return g.D(function(B){if(B.U==1)return g.P(B,Snq(),2);
if(!B.T)return B.return(void 0);BUF||(BUF=new s9R);return B.return(BUF)})},hP=function(B,z,T){g.KV(new g.Z_("Woffle: "+B,T?{cotn:T}:""));
z instanceof Error&&g.KV(z)},TUc=function(B){var z;
return g.D(function(T){if(T.U==1)return g.P(T,X0s(B),2);z=T.T;g.ip("offlineStateSnapshot",z);g.dX(T)})},W9=function(B){g.K.call(this);
var z=this;this.api=B;this.Yi={hKF:function(){return z.T},
lzZ:function(){return z.U}};
typeof g.XK.BroadcastChannel!=="undefined"&&(this.T=new g.XK.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.eT()),this.T.onmessage=this.Y.bind(this),this.U=new g.XK.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.eT()),this.U.onmessage=this.W.bind(this))},bV=function(B,z){B.api.uO("onOfflineOperationFailure",z);
var T;(T=B.T)==null||T.postMessage(z)},RMU=function(B,z,T,R){var h=this;
this.J=B;this.N=z;this.visibility=T;this.D=R;this.V=this.L=this.X=this.Y=this.T=!1;this.W=new g.Si(function(){h.Us()});
this.Yi={IY:function(){return h.U},
Us:function(){h.Us()},
yRJ:function(){return h.W}};
this.visibility.subscribe("visibilitystatechange",function(){h.UJ()})},hMg=function(B){if(!B.Y&&!B.T){var z=etP();
if(z){B.Y=!0;var T=g.eT("OfflineLockManager");z.request("woffle_orchestration_leader:"+T,{},function(){var R,h,W,b;return g.D(function(l){switch(l.U){case 1:return g.AK(l,2),B.U=new g.CP,B.T=!0,B.Y=!1,g.P(l,B.J(),4);case 4:return g.P(l,B.U.promise,5);case 5:g.yz(l,0);break;case 2:R=g.JK(l),((W=(h=B).D)==null?0:W.call(h,"wo_relinquish_leadership_on_lock_request_error"))||B.Us(),R instanceof Error&&(b=R,b.args=[{name:"WoLockManagerError",L9:R.name}],g.kV(b)),g.dX(l)}})})}}},WgP=function(B){B.T&&(B.V=
!0,YG(B))},bPK=function(B,z){B.T&&(B.X=z,YG(B))},Y7g=function(B,z){B.T&&(B.L=z,YG(B))},YG=function(B){B.L&&B.X&&B.V&&B.visibility.isBackground()?g.Bi(B.W,6E4):B.W.stop()},lV=function(B){var z;
B.offlineDeleteReason=(z=B.offlineDeleteReason)!=null?z:"OFFLINE_DELETE_REASON_UNKNOWN";var T;B.offlineModeType=(T=B.offlineModeType)!=null?T:"OFFLINE_NOW";g.ip("offlineDeleteEvent",B)},wE=function(B,z){var T=z.videoId;
var R=z.gI;z=z.offlineModeType;B.encryptedVideoId=T;B.cotn=R==null?void 0:R.cotn;B.offlineabilityFormatType=R==null?void 0:R.maximumDownloadQuality;var h;B.isRefresh=(h=R==null?void 0:R.isRefresh)!=null?h:!1;var W;B.softErrorCount=(W=R==null?void 0:R.transferRetryCount)!=null?W:0;B.offlineModeType=z!=null?z:"OFFLINE_NOW";(B.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&B.statusType==="UNKNOWN_STATUS_TYPE"||!B.transferStatusType&&!B.statusType)&&g.KV(Error("Woffle unknown transfer status"));
g.ip("offlineTransferStatusChanged",B)},lcF=function(B){wE({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},B)},w1K=function(B,z,T,R){R={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!R};z&&T&&(z=Math.floor(z/1024).toFixed(),T=Math.floor(T/1024).toFixed(),R.alreadyDownloadedKbytes=z,R.totalFetchedKbytes=z,R.totalContentKbytes=T);wE(R,B)},q7U=function(B){wE({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},B)},iPK=function(B){wE({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},B)},cGh=function(B){switch(B){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
qA=function(B){var z,T,R;
return((R=(z=B.actionMetadata)==null?void 0:(T=z.retryScheduleIntervalsInSeconds)==null?void 0:T.length)!=null?R:0)>0},iV=function(B){return B.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!B.entityKey},c9=function(B){return B.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!B.entityKey},Lc=function(B){return B.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!B.entityKey},Lgp=function(B){return B.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!B.entityKey},
Cc=function(B,z,T,R,h){h=h===void 0?!1:h;
var W,b,l,w,q,c;return g.D(function(L){if(L.U==1)return W=g.iZ(B,z),b=g.iZ(B,"downloadStatusEntity"),g.P(L,e7(T,{mode:"readonly",cB:!0},function(C){return g.VD.all([fK(C,W,z),fK(C,b,"downloadStatusEntity")])}),2);
l=L.T;w=l.length?l[0]:void 0;if(!w)return L.jI(0);q=C8U;if(c=l.length>1?l[1]:void 0){if(c.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!h)return L.return();c.downloadState=R}else c={key:b,downloadState:R};g.YZ(w,q,c);return g.P(L,e7(T,{mode:"readwrite",cB:!0},function(C){return g.VD.all([t6(C,w,z),t6(C,c,"downloadStatusEntity")])}),0)})},rE=function(B,z){return B.actionType===z.actionType&&B.entityKey===z.entityKey},oO=function(B,z){if(B&&B.transferState!=="TRANSFER_STATE_COMPLETE"&&B.transferState!==
"TRANSFER_STATE_FAILED"){var T=g.qq(B.key).entityId;
wE({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:T,gI:B,offlineModeType:z})}},Fg=function(B){if(!B||!B.thumbnails)return[];
var z=[];B=g.d(B.thumbnails);for(var T=B.next();!T.done;T=B.next())T=T.value,T.url&&z.push(T.url);return z},rGP=function(B,z,T){T=T===void 0?[]:T;
var R,h,W,b,l,w,q,c,L,C,r,F,A;return g.D(function(a){if(a.U==1)return T.length?g.P(a,S7(B,z),2):a.return([]);R=a.T;h=new Set;W=g.d(R);for(b=W.next();!b.done;b=W.next())if(l=b.value,w=l.id||l.key)q=g.qq(w).entityId,h.add(q);c=[];L=g.d(T);for(C=L.next();!C.done;C=L.next())r=C.value,F=r.offlineVideoData,A=void 0,((A=F)==null?0:A.videoId)&&!h.has(F.videoId)&&c.push(r);return a.return(c)})},oas=function(B,z,T){return new g.NT(B,{cotn:z,
raw_player_response:T,download_media:!0,start:Infinity,disable_watch_next:!0})},FgU=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},IO=function(B,z,T,R,h,W,b,l,w,q,c){this.entityType=B;
this.actionId=z;this.action=T;this.parentActionId=R;this.rootActionId=h===void 0?z:h;this.childActionIds=W;this.prereqActionId=b;this.postreqActionIds=l;this.hasChildActionFailed=q;this.retryScheduleIndex=0;this.T=c||Date.now();this.retryScheduleIndex=w||0},G6=function(B){if(!B.key)throw Error("Entity key is required.");
if(!B.actionProto)throw Error("OfflineOrchestrationAction is required.");var z=g.qq(B.key),T=g.qq(B.actionProto.entityKey);return new IO(T.entityType,z.entityId,B.actionProto,B.parentActionId,B.rootActionId,B.childActionIds,B.prereqActionId,B.postreqActionIds,B.retryScheduleIndex,B.hasChildActionFailed,Number(B.enqueueTimeSec)*1E3)},dE=function(B){return{key:g.iZ(B.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:B.action,parentActionId:B.parentActionId,rootActionId:B.rootActionId,childActionIds:B.childActionIds,prereqActionId:B.prereqActionId,postreqActionIds:B.postreqActionIds,retryScheduleIndex:B.retryScheduleIndex,hasChildActionFailed:B.hasChildActionFailed,enqueueTimeSec:(B.T/1E3).toFixed()}},IcI=function(){var B;
return g.D(function(z){return z.U==1?g.P(z,zMP(),2):(B=z.T)?z.return(B.delete("yt-player-local-img")):z.return(!0)})},AP=function(B){var z,T;
return g.D(function(R){if(R.U==1)return g.P(R,zMP(),2);if(R.U!=3){z=R.T;if(!z)throw Error("Cache API not supported");return B.length?g.P(R,z.open("yt-player-local-img"),3):R.return()}T=R.T;return g.P(R,Promise.all(B.map(function(h){return T.delete(h)})),0)})},aO=function(B){var z,T;
return g.D(function(R){if(R.U==1)return g.P(R,zMP(),2);if(R.U!=3){z=R.T;if(!z)throw Error("Cache API not supported");return B.length?g.P(R,z.open("yt-player-local-img"),3):R.return()}T=R.T;return g.P(R,T.addAll(B),0)})},Um=function(B,z,T,R,h){var W,b,l,w,q,c,L,C,r,F,A,a,V,M,x,v,n,Z,N,TP,hK,zP,ld,t,UH,Qz,vb,AI,lW,gX,Vz;
return g.D(function(hI){switch(hI.U){case 1:return W=g.iZ(B,"mainVideoEntity"),b=g.iZ(B,"ytMainChannelEntity"),l=g.iZ(B,"transfer"),w=g.iZ(B,"videoDownloadContextEntity"),g.P(hI,e7(z,{mode:"readonly",cB:!0},function(U){return g.VD.all([fK(U,W,"mainVideoEntity"),fK(U,b,"ytMainChannelEntity"),fK(U,l,"transfer"),fK(U,w,"videoDownloadContextEntity"),Oi(U,"ytMainChannelEntity"),Oi(U,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:q=hI.T;c=g.d(q);L=c.next().value;C=c.next().value;r=c.next().value;F=c.next().value;A=c.next().value;a=c.next().value;V=L;M=C;x=r;v=F;n=A;Z=a;if(!V&&!M){hI.jI(3);break}N=V?Fg(V.thumbnail):[];if(!M){TP=[];hI.jI(4);break}return g.P(hI,G3R(M,n),5);case 5:TP=hI.T;case 4:return hK=TP,g.P(hI,AP(N.concat(hK)),3);case 3:zP=[];ld=g.iZ(B,"downloadStatusEntity");t=g.d(Z);for(UH=t.next();!UH.done;UH=t.next())Qz=UH.value,vb=g.qq(Qz.key).entityId,AI=G6(Qz),lW=g.qq(AI.action.entityKey).entityId,vb!==B&&lW!==
B||rE(T,Qz.actionProto)||zP.push(Qz.key);return g.P(hI,e7(z,{mode:"readwrite",cB:!0},function(U){var Yr=zP.map(function(tI){return j7(U,tI)});
Yr.push(j7(U,W,{Xx:!0}));Yr.push(j7(U,ld,{Xx:!0}));return g.VD.all(Yr)}),7);
case 7:Vz=(gX=v)==null?void 0:gX.offlineModeType,h&&(lV(h),h.offlineModeType&&(Vz=h.offlineModeType)),oO(x,Vz),bV(R,{entityKey:W,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.dX(hI)}})},acR=function(B,z,T,R){var h,W,b,l,w,q,c,L,C,r,F,A,a,V,M,x,v,n,Z,N,TP,hK,zP,ld,t,UH,Qz,vb,AI,lW,gX,Vz,hI,U,Yr,tI,Av,gF,rF,mB,v7,JI,y,J,p,k,H,az,Bb,Iz;
return g.D(function(Rz){switch(Rz.U){case 1:return h=g.iZ(B,"mainPlaylistEntity"),W=g.iZ(B,"ytMainChannelEntity"),g.P(Rz,e7(z,{mode:"readonly",cB:!0},function(p5){return g.VD.all([fK(p5,h,"mainPlaylistEntity"),fK(p5,W,"ytMainChannelEntity"),Oi(p5,"mainPlaylistEntity"),Oi(p5,"mainDownloadsListEntity"),Oi(p5,"ytMainChannelEntity"),Oi(p5,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:b=Rz.T;l=g.d(b);w=l.next().value;q=l.next().value;c=l.next().value;L=l.next().value;C=l.next().value;r=l.next().value;F=w;A=q;a=c;V=L;M=C;x=r;if(!F&&!A){Rz.jI(3);break}v=F?d8I(F):[];if(!A){n=[];Rz.jI(4);break}return g.P(Rz,G3R(A,M),5);case 5:n=Rz.T;case 4:return Z=n,g.P(Rz,AP(v.concat(Z)),3);case 3:N=[];TP=new Map;if(!F){Rz.jI(7);break}return g.P(Rz,AG5(F,a,V),8);case 8:N=Rz.T;hK=g.d(N);for(zP=hK.next();!zP.done;zP=hK.next())ld=zP.value,TP.set(ld,{videoId:ld,playlistId:B,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.P(Rz,e7(z,{mode:"readonly",cB:!0},function(p5){return g.VD.all([Oi(p5,"transfer"),Oi(p5,"videoDownloadContextEntity")])}),9);
case 9:t=Rz.T;UH=g.d(t);Qz=UH.next().value;vb=UH.next().value;AI=Qz;lW=vb;gX=g.d(AI);for(Vz=gX.next();!Vz.done;Vz=gX.next())hI=Vz.value,U=g.qq(hI.key).entityId,(Yr=TP.get(U))&&hI&&(Yr.cotn=hI.cotn);tI=g.d(lW);for(Av=tI.next();!Av.done;Av=tI.next())gF=Av.value,rF=g.qq(gF.key).entityId,(mB=TP.get(rF))&&gF&&(mB.offlineModeType=gF.offlineModeType);case 7:v7=[];JI=g.d(x);for(y=JI.next();!y.done;y=JI.next())J=y.value,p=g.qq(J.key).entityId,k=G6(J),p!==B&&k.rootActionId!==B||rE(T,J.actionProto)||v7.push(J.key);
H=g.iZ(B,"mainPlaylistEntity");return g.P(Rz,e7(z,{mode:"readwrite",cB:!0},function(p5){var el=v7.map(function(Up){return j7(p5,Up)});
el.push(j7(p5,H,{Xx:!0}));return g.VD.all(el)}),10);
case 10:if(!F){Rz.jI(0);break}N.reverse();if(!N){Rz.jI(0);break}az=g.d(N);Bb=az.next();case 13:if(Bb.done){Rz.jI(0);break}Iz=Bb.value;return g.P(Rz,Um(Iz,z,T,R,TP.get(Iz)),14);case 14:Bb=az.next(),Rz.jI(13)}})},MQp=function(B,z,T,R){var h,W,b,l,w,q,c,L,C;
return g.D(function(r){if(r.U==1)return h=g.iZ("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),W=new Map,g.P(r,e7(B,{mode:"readwrite",cB:!0},function(F){var A=Oi(F,"transfer"),a=Oi(F,"offlineOrchestrationActionWrapperEntity"),V=Oi(F,"videoDownloadContextEntity"),M=fK(F,h,"mainDownloadsListEntity");return g.VD.all([A,a,V,M]).then(function(x){x=g.d(x);var v=x.next().value;var n=x.next().value;var Z=x.next().value;var N=x.next().value;x=U87.map(function(hK){return IEh(F,hK)});
n=g.d(n);for(var TP=n.next();!TP.done;TP=n.next())TP=TP.value,rE(z,TP.actionProto)||x.push(j7(F,TP.key,{Xx:!0}));N&&(N.downloads=[],x.push(t6(F,N,"mainDownloadsListEntity")));if(Z)for(Z=g.d(Z),N=Z.next();!N.done;N=Z.next())N=N.value,n=g.qq(N.key).entityId,n=g.iZ(n,"transfer"),W.set(n,N.offlineModeType);return g.VD.all(x).then(function(){return v})})}),2);
b=r.T;l=g.d(b);for(w=l.next();!w.done;w=l.next())q=w.value,oO(q,W.get(q.key)),c=g.qq(q.key).entityId,L={videoId:c,offlineDeleteReason:R,cotn:q.cotn,offlineModeType:W.get(q.key)},lV(L),C=g.iZ(c,"mainVideoEntity"),bV(T,{entityKey:C,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.P(r,IcI(),0)})},d8I=function(B,z){var T=[];
if(B.thumbnailStyleData){B=g.d(B.thumbnailStyleData);for(var R=B.next();!R.done;R=B.next()){var h=void 0,W=void 0,b=void 0;T=T.concat(Fg((h=R.value)==null?void 0:(W=h.value)==null?void 0:(b=W.collageThumbnail)==null?void 0:b.coverThumbnail))}}z=Fg(z);return T.concat(z)},AG5=function(B,z,T){var R,h,W,b,l,w,q,c,L,C,r,F,A,a,V,M,x,v,n,Z,N,TP,hK;
return g.D(function(zP){R=[];h=new Set;if(T.length)for(W=g.d(T),b=W.next();!b.done;b=W.next())if(l=b.value,w=void 0,(w=l.downloads)==null?0:w.length)for(q=g.d(l.downloads),c=q.next();!c.done;c=q.next())L=c.value,L.videoItem&&(C=g.qq(L.videoItem).entityId,h.add(C));if(B.videos){r=g.d(B.videos);for(F=r.next();!F.done;F=r.next())A=F.value,a=JSON.parse(g.qq(A).entityId),a.videoId&&!h.has(a.videoId)&&R.push(a.videoId);V=g.d(z);for(M=V.next();!M.done;M=V.next())if(x=M.value,x.key!==B.key&&(v=x.videos))for(n=
g.d(v),Z=n.next();!Z.done;Z=n.next())N=Z.value,TP=JSON.parse(g.qq(N).entityId),TP.videoId&&(hK=R.indexOf(TP.videoId),hK!==-1&&R.splice(hK,1))}return zP.return(R)})},G3R=function(B,z){var T,R,h,W,b,l,w,q;
return g.D(function(c){T=Fg(B.avatar);R=g.d(z);for(h=R.next();!h.done;h=R.next())if(W=h.value,W.id!==B.id)for(b=g.d(Fg(W.avatar)),l=b.next();!l.done;l=b.next())w=l.value,q=T.indexOf(w),q!==-1&&T.splice(q,1);return c.return(T)})},VQ7=function(B){var z;
return g.D(function(T){z=g.u(B.frameworkUpdates,MA);return B.frameworkUpdates&&z?g.P(T,$WF(z),0):T.return()})},yGR=function(B){var z;
if((z=B.onResponseReceivedActions)!=null&&z.length){var T;B=(T=g.u(g.u(B.onResponseReceivedActions[0],QsK),g.KdP))==null?void 0:T.actions;if(B!=null&&B.length)return B}},gaP=function(B){var z,T,R;
return g.D(function(h){if(h.U==1)return B?g.P(h,Ei(B,g.vA,"mainDownloadsListEntity"),2):h.return([]);z=h.T;return((T=z)==null?0:(R=T.downloads)==null?0:R.length)?h.return(z.downloads.map(function(W){var b;return(b=W.videoItem)!=null?b:""})):h.return([])})},p1g=function(B,z){var T;
return g.D(function(R){return R.U==1?g.P(R,JGW(B,z),2):(T=R.T)?g.P(R,e7(B,{mode:"readwrite",cB:!0},function(h){var W=[t6(h,T.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];T.mainDownloadsListEntity&&W.push(t6(h,T.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.VD.all(W)}),0):R.jI(0)})},JGW=function(B,z){var T,R,h,W,b,l,w,q,c,L,C,r,F,A,a,V,M,x;
return g.D(function(v){if(v.U==1)return T=g.iZ("main_downloads_library_id","mainDownloadsLibraryEntity"),R=g.iZ("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.P(v,e7(B,{mode:"readonly",cB:!0},function(n){return g.VD.all([fK(n,T,"mainDownloadsLibraryEntity"),fK(n,R,"mainDownloadsListEntity")])}),2);
h=v.T;W=g.d(h);b=W.next().value;l=W.next().value;w=b;q=l;w||(w={id:T});c=g.d(z);for(L=c.next();!L.done;L=c.next())if(C=L.value,C===g.vA){if(w.smartDownloadsList)return v.return();w.smartDownloadsList=C}else if(r=g.qq(C).entityType,F={},r==="mainPlaylistEntity"?F.playlistItem=C:r==="mainVideoEntity"&&(F.videoItem=C),!g.Ep(F)){A=void 0;if((A=q)==null?0:A.downloads){a=!1;V=g.d(q.downloads);for(M=V.next();!M.done;M=V.next())if(x=M.value,x.playlistItem===C||x.videoItem===C){a=!0;break}a||q.downloads.push(F)}else q=
{id:R,downloads:[F]};w.downloadsList=R}return v.return({mainDownloadsLibraryEntity:w,mainDownloadsListEntity:q})})},$8W=function(B,z){var T,R,h,W,b,l,w,q,c,L,C,r,F,A,a;
return g.D(function(V){if(V.U==1)return T=g.iZ("main_downloads_library_id","mainDownloadsLibraryEntity"),R=g.iZ("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.P(V,e7(B,{mode:"readonly",cB:!0},function(M){return g.VD.all([fK(M,T,"mainDownloadsLibraryEntity"),fK(M,R,"mainDownloadsListEntity"),fK(M,g.vA,"mainDownloadsListEntity")])}),2);
h=V.T;W=g.d(h);b=W.next().value;l=W.next().value;w=W.next().value;q=b;c=l;L=w;if(!q)return V.jI(0);if(z===g.vA&&((C=L)==null?0:C.downloads))L.downloads=[];else if((r=c)==null?0:r.downloads)for(F=g.qq(z).entityType,A=0;A<c.downloads.length;A++)if(a=c.downloads[A],F==="mainVideoEntity"&&a.videoItem===z){c.downloads.splice(A,1);break}else if(F==="mainPlaylistEntity"&&a.playlistItem===z){c.downloads.splice(A,1);break}return g.P(V,e7(B,{mode:"readwrite",cB:!0},function(M){var x=[t6(M,q,"mainDownloadsLibraryEntity")];
c&&x.push(t6(M,c,"mainDownloadsListEntity"));L&&x.push(t6(M,L,"mainDownloadsListEntity"));return g.VD.all(x)}),0)})},Vo=function(B,z){var T,R,h,W,b,l,w,q,c,L,C;
return g.D(function(r){if(r.U==1)return T=g.iZ(z,"transfer"),R=g.iZ(z,"videoDownloadContextEntity"),g.P(r,e7(B,{mode:"readonly",cB:!0},function(F){return g.VD.all([fK(F,T,"transfer"),fK(F,R,"videoDownloadContextEntity")])}),2);
h=r.T;W=g.d(h);b=W.next().value;l=W.next().value;w=b;q=l;C={videoId:z,cotn:(c=w)==null?void 0:c.cotn,offlineModeType:(L=q)==null?void 0:L.offlineModeType};return r.return(C)})},Qo=function(B,z,T,R,h){var W,b,l,w,q,c,L,C,r,F,A,a,V,M,x,v,n,Z,N,TP;
return g.D(function(hK){switch(hK.U){case 1:return W=g.iZ(B,"musicTrack"),b=g.iZ(B,"transfer"),g.P(hK,e7(z,{mode:"readonly",cB:!0},function(zP){return g.VD.all([fK(zP,W,"musicTrack"),fK(zP,b,"transfer"),Oi(zP,"musicTrack"),Oi(zP,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:l=hK.T;w=g.d(l);q=w.next().value;c=w.next().value;L=w.next().value;C=w.next().value;r=q;F=c;A=L;a=C;if(!r){hK.jI(3);break}return g.P(hK,P8p(r,A),4);case 4:return V=hK.T,g.P(hK,AP(V),3);case 3:M=[];x=g.d(a);for(v=x.next();!v.done;v=x.next())n=v.value,Z=g.qq(n.key).entityId,N=G6(n),TP=g.qq(N.action.entityKey).entityId,Z!==B&&TP!==B||rE(T,n.actionProto)||M.push(n.key);return g.P(hK,e7(z,{mode:"readwrite",cB:!0},function(zP){var ld=M.map(function(t){return j7(zP,t)});
ld.push(j7(zP,W,{Xx:!0}));return g.VD.all(ld)}),6);
case 6:oO(F),h&&lV(h),bV(R,{entityKey:W,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.dX(hK)}})},yo=function(B,z,T,R,h){var W,b,l,w,q,c,L,C,r,F,A,a,V,M,x,v,n,Z,N,TP,hK,zP,ld,t,UH,Qz,vb,AI,lW,gX,Vz,hI,U,Yr,tI,Av;
return g.D(function(gF){switch(gF.U){case 1:return W=g.iZ(B,z),b=g.iZ("music_downloads_library_id","musicDownloadsLibraryEntity"),g.P(gF,e7(T,{mode:"readonly",cB:!0},function(rF){return g.VD.all([fK(rF,W,z),fK(rF,b,"musicDownloadsLibraryEntity"),Oi(rF,z),Oi(rF,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:l=gF.T;w=g.d(l);q=w.next().value;c=w.next().value;L=w.next().value;C=w.next().value;r=q;F=c;A=L;a=C;if(!r){gF.jI(3);break}return g.P(gF,P8p(r,A),4);case 4:return V=gF.T,g.P(gF,AP(V),3);case 3:M=[];x=new Map;if(!r){gF.jI(6);break}return g.P(gF,x8q(r,A,F),7);case 7:M=gF.T;v=g.d(M);for(n=v.next();!n.done;n=v.next())Z=n.value,N=g.qq(Z).entityId,x.set(N,{videoId:N,playlistId:B,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.P(gF,S7(T,"transfer"),8);case 8:for(TP=gF.T,hK=
g.d(TP),zP=hK.next();!zP.done;zP=hK.next())ld=zP.value,t=g.qq(ld.key).entityId,(UH=x.get(t))&&ld&&(UH.cotn=ld.cotn);case 6:Qz=[];vb=g.d(a);for(AI=vb.next();!AI.done;AI=vb.next())lW=AI.value,gX=g.qq(lW.key).entityId,Vz=G6(lW),gX!==B&&Vz.rootActionId!==B||rE(R,lW.actionProto)||Qz.push(lW.key);hI=g.iZ(B,z);return g.P(gF,e7(T,{mode:"readwrite",cB:!0},function(rF){var mB=Qz.map(function(v7){return j7(rF,v7)});
mB.push(j7(rF,hI,{Xx:!0}));return g.VD.all(mB)}),9);
case 9:if(!r){gF.jI(0);break}M.reverse();if(!M.length){gF.jI(0);break}U=g.d(M);Yr=U.next();case 12:if(Yr.done){gF.jI(0);break}tI=Yr.value;Av=g.qq(tI).entityId;if(!Av){gF.jI(13);break}return g.P(gF,Qo(Av,T,R,h,x.get(Av)),13);case 13:Yr=U.next(),gF.jI(12)}})},gE=function(B,z,T){var R,h,W,b,l,w,q;
return g.D(function(c){if(c.U==1)return g.P(c,e7(B,{mode:"readwrite",cB:!0},function(L){var C=Oi(L,"transfer"),r=Oi(L,"offlineOrchestrationActionWrapperEntity");return g.VD.all([C,r]).then(function(F){F=g.d(F);var A=F.next().value;var a=F.next().value;F=vaP.map(function(v){return IEh(L,v)});
a=g.d(a);for(var V=a.next();!V.done;V=a.next()){V=V.value;var M=g.qq(V.actionProto.entityKey).entityType==="musicTrack",x=V.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";rE(z,V.actionProto)||M&&(!M||x)||F.push(j7(L,V.key,{Xx:!0}))}return g.VD.all(F).then(function(){return A})})}),2);
R=c.T;h=g.d(R);for(W=h.next();!W.done;W=h.next())b=W.value,oO(b),l=g.qq(b.key).entityId,w={videoId:l,offlineDeleteReason:void 0,cotn:b.cotn},lV(w),q=g.iZ(l,"musicTrack"),bV(T,{entityKey:q,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.P(c,IcI(),0)})},D8P=function(B){for(var z,T=g.d(B.additionalMetadatas),R=T.next();!R.done;R=T.next())R=R.value,R.offlineMusicVideoData&&(z=R.offlineMusicVideoData);
var h,W,b,l,w;return{id:g.iZ(B.videoId,"musicTrack"),videoId:B.videoId,title:B.title,thumbnailDetails:B.thumbnail,lengthMs:String(Number(B.lengthSeconds)*1E3),albumTitle:(h=z)==null?void 0:h.releaseTitle,musicVideoType:(W=z)==null?void 0:W.musicVideoType,contentRating:{explicitType:(b=z)==null?void 0:b.explicitType},artistNames:((l=z)==null?void 0:l.byline)||((w=z)==null?void 0:w.channelName),downloadMetadata:g.iZ(B.videoId,"musicTrackDownloadMetadataEntity")}},x8q=function(B,z,T){var R,h,W,b,l,w,
q,c,L,C,r,F,A,a,V,M,x,v;
return g.D(function(n){R=[];h=new Set;if((W=T)==null?0:(b=W.downloadedTracks)==null?0:b.length)for(l=g.d(T.downloadedTracks),w=l.next();!w.done;w=l.next())q=w.value,h.add(q);if(B.tracks){c=g.d(B.tracks);for(L=c.next();!L.done;L=c.next())C=L.value,h.has(C)||R.push(C);r=g.d(z);for(F=r.next();!F.done;F=r.next())if(A=F.value,A.id!==B.id&&(a=A.tracks))for(V=g.d(a),M=V.next();!M.done;M=V.next())x=M.value,v=R.indexOf(x),v!==-1&&R.splice(v,1)}return n.return(R)})},P8p=function(B,z){var T,R,h,W,b,l,w,q;
return g.D(function(c){T=Fg(B.thumbnailDetails);R=g.d(z);for(h=R.next();!h.done;h=R.next())if(W=h.value,W.id!==B.id)for(b=g.d(Fg(W.thumbnailDetails)),l=b.next();!l.done;l=b.next())w=l.value,q=T.indexOf(w),q!==-1&&T.splice(q,1);return c.return(T)})},k3F=function(B,z){var T,R,h,W,b,l,w,q,c;
return g.D(function(L){if(L.U==1)return T=g.iZ("music_downloads_library_id","musicDownloadsLibraryEntity"),g.P(L,Ei(B,T,"musicDownloadsLibraryEntity"),2);(R=L.T)||(R={id:T});h=g.qq(z).entityType;h==="musicTrack"?(W=R.downloadedTracks)!=null&&W.includes(z)||(R.downloadedTracks=((b=R.downloadedTracks)!=null?b:[]).concat(z)):h==="musicPlaylist"?(l=R.downloadedPlaylists)!=null&&l.includes(z)||(R.downloadedPlaylists=((w=R.downloadedPlaylists)!=null?w:[]).concat(z)):h!=="musicAlbumRelease"||(q=R.downloadedAlbumReleases)!=
null&&q.includes(z)||(R.downloadedAlbumReleases=((c=R.downloadedAlbumReleases)!=null?c:[]).concat(z));return g.P(L,si(B,R,"musicDownloadsLibraryEntity"),0)})},KgW=function(B,z){var T,R,h,W,b,l,w;
return g.D(function(q){if(q.U==1)return T=g.iZ("music_downloads_library_id","musicDownloadsLibraryEntity"),g.P(q,Ei(B,T,"musicDownloadsLibraryEntity"),2);R=q.T;if(!R)return q.jI(0);h=g.qq(z).entityType;h==="musicTrack"?W=R.downloadedTracks:h==="musicPlaylist"&&(W=R.downloadedPlaylists);if((b=W)==null?0:b.length)for(l=0;l<W.length;l++)if(w=W[l],w===z){W.splice(l,1);break}return g.P(q,si(B,R,"musicDownloadsLibraryEntity"),0)})},m8s=function(B){var z=B.videos;
B=[];var T=[];if(z){z=g.d(z);for(var R=z.next();!R.done;R=z.next()){var h=R.value.offlineVideoData.videoId;R=g.iZ(h,"musicTrack");h=g.iZ(h,"musicTrackDownloadMetadataEntity");B.push(R);T.push(h)}}return{Mq:B,Jw:T}},JP=function(B,z,T){z={track:D8P(z)};
T&&(z.playlistId=T);if(B=g.u(B.actionMetadata,naq))z.maximumDownloadQuality=B.maximumDownloadQuality;return{musicTrackEntityActionMetadata:z}},HPU=function(B){var z,T,R,h,W,b,l,w;
return g.D(function(q){switch(q.U){case 1:return z=g.wI(),T=ntP(B),R=g.rn(uh5),g.AK(q,2),W={CL:!0},g.P(q,g.E4(z,T,R,void 0,W),4);case 4:h=q.T;g.yz(q,3);break;case 2:b=g.JK(q);if(b instanceof g.bB)throw l="GetOffline network manager error: "+b.message,hP(l,b),Error(l);hP("GetOffline fetch request error",b);throw Error("GetOffline fetch request error");case 3:w=pc(h);if(!h)throw hP("Network request failed"),Error("Network request failed");if(w!==void 0)$G(w);else if(!h.videos||!h.videos.length)throw hP("No data"),
Error("No data");return q.return(h.videos.map(function(c){return c.offlineVideoData}))}})},fcs=function(B){var z,T,R,h,W,b,l,w;
return g.D(function(q){switch(q.U){case 1:return z=g.wI(),T=uwh(B),R=g.rn(uh5),g.AK(q,2),W={CL:!0},g.P(q,g.E4(z,T,R,void 0,W),4);case 4:h=q.T;g.yz(q,3);break;case 2:b=g.JK(q);if(b instanceof g.bB)throw l="GetOffline network manager error for playlist: "+b.message,hP(l,b),Error(l);hP("GetOffline fetch request error for playlist",b);throw Error("GetOffline fetch request error for playlist");case 3:w=pc(h);if(!h)throw hP("Network request failed for playlist"),Error("Network request failed for playlist");
if(w!==void 0)$G(w,"playlist");else if(!h.playlists||!h.playlists.length)throw hP("No data for playlist"),Error("No data for playlist");return q.return(h.playlists.map(function(c){return c.offlinePlaylistData}))}})},NUc=function(B,z,T,R){var h,W,b,l,w,q,c,L,C,r,F,A,a,V,M,x,v,n,Z,N,TP,hK,zP,ld,t,UH,Qz,vb,AI,lW;
return g.D(function(gX){switch(gX.U){case 1:return g.P(gX,B9(),2);case 2:h=gX.T;if(!h)return gX.return([]);W=[];if((b=R)==null?0:b.length){W=R;gX.jI(3);break}return g.P(gX,S7(h,"mainPlaylistEntity"),4);case 4:W=gX.T;case 3:if(!W.length)return gX.return([]);l=[];w=Date.now()/1E3;q=g.d(W);c=q.next();case 5:if(c.done)return l.length?g.P(gX,OPP(l),10):gX.return([]);L=c.value;if(!L.downloadState){C=void 0;gX.jI(8);break}return g.P(gX,Ei(h,L.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:C=
gX.T;case 8:r=C;F=void 0;a=(A=(F=L)==null?void 0:F.entityMetadata)&&A.nextAutoRefreshIntervalSeconds?Number(A.nextAutoRefreshIntervalSeconds):NaN;V=Number.isNaN(a)?B:a;x=M=void 0;v=((M=r)==null?0:M.lastSyncedTimestampMillis)?Number((x=r)==null?void 0:x.lastSyncedTimestampMillis)/1E3:0;Z=n=void 0;N=((n=r)==null?0:n.addedTimestampMillis)?Number((Z=r)==null?void 0:Z.addedTimestampMillis)/1E3:0;if(T||!A||v+V<=w){TP=[];hK=void 0;if((hK=L.videos)==null?0:hK.length)for(zP=g.d(L.videos),ld=zP.next();!ld.done;ld=
zP.next())t=ld.value,UH=JSON.parse(g.qq(t).entityId),UH.videoId&&TP.push(UH.videoId);Qz="0";A&&(vb=void 0,Qz=String(Number((vb=A.offlineLastModifiedTimestampSeconds)!=null?vb:0).toFixed()));AI={playlistId:L.playlistId,videoIds:TP,offlineLastModifiedTimestamp:Qz,autoSync:z,offlineDateAddedTimestamp:String(N.toFixed())};l.push(AI)}c=q.next();gX.jI(5);break;case 10:return lW=gX.T,gX.return(lW)}})},tQI=function(){var B,z,T,R,h;
return g.D(function(W){if(W.U==1)return g.P(W,B9(),2);if(W.U!=3)return(B=W.T)?g.P(W,S7(B,"refresh"),3):W.return(!1);z=W.T;if((T=z[0])==null||!T.refreshTime)return W.return(!1);R=Number(z[0].refreshTime);h=Date.now()/1E3;return W.return(isFinite(R)&&h>=R)})},X1g=function(B,z){var T,R,h;
return g.D(function(W){switch(W.U){case 1:return g.AK(W,2),g.P(W,js7(B,z),4);case 4:return R=W.T,g.P(W,VQ7(R),5);case 5:T=yGR(R);g.yz(W,3);break;case 2:h=g.JK(W),hP("getAndProcessSmartDownloadsResponse request or processing error",h);case 3:return W.return(T)}})},ZPq=function(B,z,T,R){var h,W,b,l,w,q,c,L,C,r,F,A,a,V,M,x,v,n,Z,N,TP,hK,zP,ld,t,UH,Qz,vb,AI,lW;
return g.D(function(gX){switch(gX.U){case 1:return g.P(gX,B9(),2);case 2:h=gX.T;if(!h)return gX.return([]);W=[];if((b=R)==null?0:b.length){W=R;gX.jI(3);break}return g.P(gX,S7(h,"musicPlaylist"),4);case 4:W=gX.T;case 3:if(!W.length)return gX.return([]);l=[];w=Date.now()/1E3;q=g.d(W);c=q.next();case 5:if(c.done)return l.length?g.P(gX,OPP(l),10):gX.return([]);L=c.value;C=void 0;F=(r=(C=L)==null?void 0:C.entityMetadata)&&r.nextAutoRefreshIntervalSeconds?Number(r.nextAutoRefreshIntervalSeconds):NaN;A=
Number.isNaN(F)?B:F;V=a=0;M="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!L.downloadMetadata){gX.jI(8);break}return g.P(gX,Ei(h,L.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:x=gX.T,n=v=void 0,a=Number((n=(v=x)==null?void 0:v.addedTimestampMillis)!=null?n:"0")/1E3,N=Z=void 0,V=Number((N=(Z=x)==null?void 0:Z.lastModifiedTimestampMillis)!=null?N:"0")/1E3,hK=TP=void 0,M=(hK=(TP=x)==null?void 0:TP.syncState)!=null?hK:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:zP=void 0;if(T||M!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!r||Number((zP=r.lastSyncedTimestampSeconds)!=null?zP:0)+A<=w){ld=[];t=void 0;if((t=L.tracks)==null?0:t.length)for(UH=g.d(L.tracks),Qz=UH.next();!Qz.done;Qz=UH.next())vb=Qz.value,ld.push(g.qq(vb).entityId);AI={playlistId:L.playlistId,videoIds:ld,offlineLastModifiedTimestamp:String(V.toFixed()),autoSync:z,offlineDateAddedTimestamp:String(a.toFixed())};l.push(AI)}c=q.next();gX.jI(5);break;case 10:return lW=gX.T,gX.return(lW)}})},js7=function(B,z){var T,R,h,W,b,l,w,q,c,L;
return g.D(function(C){switch(C.U){case 1:return T=g.wI(),g.P(C,B9(),2);case 2:R=C.T;if(!R){C.jI(3);break}return g.P(C,X0s(R),4);case 4:h=C.T;case 3:var r=h;W={context:g.cS(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:B},offlineClientState:r,clientStateRequestData:{preferredFormatType:z}}}};b=g.rn(eMF);g.AK(C,5);w={CL:!0};return g.P(C,g.E4(T,W,b,void 0,w),7);case 7:l=C.T;g.yz(C,6);break;case 5:q=g.JK(C);if(q instanceof g.bB)throw c=
"DPS network manager error for smart downloads: "+q.message,hP(c,q),Error(c);hP("DPS fetch request error for smart downloads",q);throw Error("DPS fetch request error for smart downloads");case 6:L=pc(l);if(l)L!==void 0&&$G(L,"smart downloads");else throw hP("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return C.return(l)}})},Eas=function(B,z){var T,R,h,W,b,l,w,q;
return g.D(function(c){switch(c.U){case 1:return T=g.wI(),R={context:g.cS(),videoPlaybackPositionEntities:B,lastSyncTimestampUsec:z},h=g.rn(ssR),g.AK(c,2),b={CL:!0},g.P(c,g.E4(T,R,h,void 0,b),4);case 4:W=c.T;g.yz(c,3);break;case 2:l=g.JK(c);if(l instanceof g.bB)throw w="VPPS network manager error: "+l.message,hP(w,l),Error(w);hP("VPPS fetch request error",l);throw Error("VPPS fetch request error");case 3:q=pc(W);if(W)q!==void 0&&$G(q,"position sync");else throw hP("Network request failed for position sync"),
Error("Network request failed for position sync");return c.return(W)}})},ByI=function(B,z,T){var R,h,W,b,l,w,q,c;
return g.D(function(L){switch(L.U){case 1:R=g.wI();var C=T.refreshData,r=T.isEnqueuedForExpiredStreamUrlRefetch,F=T.Vs,A=T.offlineSourceData,a=T.mediaCapabilities,V={entityKey:B};C&&(V.refreshData=C);r&&(V.isExpiredStreamUrlRefetch=r);F&&(V.downloadParameters=F);A&&(V.offlineSourceData=A);C={context:g.ER(z),signatureTimestamp:20228,videos:[V]};a&&(C.mediaCapabilities=a);h=C;W=g.rn(S7q);g.AK(L,2);l={CL:!0};return g.P(L,g.E4(R,h,W,void 0,l),4);case 4:b=L.T;g.yz(L,3);break;case 2:w=g.JK(L);if(w instanceof
g.bB)throw q="GetPDE network manager error: "+w.message,hP(q,w),Error(q);hP("GetPDE fetch request error",w);throw Error("GetPDE fetch request error");case 3:c=pc(b);if(b)c!==void 0&&$G(c,"PDE");else throw hP("Network request failed for PDE"),Error("Network request failed for PDE");return L.return(b)}})},pc=function(B){var z;
return(z=B.errorMetadata)==null?void 0:z.status},$G=function(B,z){z=z?" for "+z:"";
if(B===0)throw B="Empty response body"+z,hP(B),Error(B);B="Response with error"+z;hP(B);throw Error(B);},OPP=function(B){var z,T,R,h,W,b,l,w;
return g.D(function(q){switch(q.U){case 1:return z=g.wI(),T=Hhp(B),R=g.rn(z0g),g.AK(q,2),W={CL:!0},g.P(q,g.E4(z,T,R,void 0,W),4);case 4:h=q.T;g.yz(q,3);break;case 2:b=g.JK(q);if(b instanceof g.bB)throw l="offlinePlaylistSyncCheck network manager error: "+b.message,hP(l,b),Error(l);hP("offlinePlaylistSyncCheck fetch request error",b);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:w=pc(h);if(!h)throw hP("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(w!==void 0)$G(w,"playlist sync");else if(!h.offlinePlaylistSyncCheckDatas||!h.offlinePlaylistSyncCheckDatas.length)throw hP("No data for playlist sync"),Error("No data for playlist sync");return q.return(h.offlinePlaylistSyncCheckDatas.map(function(c){return c.offlinePlaylistSyncCheckData}))}})},P9=function(B){this.T=B},Typ=function(B,z){var T,R,h,W,b,l;
return g.D(function(w){switch(w.U){case 1:T=new Map,R=g.d(z),h=R.next();case 2:if(h.done){w.jI(4);break}W=h.value;b=T;l=b.set;return g.P(w,B.U(W),5);case 5:l.call(b,W,w.T);h=R.next();w.jI(2);break;case 4:return w.return(T)}})},xG=function(B,z,T,R,h,W){z=g.iZ(z,T);
R=Object.assign({},W,{priority:R,retryScheduleIntervalsInSeconds:h});return{actionType:B,entityKey:z,actionMetadata:R}},v9=function(B,z,T,R,h,W){this.status=B;
this.T=z;this.W=T;this.U=R;this.Y=h;this.downloadState=W},R0g=function(B,z,T){this.T=B;
this.dF=z;this.Y=T},bic=function(B,z){var T,R,h,W,b,l,w,q,c;
return g.D(function(L){switch(L.U){case 1:return T=z.entityKey,h=(R=g.u(z.actionMetadata,DC))==null?void 0:R.isEnqueuedForExpiredStreamUrlRefetch,g.AK(L,2),W=void 0,g.P(L,h07(B,z),4);case 4:W=L.T;g.AK(L,5);var C=(C=g.u(z.actionMetadata,DC))?{maximumDownloadQuality:C.maximumDownloadQuality}:void 0;return g.P(L,ByI(T,B.dF,{isEnqueuedForExpiredStreamUrlRefetch:h,Vs:C,offlineSourceData:W}),7);case 7:b=L.T;g.yz(L,6,2);break;case 5:return g.JK(L,2),l=qA(z)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",hP("PDE handleAdd error"),L.return(kG(z,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",l,"DOWNLOAD_STATE_FAILED"));case 6:return g.P(L,WSR(B,b,z),8);case 8:return L.return(kG(z,!0,b.orchestrationActions));case 2:return w=g.JK(L),q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",c="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",w instanceof g.Ih&&w.type==="QUOTA_EXCEEDED"&&(q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
c="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),hP("PDE handleAdd error"),L.return(kG(z,!1,void 0,q,c,"DOWNLOAD_STATE_FAILED"))}})},wuW=function(B,z){var T,R,h,W,b,l,w,q,c,L,C,r,F,A,a,V,M,x,v,n,Z,N,TP,hK;
return g.D(function(zP){switch(zP.U){case 1:return T=z.entityKey,R=g.qq(T).entityId,g.P(zP,e7(B.T,{mode:"readonly",cB:!0},function(ld){var t=fK(ld,T,"playbackData"),UH=fK(ld,g.iZ(R,"offlineVideoPolicy"),"offlineVideoPolicy");ld=fK(ld,g.iZ(R,"transfer"),"transfer");return g.VD.all([t,UH,ld])}),2);
case 2:h=zP.T;W=g.d(h);b=W.next().value;l=W.next().value;w=W.next().value;q=b;c=l;L=w;if(!q||!c)return zP.return(kG(z,!0));C=[];A=((F=q)==null?0:F.playerResponseJson)?JSON.parse(q.playerResponseJson):null;if(!(L&&A&&B.dF.D("html5_refresh_deprecated_downloads"))){zP.jI(3);break}r=Ywg(B,A,L);return g.P(zP,lvp(B,L),4);case 4:C=zP.T;case 3:a={lastPlayerResponseTimestampSeconds:q.playerResponseTimestamp,offlineToken:c.offlineToken,formatIds:C};V={};if((M=L)==null?0:M.maximumDownloadQuality)V.maximumDownloadQuality=
L.maximumDownloadQuality;g.AK(zP,5);x=void 0;return g.P(zP,h07(B,z),7);case 7:return x=zP.T,g.AK(zP,8),g.P(zP,ByI(T,B.dF,{refreshData:a,Vs:V,offlineSourceData:x,mediaCapabilities:r}),10);case 10:v=zP.T;g.yz(zP,9,5);break;case 8:return g.JK(zP,5),n=qA(z)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",hP("PDE handleRefresh error"),zP.return(kG(z,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",n,
"DOWNLOAD_STATE_FAILED"));case 9:return g.P(zP,WSR(B,v,z),11);case 11:return zP.return(kG(z,!0,v.orchestrationActions));case 5:return Z=g.JK(zP),N="PDE handleRefresh error",Z instanceof Error&&(N="PDE handleRefresh error: "+Z.message),TP="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",hK="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Z instanceof g.Ih&&Z.type==="QUOTA_EXCEEDED"&&(TP="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",hK="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
hP(N),zP.return(kG(z,!1,void 0,TP,hK,"DOWNLOAD_STATE_FAILED"))}})},h07=function(B,z){var T,R,h,W;
return g.D(function(b){if(b.U==1)return T=g.qq(z.entityKey).entityId,R=g.iZ(T,"videoDownloadContextEntity"),g.P(b,Ei(B.T,R,"videoDownloadContextEntity"),2);h=b.T;return(W=h)!=null&&W.offlineModeType?b.return({offlineModeType:h.offlineModeType}):b.return(void 0)})},WSR=function(B,z,T){var R,h,W,b,l;
return g.D(function(w){if(w.U==1){if(!z.frameworkUpdates||!g.u(z.frameworkUpdates,MA))return w.return();if(!(g.u(z.frameworkUpdates,MA).mutations&&g.u(z.frameworkUpdates,MA).mutations.length>0&&g.u(z.frameworkUpdates,MA).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return w.jI(2);R=g.qq(g.u(z.frameworkUpdates,MA).mutations[0].entityKey).entityId;return g.P(w,Vo(B.T,R),3)}if(w.U!=2){h=w.T;W=g.u(T.actionMetadata,DC);if(l=(b=W)==null?void 0:b.playlistId)h.playlistId=l;h.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.Zf(B.dF)?g.P(w,Um(R,B.T,T,B.Y,h),2):g.f0(B.dF)?g.P(w,Qo(R,B.T,T,B.Y),2):w.jI(2)}return g.P(w,$WF(g.u(z.frameworkUpdates,MA)),0)})},kG=function(B,z,T,R,h,W){return new v9(z?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",qA(B),T,R,h,W)},Ywg=function(B,z,T){z=oas(B.dF,T.cotn,z);
T=g.Yh(z);return g.Bcz(z,T,B.dF)},lvp=function(B,z){var T,R,h,W,b,l,w,q,c,L,C;
return g.D(function(r){if(r.U==1)return T=[],g.P(r,e7(B.T,{mode:"readonly",cB:!0},function(F){var A=[],a=z.offlineVideoStreams;if(a){a=g.d(a);for(var V=a.next();!V.done;V=a.next())A.push(fK(F,V.value,"offlineVideoStreams"))}return g.VD.all(A)}),2);
if(R=r.T)for(h=g.d(R),W=h.next();!W.done;W=h.next())if(b=W.value,l=void 0,(l=b)==null?0:l.streamsProgress)for(w=b.streamsProgress,q=0;q<w.length;q++)c=w[q],L=JSON.parse(c.formatStreamBytes),C={itag:L.itag,lmt:L.lastModified,xtags:L.xtags},T.push(C);return r.return(T)})},qws=function(B,z){this.T=B;
this.dF=z},iiW=function(B,z){var T,R,h,W,b,l,w,q,c,L,C,r;
return g.D(function(F){switch(F.U){case 1:return T=qA(z),g.P(F,S7(B.T,"videoPlaybackPositionEntity"),2);case 2:R=F.T;if(R.length===0)return F.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",T));g.AK(F,3);return g.P(F,nK.getInstance(),5);case 5:h=F.T;if(!h)throw Error("prefStorage is undefined");return g.P(F,h.get("psi"),6);case 6:return W=F.T,w=(l=(b=W)==null?void 0:b.rS)!=null?l:"0",g.P(F,Eas(R,w),7);case 7:return q=F.T,c={isPaused:q.watchHistoryPaused,rS:q.syncTimestampUsec},g.P(F,h.set("psi",
c),8);case 8:if(c.isPaused){F.jI(9);break}L=g.u(q.frameworkUpdates,MA);if(!q.frameworkUpdates||!L){F.jI(9);break}return g.P(F,$WF(L),9);case 9:g.yz(F,4);break;case 3:return C=g.JK(F),r="PPE handleRefresh error: "+(C instanceof Error?C.message:"unknown error"),hP(r),F.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",T,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return F.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
T))}})},LSF=function(B,z){var T,R,h,W,b,l,w,q;
return g.D(function(c){switch(c.U){case 1:return T=qA(z),R=g.qq(z.entityKey).entityId,g.AK(c,2),g.P(c,nK.getInstance(),4);case 4:h=c.T;if(!h)throw Error("prefStorage is undefined");return g.P(c,h.get("psi"),5);case 5:W=c.T;b=g.u(z.actionMetadata,cXR);if(((l=W)==null?void 0:l.isPaused)!==!1||(w=b)==null||!w.lastPlaybackPositionSeconds){c.jI(6);break}q={key:g.iZ(R,"videoPlaybackPositionEntity"),videoId:R,lastPlaybackPositionSeconds:b.lastPlaybackPositionSeconds};return g.P(c,si(B.T,q,"videoPlaybackPositionEntity"),
6);case 6:g.yz(c,3);break;case 2:return g.JK(c),c.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",T,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return c.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",T))}})},Cbs=function(B,z){var T,R,h;
return g.D(function(W){switch(W.U){case 1:T=qA(z);g.AK(W,2);R=g.qq(z.entityKey).entityId;if(R==="!*$_ALL_ENTITIES_!*$")return g.P(W,Q9U(B.T),5);h=g.iZ(R,"videoPlaybackPositionEntity");return g.P(W,VN7(B.T,h),5);case 5:g.yz(W,3);break;case 2:return g.JK(W),W.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",T,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return W.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
T))}})},rXR=function(B,z){this.api=B;
this.T=z;this.logger=new g.RH("woffle");this.U=!1;this.Yi={gi:this.gi};this.logger.debug("Initialized OfflineMediaManager")},occ=function(B){return g.D(function(z){return z.return(mWq(B))})},FSP=function(B){var z;
return g.D(function(T){if(T.U==1)return g.P(T,g.AMd(B),2);z=T.T;return T.return(z.filter(function(R){return!!R.url}).map(function(R){return R.url}))})},Kc=function(B,z){var T=g.pb(z);
if(T===1||T===0)return Promise.resolve();(T=Iv5(B,z))&&T.stopVideo();B.Y=0;return occ(z)},mn=function(B,z,T,R){T=T===void 0?!1:T;
R=R===void 0?!0:R;var h=typeof z==="string"?z:z.videoDetails.videoId;g.pb(h)===2&&((z=Iv5(B,h))?z.stopVideo():B.logger.info(function(){return"Corresponding player for "+h+" not found. Pausing anyway"}),g.$O(h,2),B.Y=2,T?Gd7(B.T):R&&doU(B.T))},Iv5=function(B,z){var T;
return((T=B.player)==null?void 0:T.getVideoData().videoId)===z?B.player:null},AXW=function(B,z,T){z.getPlayerResponse();
g.$O(z.videoId,2);B.Y=2;B.U=!1;var R;(R=B.player)==null||R.dispose();B.player=B.api.TA(z);z={};B.player.j8((z.localmediachange=B.Bt,z.signatureexpired=B.qT,z.statechange=B.PKd,z),B);var h=B.gi(T);B.player.jC(g.la(h,h,!0,"m"),!1);B.logger.debug(function(){return"Starting headless playback with quality: "+h});
B.player.Ab(!1)},av7=function(B,z){this.T=B;
this.dF=z},Mig=function(B,z){var T,R;
return g.D(function(h){switch(h.U){case 1:return T=qA(z),g.P(h,Ei(B.T,z.entityKey,"transfer"),2);case 2:if(R=h.T)return h.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",T));g.AK(h,3);return g.P(h,Uog(B,z),5);case 5:g.yz(h,4);break;case 3:return g.JK(h),h.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",T,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return h.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
T))}})},ViU=function(B,z){var T,R;
return g.D(function(h){switch(h.U){case 1:return T=qA(z),g.P(h,Ei(B.T,z.entityKey,"transfer"),2);case 2:R=h.T;if(!R||R.transferState!=="TRANSFER_STATE_COMPLETE")return h.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",T));g.AK(h,3);return g.P(h,Uog(B,z,!0),5);case 5:g.yz(h,4);break;case 3:return g.JK(h),h.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",T,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return h.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",T))}})},QCg=function(B,z){var T,R,h,W,b,l,w,q,c,L;
return g.D(function(C){switch(C.U){case 1:return T=qA(z),R=g.qq(z.entityKey).entityId,g.P(C,e7(B.T,{mode:"readonly",cB:!0},function(r){var F=fK(r,z.entityKey,"transfer");r=fK(r,g.iZ(R,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.VD.all([F,r])}),2);
case 2:h=C.T;W=g.d(h);b=W.next().value;l=W.next().value;w=b;q=l;if(!w||w.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return C.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",T));g.AK(C,3);w.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.P(C,si(B.T,w,"transfer"),5);case 5:c=g.qq(w.key).entityId;q7U({videoId:c,gI:w,offlineModeType:(L=q)==null?void 0:L.offlineModeType});g.yz(C,4);break;case 3:return g.JK(C),C.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
T,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return C.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",T))}})},Uog=function(B,z,T){T=T===void 0?!1:T;
var R,h,W,b,l,w,q,c,L,C,r,F,A,a,V;return g.D(function(M){switch(M.U){case 1:return R=g.u(z.actionMetadata,yXh),h=g.qq(z.entityKey).entityId,W=g.iZ(h,"downloadStatusEntity"),g.P(M,e7(B.T,{mode:"readonly",cB:!0},function(x){var v=fK(x,W,"downloadStatusEntity");x=fK(x,g.iZ(h,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.VD.all([v,x])}),2);
case 2:return b=M.T,l=g.d(b),w=l.next().value,q=l.next().value,c=w,L=q,C="TRANSFER_STATE_TRANSFER_IN_QUEUE",((r=c)==null?void 0:r.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(C="TRANSFER_STATE_PAUSED_BY_USER"),a={key:z.entityKey,transferState:C,cotn:g.V6(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(F=R)==null?void 0:F.maximumDownloadQuality,preferredAudioTrack:(A=R)==null?void 0:A.preferredAudioTrack,transferRetryCount:0,isRefresh:T,hasLoggedFirstStarted:!1},g.P(M,e7(B.T,
{mode:"readwrite",cB:!0},function(x){var v=[];T&&v.push(j7(x,g.iZ(h,"offlineVideoStreams")));v.push(t6(x,a,"transfer"));return g.VD.all(v)}),3);
case 3:if(!T){M.jI(4);break}return g.P(M,occ(h),4);case 4:lcF({videoId:h,gI:a,offlineModeType:(V=L)==null?void 0:V.offlineModeType}),g.dX(M)}})},JXK=function(B,z,T,R){if(!B.action.entityKey)throw Error("entityKey is missing.");
var h=g.qq(B.action.entityKey);h={entityType:h.Gp,entityId:h.entityId,offlineOrchestrationActionType:B.action.actionType,orchestrationAction:{orchestrationActionId:B.actionId}};z&&(h.offlineOrchestrationActionResult=z.status,h.isRetryable=T?!1:z.T,z.Y&&(h.offlineOrchestrationFailureReason=gcs(z.Y,h.isRetryable)));var W,b;if((W=B.action.actionMetadata)==null?0:(b=W.offlineLoggingData)==null?0:b.offlineModeType)h.offlineModeType=B.action.actionMetadata.offlineLoggingData.offlineModeType;R&&(h.additionalOrchestrationActions=
R.map(function(l){return{orchestrationActionId:l.actionId}}));
return h},gcs=function(B,z){return B!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||z?B==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&z?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":B:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},puq=function(B,z){var T={offlineOrchestrationContext:JXK(B)};
z=tNq(z,T);j9R(NW5(),z,B.rootActionId)},$os=function(B,z,T,R){R=R===void 0?[]:R;
z={offlineOrchestrationContext:JXK(B,z,T,R)};z=tNq(3,z);j9R(NW5(),z,B.rootActionId)},Pbc=function(){this.actions=[]},xoK=function(B,z){z=g.d(z);
for(var T=z.next();!T.done;T=z.next())T=T.value,puq(T,1),B.actions.push(T);B.actions.sort(B.T)},vcK=function(B,z){if(z)for(var T=0;T<B.actions.length;T++)if(z==="!*$_ALL_ENTITIES_!*$"&&B.actions[T].actionId!==z||z!=="!*$_ALL_ENTITIES_!*$"&&B.actions[T].rootActionId===z&&B.actions[T].actionId!==z)B.actions.splice(T,1),T--},DoP=function(B,z){B=g.d(B.actions);
for(var T=B.next();!T.done;T=B.next())if(T.value.actionId===z)return!0;return!1},nc=function(B,z,T,R,h){g.K.call(this);
var W=this;this.U=B;this.WD=z;this.TZ=T;this.L=R;this.dF=h;this.T=new Pbc;this.X=new g.Zj;this.Y=new g.Si(function(){W.retry()});
this.J=NaN;this.V=!1;this.Yi={cRZ:function(){return W.T},
GP:function(){return W.X},
rRi:function(){return W.Y},
retry:function(){return W.retry()}};
g.m(this,this.Y);this.N=this.U.observe(this.UE.bind(this))},moR=function(B,z,T,R,h){var W;
return g.D(function(b){if(b.U==1)return W=new nc(B,z,T,R,h),g.P(b,kdc(W),2);KSF(W);return b.return(W)})},KSF=function(B){var z=B.T.actions[0];
return B.W?((z==null?void 0:z.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&B.W[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(B.V=!0),Promise.resolve()):ncq(B)},ncq=function(B){var z,T,R,h,W,b,l,w,q,c,L,C,r,F,A,a,V;
return g.D(function(M){switch(M.U){case 1:if(B.W)throw Error("Already processing an action");if(B.xd())return M.return();z=B.T.actions.shift();bPK(B.TZ,!z);if(z===void 0)return M.return();z.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&z.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&vcK(B.T,z.actionId);T="";z.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&z.rootActionId===z.actionId&&(T=z.actionId);R=[z];B.W=R;if(h=B.WD[z.entityType]){M.jI(2);break}B.W=
void 0;return g.P(M,ncq(B),3);case 3:return M.return();case 2:W=g.d(R);for(b=W.next();!b.done;b=W.next())l=b.value,puq(l,2);g.AK(M,4,5);return g.P(M,Typ(h,R.map(function(x){return x.action})),7);
case 7:w=M.T,q=g.d(R),c=q.next();case 8:if(c.done){M.jI(10);break}L=c.value;C=w.get(L.action);return g.P(M,uM7(B,L,C),9);case 9:c=q.next();M.jI(8);break;case 10:vcK(B.T,T);case 5:g.$r(M);B.W=void 0;g.Pb(M,6);break;case 4:return r=g.JK(M),hP("Orchestration error",r),g.AK(M,12),g.P(M,Hip(B,R),14);case 14:g.yz(M,5);break;case 12:F=g.JK(M);hP("Orchestration retry error",F);A=g.d(R);for(a=A.next();!a.done;a=A.next())V=a.value,V.retryScheduleIndex<3&&xoK(B.T,[V]);M.jI(5);break;case 6:return g.P(M,ncq(B),
0)}})},uM7=function(B,z,T){var R,h,W,b,l,w,q,c,L,C,r,F;
return g.D(function(A){switch(A.U){case 1:R=z.retryScheduleIndex+2===3;if(T.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){A.jI(2);break}if(T.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){A.jI(0);break}$os(z,T,R);if(T.T&&z.retryScheduleIndex+1<3)return g.P(A,Hip(B,[z]),0);W=((h=T)==null?0:h.U)?T.U:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";b={entityKey:z.action.entityKey,failureReason:W};l=void 0;g.Zf(B.dF)?l="mainVideoDownloadStateEntity":g.f0(B.dF)&&(l="musicTrackDownloadMetadataEntity");
if(!l||!T.downloadState){A.jI(7);break}w=g.qq(z.action.entityKey).entityId;return g.P(A,Cc(w,l,B.U,T.downloadState),7);case 7:bV(B.L,b);if(T.downloadState==="DOWNLOAD_STATE_FAILED"&&B.dF.D("html5_auto_retry_failed_pde_actions")){A.jI(0);break}hP("Orchestration result is not retryable, deleting action");return g.P(A,VN7(B.U,dE(z).key),0);case 2:q=void 0;try{q=(c=T.W)==null?void 0:c.map(function(a){return B.createAction(a,z)})}catch(a){return $os(z,T,R),L={entityKey:z.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},bV(B.L,L),hP("Orchestration subactions creation error",a),A.return()}$os(z,T,R,q);if(!q){A.jI(12);break}C=q.map(function(a){return dE(a)});
r=0;case 13:if(!(r<q.length)||B.V){A.jI(15);break}return g.P(A,e7(B.U,{mode:"readwrite",cB:!0},function(a){var V=[];V.push(rRI(a,C.slice(r,r+10),"offlineOrchestrationActionWrapperEntity"));return g.VD.all(V)}),16);
case 16:r+=10;A.jI(13);break;case 15:if(B.V)return B.V=!1,A.return();case 12:return F=dE(z),g.P(A,VN7(B.U,F.key),17);case 17:puq(z,4),g.dX(A)}})},tiK=function(B,z){var T,R,h,W,b,l,w,q,c,L,C,r;
return g.D(function(F){T=[];R=Infinity;h=4E3;W=g.d(z);for(b=W.next();!b.done;b=W.next())l=b.value,w=Number(l.enqueueTimeSec),q=fvI(w),c=l.retryScheduleIndex,L=c!=null&&c>0,q>0&&L?(R=Math.min(R,w),h=Math.min(q,h)):T.push(l);isFinite(R)&&(!B.Y.isActive()||R<B.J)&&(B.J=R,B.Y.start(h));B.X.zO()||(C=T.length,T=T.filter(function(A){var a;A=((a=A.actionProto)==null?void 0:a.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!OiW.includes(A)}),r=T.length<C,!B.Y.isActive()&&r&&B.Y.start(1));
T.length>0&&NyF(B,T);return g.P(F,KSF(B),0)})},Xuq=function(B){var z,T,R,h,W,b,l;
return g.D(function(w){if(w.U==1)return g.P(w,jC5(B),2);z=w.T;T=[];R=g.d(z);for(h=R.next();!h.done;h=R.next())W=h.value,b=g.qq(W.key),l=b.entityId,DoP(B.T,l)||T.push(W);return g.P(w,tiK(B,T),0)})},fvI=function(B){B=B*1E3-Date.now();
return B>4E3?4E3:B},Hip=function(B,z){var T,R,h;
return g.D(function(W){T=g.d(z);for(R=T.next();!R.done;R=T.next()){h=R.value;var b=void 0,l=void 0,w=((l=h.action)==null?void 0:(b=l.actionMetadata)==null?void 0:b.retryScheduleIntervalsInSeconds)||[1,2,4];b=1;h.retryScheduleIndex<w.length&&(b=w[h.retryScheduleIndex]);h.T=b*1E3+Date.now();h.retryScheduleIndex++}return g.P(W,ZiW(B,z),0)})},kdc=function(B){var z;
return g.D(function(T){if(T.U==1)return g.P(T,S7(B.U,"offlineOrchestrationActionWrapperEntity"),2);z=T.T;return g.P(T,tiK(B,z),0)})},NyF=function(B,z){z.length!==0&&z.forEach(function(T){T=G6(T);
T.retryScheduleIndex<3&&xoK(B.T,[T])})},jC5=function(B,z){var T;
return g.D(function(R){if(R.U==1)return g.P(R,S7(B.U,"offlineOrchestrationActionWrapperEntity",z),2);T=R.T;return R.return(T.filter(PcF))})},ZiW=function(B,z){if(z.length===0)return Promise.resolve([]);
z=z.map(function(T){return dE(T)});
return MNg(B.U,z)},e0R=function(B){this.Lf=B;
this.T=void 0},sC5=function(B,z){var T,R,h,W;
return g.D(function(b){T=z.videoId;R=!0;if(z.captionTracks.length)h=i4c(z),B.T=new g.A5(B.Lf,z,h);else if(z.XS)W=g.$Lz(z),B.T=new g.Uk(B.Lf,z.XS,T,W,z.Fo,z.eventId),R=z.Fo;else return b.return();return b.return(new Promise(function(l){var w;(w=B.T)==null||w.nK({pX:function(){return g.D(function(q){if(q.U==1)return g.P(q,B.pX(T,R),2);l();g.dX(q)})},
Mm:function(){}})}))})},Ech=function(B){var z;
return g.D(function(T){if(T.U==1)return g.P(T,KWc(B),2);z=T.T;return T.return(!!z&&z.length>0)})},uV=function(B){g.K.call(this);
this.T=B;this.U=this.T.observe(this.Y.bind(this))},Sw5=function(B,z){var T,R,h,W,b,l,w;
return g.D(function(q){switch(q.U){case 1:if(z.length===0)return q.return([]);T=z.map(function(c){return g.iZ(c,"transfer")});
return g.P(q,S7(B.T,"transfer",T),2);case 2:R=q.T;h=R.filter(PcF).map(function(c){return g.qq(c.key).entityId});
W=z.filter(function(c){return h.indexOf(c)===-1});
if(W.length===0)return q.return([]);b=g.d(W);l=b.next();case 3:if(l.done){q.jI(5);break}w=l.value;return g.P(q,occ(w),4);case 4:l=b.next();q.jI(3);break;case 5:return q.return(W)}})},Twg=function(B,z,T,R,h,W){var b,l,w;
return g.D(function(q){b="STREAM_TYPE_UNKNOWN";T.video&&T.audio?(b="STREAM_TYPE_AUDIO_AND_VIDEO",hP("unexpected stream type")):T.video&&!T.audio?b="STREAM_TYPE_VIDEO":!T.video&&T.audio&&(b="STREAM_TYPE_AUDIO");l=g.iZ(z,"offlineVideoStreams");w={numBytesDownloaded:h.toFixed(),numTotalBytes:W.toFixed(),streamType:b,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(R),itag:b==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(T.itag):void 0};return g.P(q,e7(B,{mode:"readwrite",cB:!0},
function(c){var L=fK(c,l,"offlineVideoStreams"),C=fK(c,g.iZ(z,"transfer"),"transfer");return g.VD.all([L,C]).then(function(r){r=g.d(r);var F=r.next().value;r=r.next().value;if(!r)return j7(c,l).then(function(){});
var A=BwR(F);F=z_s(F,R,w,l);var a=t6(c,F,"offlineVideoStreams");BwR(F)>A&&(r.lastProgressTimeMs=Date.now().toString());A=[a];r.offlineVideoStreams||(r.offlineVideoStreams=[]);r.offlineVideoStreams.indexOf(l)===-1&&(r.offlineVideoStreams.push(l),A.push(t6(c,r,"transfer")));return g.VD.all(A)})}),0)})},R_h=function(B,z){var T,R,h,W,b;
return g.D(function(l){if(l.U==1)return T=g.iZ(z,"offlineVideoStreams"),g.P(l,Ei(B,T,"offlineVideoStreams"),2);R=l.T;if(!R||!R.streamsProgress)return l.return();h=g.d(R.streamsProgress);for(W=h.next();!W.done;W=h.next())b=W.value,b.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",b.numTotalBytes!==b.numBytesDownloaded&&(b.numBytesDownloaded=b.numTotalBytes);return g.P(l,si(B,R,"offlineVideoStreams"),0)})},z_s=function(B,z,T,R){if(B&&B.streamsProgress){R=B;
a:{z=z.itag+";"+z.xtags;for(var h=B.streamsProgress,W=0;W<h.length;W++){var b=JSON.parse(h[W].formatStreamBytes);if(b.itag+";"+b.xtags===z){h[W]=T;T=h;break a}}h.push(T);T=h}R.streamsProgress=T}else B={key:R,streamsProgress:[T]};return B},BwR=function(B){if(B==null?0:B.streamsProgress){var z=0;
B=B.streamsProgress;for(var T=0;T<B.length;T++){var R=B[T];isNaN(Number(R.numBytesDownloaded))?hP("stream progress bytes number invalid"):z+=Number(R.numBytesDownloaded)}return z}return 0},h_W=function(B,z,T,R){g.K.call(this);
var h=this;this.U=B;this.api=z;this.IK=T;this.UE=R;this.X=new g.Zj;this.W=new g.Si(function(){h.T&&h.T.transferState==="TRANSFER_STATE_TRANSFERRING"&&h.X.zO()&&((h.T.transferRetryCount||0)<3?mn(h.L,h.V,!1,!1):Kc(h.L,h.V.videoDetails.videoId),h.N7("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.TZ=this.XE=0;this.N=this.J=!1;this.Kf=g.rk(this.api.K().experiments,"html5_transfer_processing_logs_interval");this.cD=new g.kb(this);this.Yi={p_F:function(){return h.W},
X_J:function(){return h.UE},
GP:function(){return h.X}};
this.WD=this.U.observe(this.H9.bind(this));this.L=new rXR(z,this);this.sE=new e0R(z);this.RK=new uV(this.U);this.lO=this.X.listen("publicytnetworkstatus-online",this.wZ.bind(this));this.zZ=this.X.listen("publicytnetworkstatus-offline",this.kYu.bind(this));this.N=this.api.K().D("html5_less_transfer_processing_logs");g.m(this,this.cD);this.cD.Z(z,"offlinetransferpause",this.a4u);g.Zf(this.api.K())?this.Y="mainVideoDownloadStateEntity":g.f0(this.api.K())&&(this.Y="musicTrackDownloadMetadataEntity")},
Wh7=function(B){return g.D(function(z){if(z.U==1)z=g.P(z,DWU(),2);
else{var T=B.RK;var R=g.Jb();R=Object.keys(R);T=Sw5(T,R);z=g.P(z,T,0)}return z})},fc=function(B,z){z=z===void 0?!1:z;
var T;return g.D(function(R){if(R.U==1){if(B.T)throw Error("Already downloading a video");B.TZ=0;B.J=!1;return g.P(R,b2I(B),2)}return R.U!=4?(T=R.T,Y7g(B.IK,!T),T&&B.X.zO()?z?g.P(R,new Promise(function(h){g.FN(h,1E3)}),4):R.jI(4):(!T&&B.T&&H9(B),R.jI(0))):g.P(R,Yqq(B,T),0)})},lIU=function(B){return g.D(function(z){if(z.U==1)return B.V?g.P(z,Kc(B.L,B.V.videoDetails.videoId),3):z.jI(0);
H9(B);g.dX(z)})},wiP=function(B,z){var T,R,h;
return g.D(function(W){switch(W.U){case 1:return g.AK(W,2),(T=!!z.captionTracks.length||!!z.XS)?g.P(W,Ech(z.videoId),4):W.return();case 4:return(R=W.T)?W.return():g.P(W,sC5(B.sE,z),5);case 5:g.yz(W,0);break;case 2:h=g.JK(W),hP("Caption downloading error",h,z.cotn),g.dX(W)}})},Yqq=function(B,z){var T,R,h,W,b,l;
return g.D(function(w){switch(w.U){case 1:if(B.J)return w.return();B.J=!0;B.T=z;T=g.qq(B.T.key);R=T.entityId;h=void 0;if(B.T.transferState==="TRANSFER_STATE_TRANSFERRING")return g.P(w,Om(B,R),7);if(B.T.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||B.T.transferRetryCount||B.T.hasLoggedFirstStarted){w.jI(3);break}return g.P(w,Om(B,R),5);case 5:return h=w.T,B.T.hasLoggedFirstStarted=!0,g.P(w,qq7(B),6);case 6:w1K({videoId:R,gI:B.T,offlineModeType:h},void 0,void 0,!0);w.jI(3);break;case 7:h=w.T,
wE({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:R,gI:B.T,offlineModeType:h});case 3:return g.P(w,i25(B),8);case 8:return W=null,g.AK(w,9),g.P(w,cnP(B,z),11);case 11:W=w.T;B.V=W;g.yz(w,10);break;case 9:return b=g.JK(w),hP("error getting player response",b,z.cotn),g.P(w,B.N7("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return w.return();case 10:return l=oas(B.api.K(),z.cotn,W),g.P(w,wiP(B,l),13);case 13:return g.P(w,FSP(l.videoId),
14);case 14:l.OI=w.T,AXW(B.L,l,z.maximumDownloadQuality),B.W.start(108E5),g.dX(w)}})},b2I=function(B){var z,T;
return g.D(function(R){if(R.U==1)return g.P(R,S7(B.U,"transfer"),2);z=R.T;T=z.filter(Lhs).sort(CH5);return T.length===0?R.return():R.return(T[0])})},i25=function(B){var z,T,R;
return g.D(function(h){if(h.U==1){if(!B.T)return NA(B,"onTransferStart"),h.return();B.W.start(108E5);return g.P(h,tP(B,"TRANSFER_STATE_TRANSFERRING"),2)}z=B.T;return(R=((T=z)==null?0:T.key)?g.qq(z.key).entityId:"")&&B.Y?g.P(h,Cc(R,B.Y,B.U,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):h.jI(0)})},Gd7=function(B){var z,T,R,h;
g.D(function(W){switch(W.U){case 1:if(!B.T){NA(B,"onTransferPausedByUser");W.jI(2);break}z=B.T;B.W.stop();return g.P(W,tP(B,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:R=((T=z)==null?0:T.key)?g.qq(z.key).entityId:"";if(!R||!B.Y){W.jI(4);break}return g.P(W,Cc(R,B.Y,B.U,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.P(W,Om(B,R),6);case 6:h=W.T,iPK({videoId:R,gI:z,offlineModeType:h});case 2:H9(B),fc(B),g.dX(W)}})},doU=function(B){var z,T,R;
g.D(function(h){if(h.U==1){if(!B.T)return NA(B,"onTransferPausedByNetwork"),h.return();B.W.stop();return g.P(h,tP(B,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(h.U!=3)return z=B.T,(R=((T=z)==null?0:T.key)?g.qq(z.key).entityId:"")&&B.Y?g.P(h,Cc(R,B.Y,B.U,"DOWNLOAD_STATE_PAUSED"),3):h.jI(3);H9(B);g.dX(h)})},rnp=function(B){var z,T,R,h,W;
g.D(function(b){switch(b.U){case 1:if(!B.T)return NA(B,"onTransferComplete"),b.return();z=B.T;B.W.stop();if(!z||!B.V){b.jI(2);break}T=oas(B.api.K(),z.cotn,B.V);return g.P(b,wiP(B,T),2);case 2:return g.P(b,tP(B,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:h=((R=z)==null?0:R.key)?g.qq(z.key).entityId:"";if(!h||!B.Y){b.jI(5);break}return g.P(b,Cc(h,B.Y,B.U,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.P(b,R_h(B.U,h),7);case 7:return g.P(b,Om(B,h),8);case 8:W=b.T,wE({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:h,gI:z,offlineModeType:W}),H9(B),fc(B),g.dX(b)}})},oes=function(B,z,T){var R,h;
g.D(function(W){switch(W.U){case 1:if(!B.T)return NA(B,"onTransferProgress: "+z),W.return();if(B.T.transferState==="TRANSFER_STATE_TRANSFERRING"){W.jI(2);break}return g.P(W,i25(B),2);case 2:R=Date.now();if(!(R-B.XE>1E3)){W.jI(4);break}B.XE=R;return g.P(W,Twg(B.U,T.videoId,T.U,T.fd,T.bytesDownloaded,T.T),5);case 5:if(B.N&&!(B.N&&R-B.TZ>B.Kf)){W.jI(4);break}B.TZ=R;return g.P(W,Om(B,z),7);case 7:h=W.T,w1K({videoId:z,gI:B.T,offlineModeType:h},T.bytesDownloaded,T.T);case 4:B.W.start(108E5),g.dX(W)}})},
Fhg=function(B){var z=(B.T.transferRetryCount||0)<3;
z&&(B=B.T,B.transferRetryCount=(B.transferRetryCount||0)+1);return z},IIU=function(B,z){z=z===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":z;
var T,R,h,W;return g.D(function(b){if(b.U==1)return B.T||NA(B,"setTransferToFailed: "+z),T="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",z==="TRANSFER_FAILURE_REASON_NETWORK"?T="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":z==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(T="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.P(b,tP(B,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",z),2);if(b.U!=3)return bV(B.UE,{entityKey:(R=B.T)==null?void 0:R.key,failureReason:T}),
h=B.T?g.qq(B.T.key).entityId:"",g.P(b,Om(B,h),3);W=b.T;var l={videoId:h,gI:B.T,offlineModeType:W},w=z,q={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};w&&(q.transferFailureReason=w,q.failureReason=cGh(w));wE(q,l);g.dX(b)})},tP=function(B,z,T,R){var h;
return g.D(function(W){if(W.U==1){if(!B.T)return NA(B,"saveTransferState: "+z),W.return();B.T.transferState=z;B.T.failureReason=R;g.AK(W,2);return g.P(W,qq7(B,function(b){return T?Oi(b,"offlineVideoStreams",B.T.offlineVideoStreams).then(function(l){for(var w=g.d(l),q=w.next();!q.done;q=w.next())if((q=q.value)&&q.streamsProgress){q=g.d(q.streamsProgress);for(var c=q.next();!c.done;c=q.next())c.value.streamState=T}return rRI(b,l.filter(function(L){return!!L}),"offlineVideoStreams")}):g.VD.resolve(void 0)}),
4)}if(W.U!=2)return g.yz(W,0);
h=g.JK(W);return h instanceof g.Ih&&h.type==="QUOTA_EXCEEDED"?g.P(W,B.N7("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):W.jI(0)})},qq7=function(B,z){var T;
return g.D(function(R){if(!B.T)return R.return();T=B.T;return g.P(R,e7(B.U,{mode:"readwrite",cB:!0},function(h){var W=[t6(h,T,"transfer")];z&&W.push(z(h));return g.VD.all(W)}),0)})},H9=function(B){B.T=void 0;
B.V=void 0;B.W.stop()},cnP=function(B,z){var T,R,h,W,b;
return g.D(function(l){if(l.U==1)return T=g.qq(z.key),R=T.entityId,h=g.iZ(R,"playbackData"),g.P(l,Ei(B.U,h,"playbackData"),2);W=l.T;if((b=W)==null?0:b.playerResponseJson)return l.return(JSON.parse(W.playerResponseJson));throw Error("No PlayerResponse found");})},NA=function(B,z){B.api.OE("woffle",{mcte:z});
hP("missing current transfer entity.")},Om=function(B,z){var T,R,h;
return g.D(function(W){if(W.U==1)return g.P(W,Ei(B.U,g.iZ(z,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);T=W.T;return W.return((h=(R=T)==null?void 0:R.offlineModeType)!=null?h:void 0)})},Lhs=function(B){return GEP[B.transferState]!==void 0},CH5=function(B,z){var T=GEP[B.transferState],R=GEP[z.transferState];
return T!==R?T-R:Number(B.enqueuedTimestampMs)-Number(z.enqueuedTimestampMs)},ju=function(B,z){var T=this;
this.dF=B;this.api=z;this.X=new g.Zj;this.V=new g.CP;this.Yi={IY:function(){return T.Y.Yi.IY()},
GP:function(){return T.X},
VGE:function(){return T.Y},
bA:function(){return T.bA()},
Sq:function(){return T.Sq()},
eq:function(){return T.eq()},
wr:function(){return T.wr()},
Ce:function(){return T.Ce()},
N2:function(R){return T.N2(R)}};
this.Y=new RMU(function(){return dvg(T)},function(){T.eq()},this.api.Jf(),this.api.D.bind(this.api));
this.T=new W9(this.api);hMg(this.Y)},dvg=function(B){return g.D(function(z){B.api.uO("onOrchestrationBecameLeader");
return g.P(z,B.Sq(),0)})},aI7=function(B){var z,T;
return g.D(function(R){if(R.U==1)return g.P(R,B9(),2);if(R.U!=3){z=R.T;if(!z)return hP("PES is undefined"),R.return();B.U=new h_W(z,B.api,B.Y,B.T);T=B.J4(z);return g.P(R,moR(z,T,B.Y,B.T,B.dF),3)}B.L=R.T;return g.P(R,Anq(B),0)})},Anq=function(B){var z;
return g.D(function(T){switch(T.U){case 1:if(!B.U)return hP("transferManager is undefined"),T.return();if(B.U.T){T.jI(2);break}return g.P(T,fc(B.U),2);case 2:if(!B.dF.D("woffle_enable_main_downloads_library")){T.jI(4);break}return g.P(T,B.Ie(),4);case 4:if(!B.dF.D("html5_offline_playback_position_sync")){T.jI(6);break}return g.P(T,B.UV(),7);case 7:return g.P(T,B.N2(864E5),6);case 6:return g.P(T,B.refreshAllStaleEntities(43200,!0),9);case 9:return g.P(T,B.Nu(),10);case 10:if(!B.dF.D("html5_retry_downloads_for_expiration")){T.jI(11);
break}return g.P(T,B.Ce(),11);case 11:return B.J=g.Ic(function(){B.refreshAllStaleEntities(43200,!0);B.Nu()},9E5),g.B4(g.To(),function(){return B.wr()}),g.P(T,B9(),13);
case 13:return z=T.T,g.P(T,TUc(z),14);case 14:WgP(B.Y),g.dX(T)}})},UvP=function(){var B,z,T,R,h,W;
return g.D(function(b){switch(b.U){case 1:return g.P(b,B9(),2);case 2:B=b.T;if(!B)return b.return([]);z=Date.now()/1E3;return g.P(b,S7(B,"offlineVideoPolicy"),3);case 3:T=b.T,R=g.d(T),h=R.next();case 4:if(h.done){b.jI(6);break}W=h.value;if(!(W.expirationTimestamp&&Number(W.expirationTimestamp)<z)){b.jI(5);break}W.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";W.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.P(b,si(B,W,"offlineVideoPolicy"),5);
case 5:h=R.next();b.jI(4);break;case 6:return b.return(T.map(function(l){return l.key}))}})},Xg=function(B,z,T,R,h){var W,b,l;
return g.D(function(w){if(w.U==1)return g.P(w,B9(),2);W=w.T;if(!W)return w.return([]);b=z.map(function(q){var c=g.iZ(q,T);c={actionType:R,entityKey:c,actionMetadata:Object.assign({},FgU(),h)};R!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(c.actionMetadata.priority=0);q=new IO(T,q,c);return dE(q)});
l=MNg(W,b);hMg(B.Y);return w.return(l)})},MWp=function(B,z,T,R){var h,W,b,l,w,q,c,L;
return g.D(function(C){switch(C.U){case 1:h=[],W=g.d(z),b=W.next();case 2:if(b.done){C.jI(4);break}l=b.value;if(l.upToDate||T&&!l.shouldAutoSyncMetadata||!l.playlistId){C.jI(3);break}w={};switch(R){case "mainPlaylistEntity":q={nextAutoRefreshIntervalSeconds:l.checkInSeconds,autoSync:T};w={mainPlaylistEntityActionMetadata:q};break;case "musicPlaylist":c={autoSync:T},w={musicPlaylistEntityActionMetadata:c}}return g.P(C,Xg(B,[l.playlistId],R,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",w),6);case 6:(L=
C.T)&&h.push.apply(h,g.Q(L));case 3:b=W.next();C.jI(2);break;case 4:return C.return(h)}})},VWW=function(B,z){var T;
return g.D(function(R){return z.length?(T=FgU(),g.YZ(T,DC,{isEnqueuedForExpiredStreamUrlRefetch:!0}),B.api.OE("qrd",{v:z.length}),R.return(Xg(B,z,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",T))):R.return([])})},Qmh=function(B,z,T){this.T=B;
this.dF=z;this.Y=T},JnK=function(B,z){var T,R,h,W,b,l,w,q,c,L,C,r,F,A,a,V,M;
return g.D(function(x){switch(x.U){case 1:return T=qA(z),R=g.qq(z.entityKey),h=R.entityId,W=[],g.AK(x,2),g.P(x,ynF(B,h),4);case 4:W=x.T;if(!(B.dF.D("woffle_enable_main_downloads_library")&&((b=W)==null?0:b.length))){x.jI(5);break}return g.P(x,p1g(B.T,[z.entityKey]),5);case 5:g.yz(x,3);break;case 2:return l=g.JK(x),w="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",l instanceof g.Ih&&l.type==="QUOTA_EXCEEDED"?(w="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):hP("Playlist add error"),x.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",T,void 0,w,q));case 3:c=[];if(!B.dF.D("html5_offline_prevent_redownload_downloaded_video")){x.jI(7);break}return g.P(x,rGP(B.T,"mainVideoEntity",W),8);case 8:W=x.T;case 7:if((L=W)==null?0:L.length)for(C=g.d(W),r=C.next();!r.done;r=C.next())if(F=r.value,A=F.offlineVideoData,a=void 0,(a=A)==null?0:a.videoId)V=void 0,M=Number(((V=z.actionMetadata)==null?void 0:V.priority)||
0)+1,c.push(xG("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",A.videoId,"mainVideoEntity",M,ZC,ge5(z,A,h)));return x.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",T,c))}})},$vF=function(B,z){var T,R,h,W,b,l,w,q,c,L,C,r,F,A,a,V,M,x,v,n,Z,N,TP,hK,zP,ld,t,UH,Qz,vb,AI,lW,gX,Vz,hI,U,Yr,tI,Av,gF,rF,mB,v7,JI,y,J,p,k,H,az,Bb,Iz,Rz,p5,el,Up,aP,Ph,OO,jz,Na,GB,q1,Jp,oA,pJ,NF,tl,QX,h2,t4,Wh,gy,Xx;
return g.D(function(r1){switch(r1.U){case 1:return T=qA(z),R=z.entityKey,h=g.qq(R).entityId,W=[],b=!1,h==="!*$_ALL_ENTITIES_!*$"?(b=!0,g.P(r1,S7(B.T,"mainPlaylistEntity"),5)):g.P(r1,Ei(B.T,R,"mainPlaylistEntity"),4);case 4:(l=r1.T)&&W.push(l);r1.jI(3);break;case 5:W=r1.T;case 3:if((w=W)==null||!w.length)return r1.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",T));q=g.u(z.actionMetadata,pi7);L=(c=q)==null?void 0:c.nextAutoRefreshIntervalSeconds;r=(C=q)==null?void 0:C.autoSync;F=[];a=A=
!0;V=!1;if(!b&&r===!1){r1.jI(6);break}g.AK(r1,7);return g.P(r1,NUc(0,!!r,!0,W),9);case 9:F=r1.T;g.yz(r1,8);break;case 7:M=g.JK(r1);if(!(M instanceof Error&&M.message==="No data")){M instanceof Error&&M.message==="Empty response body"&&hP(M.message);r1.jI(8);break}return h==="!*$_ALL_ENTITIES_!*$"?g.P(r1,MQp(B.T,z,B.Y,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.P(r1,acR(h,B.T,z,B.Y),8);case 8:if(!F.length||!b&&F[0].playlistId!==h)return r1.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
T));case 6:if(b){x=[];v=g.d(F);for(n=v.next();!n.done;n=v.next())Z=n.value,Z.upToDate||r&&!Z.shouldAutoSyncMetadata||!Z.playlistId||(N={nextAutoRefreshIntervalSeconds:Z.checkInSeconds,autoSync:r},x.push(xG("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Z.playlistId,"mainPlaylistEntity",0,ZC,{mainPlaylistEntityActionMetadata:N})));return r1.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",T,x))}F.length&&(TP=F[0],V=!!TP.upToDate,r&&(A=(hK=TP.shouldAutoSyncMetadata)!=null?hK:!0,a=(zP=TP.shouldAutoSyncVideos)!=
null?zP:!0,TP.checkInSeconds&&(L=TP.checkInSeconds)));if(V||!A)return r1.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",T));ld=[];t=W[0];if(!t.downloadState){UH=void 0;r1.jI(15);break}return g.P(r1,Ei(B.T,t.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:UH=r1.T;case 15:return Qz=UH,AI=((vb=Qz)==null?0:vb.addedTimestampMillis)?String(Qz.addedTimestampMillis):void 0,g.AK(r1,17),g.P(r1,ynF(B,h,AI,L),19);case 19:ld=r1.T;g.yz(r1,18);break;case 17:lW=g.JK(r1);if(!(lW instanceof
Error&&lW.message==="No data for playlist")){if(lW instanceof Error&&lW.message==="Empty response body for playlist")hP(lW.message);else return gX="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Vz="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",lW instanceof g.Ih&&lW.type==="QUOTA_EXCEEDED"&&(gX="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Vz="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),r1.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",T,void 0,gX,Vz));
r1.jI(18);break}return g.P(r1,acR(h,B.T,z,B.Y),18);case 18:if(!a)return r1.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",T));hI=[];U=new Map;if((Yr=ld)==null?0:Yr.length)for(tI=g.d(ld),Av=tI.next();!Av.done;Av=tI.next())gF=Av.value,rF=gF.offlineVideoData,mB=void 0,((mB=rF)==null?0:mB.videoId)&&U.set(rF.videoId,rF);v7=new Map;JI=[];if((y=t)==null?0:(J=y.videos)==null?0:J.length)for(p=g.d(t.videos),k=p.next();!k.done;k=p.next())if(H=k.value,az=JSON.parse(g.qq(H).entityId),Bb=az.videoId)U.has(Bb)?
(v7.set(Bb,U.get(Bb)),U.delete(Bb)):JI.push(Bb);Rz=Number(((Iz=z.actionMetadata)==null?void 0:Iz.priority)||0)+1;p5=g.d(U.entries());for(el=p5.next();!el.done;el=p5.next())Up=el.value,aP=g.d(Up),Ph=aP.next().value,OO=aP.next().value,jz=Ph,Na=OO,hI.push(xG("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",jz,"mainVideoEntity",Rz,ZC,ge5(z,Na,h)));GB=g.d(v7.entries());for(q1=GB.next();!q1.done;q1=GB.next())Jp=q1.value,oA=g.d(Jp),pJ=oA.next().value,NF=oA.next().value,tl=pJ,QX=NF,hI.push(xG("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
tl,"mainVideoEntity",Rz,ZC,ge5(z,QX,h)));h2=g.d(JI);for(t4=h2.next();!t4.done;t4=h2.next())Wh=t4.value,gy={playlistId:h},Xx={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:gy},hI.push(xG("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Wh,"mainVideoEntity",0,ZC,Xx));return r1.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",T,hI))}})},PHq=function(B,z){var T,R,h,W;
return g.D(function(b){switch(b.U){case 1:return T=qA(z),g.AK(b,2),R=g.qq(z.entityKey).entityId,R==="!*$_ALL_ENTITIES_!*$"?g.P(b,MQp(B.T,z,B.Y,(h=z.actionMetadata)==null?void 0:(W=h.offlineLoggingData)==null?void 0:W.offlineDeleteReason),5):g.P(b,acR(R,B.T,z,B.Y),6);case 6:if(!B.dF.D("woffle_enable_main_downloads_library")){b.jI(5);break}return g.P(b,$8W(B.T,z.entityKey),5);case 5:g.yz(b,3);break;case 2:return g.JK(b),b.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",T,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return b.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",T))}})},ynF=function(B,z,T,R){var h,W,b,l,w,q,c;
return g.D(function(L){switch(L.U){case 1:return g.P(L,fcs([z]),2);case 2:return h=L.T,g.P(L,xvc(B,h[0],T,R),3);case 3:return W=L.T,b=W.mainPlaylistEntity,l=W.ggJ,q=d8I(b,(w=l)==null?void 0:w.avatar),g.AK(L,4),g.P(L,aO(q),6);case 6:g.yz(L,5);break;case 4:c=g.JK(L),c instanceof Error&&c.message==="Failed to fetch"&&hP(c.message);case 5:return L.return(h[0].videos)}})},xvc=function(B,z,T,R){var h,W,b,l,w,q,c,L,C,r,F,A,a,V,M,x,v;
return g.D(function(n){switch(n.U){case 1:h=Date.now().toString();T||(T=h);W=z.videos;b=z.playlistId;l=[];w=[];if(W)for(q=g.d(W),c=q.next();!c.done;c=q.next()){L=c.value;C=L.offlineVideoData;if(!C||!C.videoId)throw hP("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");r=C.videoId;F={videoId:r,playlistId:b};A={id:g.iZ(JSON.stringify(F),"mainPlaylistVideoEntity"),video:g.iZ(r,"mainVideoEntity")};l.push(A);w.push(A.id)}V={key:g.iZ(b,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:T,lastSyncedTimestampMillis:h};M={key:g.iZ(b,"mainPlaylistEntity"),playlistId:b,videos:w,title:z.title,thumbnailStyleData:veg(z),visibility:DvI(z),downloadState:V.key};z.channel&&(x=z.channel.offlineChannelData,a=kEI(g.iZ(b,"ytMainChannelEntity"),x),M.channelOwner=a.id);((v=M)==null?0:v.entityMetadata)?(M.entityMetadata.offlineLastModifiedTimestampSeconds=z.lastModifiedTimestamp,R&&(M.entityMetadata.nextAutoRefreshIntervalSeconds=String(R))):M&&(M.entityMetadata={nextAutoRefreshIntervalSeconds:R?
String(R):void 0,offlineLastModifiedTimestampSeconds:z.lastModifiedTimestamp});g.AK(n,2);return g.P(n,e7(B.T,{mode:"readwrite",cB:!0},function(Z){var N=t6(Z,M,"mainPlaylistEntity"),TP=t6(Z,V,"mainPlaylistDownloadStateEntity");N=[N,TP];TP=g.d(l);for(var hK=TP.next();!hK.done;hK=TP.next())N.push(t6(Z,hK.value,"mainPlaylistVideoEntity"));a&&N.push(t6(Z,a,"ytMainChannelEntity"));return g.VD.all(N)}),4);
case 4:g.yz(n,3);break;case 2:throw g.JK(n),hP("PES failure for playlist"),Error("PES failure for playlist");case 3:return n.return({mainPlaylistEntity:M,ggJ:a,sDi:l})}})},kEI=function(B,z){return{id:B,
channelId:z.channelId,title:z.title,avatar:z.thumbnail}},veg=function(B){var z=[],T=B.videos;
T&&T.length>0&&z.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:T[0].offlineVideoData.thumbnail}}});if((B=B.additionalMetadadatas)&&B.length>0)for(B=g.d(B),T=B.next();!T.done;T=B.next()){var R=T.value.offlineBundleItemPlaylistData,h=void 0;T=(h=R)==null?void 0:h.style;h=void 0;R={collageThumbnail:{coverThumbnail:(h=R)==null?void 0:h.coverThumbnail}};switch(T){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":z.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:R});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":z.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:R});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":z.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:R});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":z.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:R})}}return z},DvI=function(B){switch(B.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},ge5=function(B,z,T){z={offlineVideoData:z,
playlistId:T};if(B=g.u(B.actionMetadata,pi7))z.maximumDownloadQuality=B.maximumDownloadQuality;return{mainVideoEntityActionMetadata:z}},KhP=function(B,z,T){this.T=B;
this.dF=z;this.Y=T},ufh=function(B,z){var T,R,h,W,b,l,w,q,c,L,C,r,F;
return g.D(function(A){switch(A.U){case 1:return T=qA(z),R=g.qq(z.entityKey),h=R.entityId,W=g.u(z.actionMetadata,eu),l=!((b=W)==null?0:b.playlistId),g.AK(A,2),g.P(A,mvq(B,h,void 0,(w=W)==null?void 0:w.offlineVideoData,l),4);case 4:g.yz(A,3);break;case 2:return q=g.JK(A),c="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",L="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",q instanceof g.Ih&&q.type==="QUOTA_EXCEEDED"&&(c="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",L="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
A.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",T,void 0,c,L));case 3:C=1;C=Number(((r=z.actionMetadata)==null?void 0:r.priority)||0)+1;var a=(a=g.u(z.actionMetadata,eu))?{playbackDataActionMetadata:{maximumDownloadQuality:a.maximumDownloadQuality}}:void 0;F=xG("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",h,"playbackData",C,neK,a);return A.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",T,[F]))}})},H2F=function(B,z){var T,R,h,W,b,l,w,q,c,L,C,r,F,A,a,V,M;
return g.D(function(x){switch(x.U){case 1:return T=qA(z),R=g.qq(z.entityKey),h=R.entityId,g.P(x,Ei(B.T,z.entityKey,"mainVideoEntity"),2);case 2:W=x.T;if(!W){b=void 0;x.jI(3);break}return g.P(x,Ei(B.T,W.downloadState,"mainVideoDownloadStateEntity"),4);case 4:b=x.T;case 3:l=b;if(!W||!l)return x.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",T));g.AK(x,5);return g.P(x,mvq(B,h,l.addedTimestampMillis,(q=g.u(z.actionMetadata,eu))==null?void 0:q.offlineVideoData),7);case 7:c=1;c=Number(((L=
z.actionMetadata)==null?void 0:L.priority)||0)+1;w=xG("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",h,"playbackData",c,neK);g.yz(x,6);break;case 5:C=g.JK(x);if(!(C instanceof Error&&C.message==="No data")){if(C instanceof Error&&C.message==="Empty response body")hP(C.message);else return r="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",F="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",C instanceof g.Ih&&C.type==="QUOTA_EXCEEDED"&&(r="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
F="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),x.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",T,void 0,r,F));x.jI(6);break}return g.P(x,Vo(B.T,h),9);case 9:A=x.T;a=g.u(z.actionMetadata,eu);if(M=(V=a)==null?void 0:V.playlistId)A.playlistId=M;A.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.P(x,Um(h,B.T,z,B.Y,A),6);case 6:return x.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",T,w?[w]:void 0))}})},fIs=function(B,z){var T,R,h,W,b,l,w,q,c,L;
return g.D(function(C){switch(C.U){case 1:return T=qA(z),g.AK(C,2),R=g.qq(z.entityKey).entityId,R==="!*$_ALL_ENTITIES_!*$"?g.P(C,MQp(B.T,z,B.Y,(c=z.actionMetadata)==null?void 0:(L=c.offlineLoggingData)==null?void 0:L.offlineDeleteReason),5):g.P(C,Vo(B.T,R),6);case 6:h=C.T;W=g.u(z.actionMetadata,eu);if(l=(b=W)==null?void 0:b.playlistId)h.playlistId=l;h.offlineDeleteReason=(w=z.actionMetadata)==null?void 0:(q=w.offlineLoggingData)==null?void 0:q.offlineDeleteReason;return g.P(C,Um(R,B.T,z,B.Y,h),7);
case 7:if(!B.dF.D("woffle_enable_main_downloads_library")){C.jI(5);break}return g.P(C,$8W(B.T,z.entityKey),5);case 5:g.yz(C,3);break;case 2:return g.JK(C),C.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",T,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return C.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",T))}})},mvq=function(B,z,T,R,h){var W,b,l,w,q,c;
return g.D(function(L){switch(L.U){case 1:if(W=R){L.jI(2);break}return g.P(L,HPU([z]),3);case 3:b=L.T,W=b[0];case 2:return g.P(L,O2s(B,W,T,h),4);case 4:l=L.T;w=l.mainVideoEntity;q=l.channelEntity;g.AK(L,5);var C=Fg(w.thumbnail),r=Fg(q.avatar);return g.P(L,aO(C.concat(r)),7);case 7:g.yz(L,0);break;case 5:c=g.JK(L),c instanceof Error&&c.message==="Failed to fetch"&&hP(c.message),g.dX(L)}})},O2s=function(B,z,T,R){var h,W,b,l,w,q,c,L,C,r,F,A,a;
return g.D(function(V){switch(V.U){case 1:T||(T=Date.now().toString());W=(h=z.channel)==null?void 0:h.offlineChannelData;b={id:g.iZ(z.videoId,"ytMainChannelEntity"),channelId:W.channelId,title:W.title,avatar:W.thumbnail};l={key:g.iZ(z.videoId,"mainVideoDownloadStateEntity"),playbackData:g.iZ(z.videoId,"playbackData"),addedTimestampMillis:T,videoDownloadContextEntity:g.iZ(z.videoId,"videoDownloadContextEntity")};w={key:g.iZ(z.videoId,"videoPlaybackPositionEntity"),videoId:z.videoId,lastPlaybackPositionSeconds:"0"};
B.dF.D("html5_offline_playback_position_sync")&&(q={playbackPosition:w.key});c=g.iZ(z.videoId,"mainVideoEntity");L={key:c,videoId:z.videoId,title:z.title,thumbnail:z.thumbnail,localizedStrings:{viewCount:z.shortViewCountText},userState:q,lengthSeconds:z.lengthSeconds?Number(z.lengthSeconds):void 0,publishedTimestampMillis:z.publishedTimestamp?(Number(z.publishedTimestamp)*1E3).toString():void 0,formattedDescription:z.description,owner:b.id,downloadState:l.key};if(!B.dF.D("woffle_enable_main_downloads_library")||
!R){V.jI(2);break}return g.P(V,JGW(B.T,[c]),3);case 3:if(F=V.T)C=F.mainDownloadsLibraryEntity,r=F.mainDownloadsListEntity;case 2:return a=C8U,A={key:g.iZ(z.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.YZ(l,a,A),g.P(V,e7(B.T,{mode:"readwrite",cB:!0},function(M){var x=t6(M,b,"ytMainChannelEntity"),v=t6(M,l,"mainVideoDownloadStateEntity"),n=t6(M,L,"mainVideoEntity");x=[x,v,n];B.dF.D("html5_offline_playback_position_sync")&&(v=t6(M,w,"videoPlaybackPositionEntity"),
x.push(v));C&&(v=t6(M,C,"mainDownloadsLibraryEntity"),x.push(v));r&&(v=t6(M,r,"mainDownloadsListEntity"),x.push(v));A&&(M=t6(M,A,"downloadStatusEntity"),x.push(M));return g.VD.all(x)}),4);
case 4:return V.return({mainVideoEntity:L,channelEntity:b})}})},Nwq=function(B,z,T){this.T=B;
this.dF=z;this.Y=T},jm5=function(B,z){var T,R,h,W,b,l,w,q,c,L,C,r,F,A,a,V,M,x,v,n,Z,N,TP,hK,zP,ld,t;
return g.D(function(UH){switch(UH.U){case 1:return T=qA(z),R=[],g.P(UH,nK.getInstance(),2);case 2:h=UH.T;if(!h){UH.jI(3);break}return g.P(UH,h.get("sdois"),4);case 4:return W=UH.T,g.P(UH,(l=h)==null?void 0:l.get("lmqf"),5);case 5:b=UH.T;case 3:g.AK(UH,6);if(W===void 0)throw Error("prefStorage or opt-in state is undefined");w=[];if(W){UH.jI(8);break}return g.P(UH,gaP(B.T),9);case 9:w=UH.T,w.reverse();case 8:if(!w.length){UH.jI(10);break}q=g.d(w);c=q.next();case 11:if(c.done){UH.jI(10);break}L=c.value;
if(!L){UH.jI(12);break}C=g.qq(L).entityId;return g.P(UH,Vo(B.T,C),14);case 14:return r=UH.T,r.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.P(UH,Um(C,B.T,{entityKey:L,actionType:z.actionType},B.Y,r),12);case 12:c=q.next();UH.jI(11);break;case 10:return g.P(UH,js7(W,(F=b)!=null?F:"SD"),16);case 16:return A=UH.T,g.P(UH,VQ7(A),17);case 17:a=yGR(A);if(!B.dF.D("woffle_enable_main_downloads_library")){UH.jI(18);break}if(W){UH.jI(19);break}return g.P(UH,$8W(B.T,g.vA),19);case 19:return g.P(UH,
p1g(B.T,[g.vA]),18);case 18:if((V=a)==null?0:V.length)for(M=g.d(a),x=M.next();!x.done;x=M.next())if(n=v=x.value,Z=n.actionType,N=n.entityKey,TP=n.actionMetadata,Z&&N&&TP&&!g.u(TP,tWp)){Z==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(TP.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(hK=g.u(v.actionMetadata,eu))hK.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",v.actionMetadata=Object.assign({},v.actionMetadata,{mainVideoEntityActionMetadata:hK});R.push(v)}g.yz(UH,
7);break;case 6:return zP=g.JK(UH),ld="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",zP instanceof g.Ih&&zP.type==="QUOTA_EXCEEDED"&&(ld="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),UH.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",T,void 0,ld,t));case 7:return UH.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",T,R))}})},XiI=function(){ju.apply(this,
arguments);
this.N="mainVideoEntity"},Z2p=function(B,z,T){z=z===void 0?43200:z;
T=T===void 0?!0:T;var R=R===void 0?!1:R;var h,W,b;return g.D(function(l){switch(l.U){case 1:if(!B.X.zO())return l.return([]);h=[];g.AK(l,2);return g.P(l,NUc(z,T,R),4);case 4:h=l.T;g.yz(l,3);break;case 2:W=g.JK(l),W instanceof Error&&W.message==="No data"||W instanceof Error&&W.message==="Empty response body"&&hP(W.message);case 3:return b=MWp(B,h,T,"mainPlaylistEntity"),l.return(b)}})},e_p=function(B,z,T,R){R=R===void 0?!1:R;
var h,W,b,l,w,q,c,L,C,r,F,A,a,V,M;return g.D(function(x){switch(x.U){case 1:return h=[],g.P(x,tQI(),2);case 2:return(W=x.T)||R?g.P(x,X1g(z,T),3):x.return([]);case 3:b=x.T;if((l=b)==null||!l.length)return x.return([]);w={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};q=g.d(b);c=q.next();case 4:if(c.done){x.jI(6);break}C=L=c.value;r=C.actionType;F=C.entityKey;A=C.actionMetadata;if(!(r&&F&&A)||g.u(A,tWp)){x.jI(5);break}r==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(A.offlineLoggingData=
w);a=g.qq(F);V=a.entityId;return g.P(x,Xg(B,[V],"mainVideoEntity",r,A),8);case 8:M=x.T,h=h.concat(M);case 5:c=q.next();x.jI(4);break;case 6:return x.return(h)}})},smW=function(B,z){this.T=B;
this.Y=z},Sqh=function(B,z){var T,R,h,W,b,l,w,q,c,L,C,r,F,A,a,V;
return g.D(function(M){switch(M.U){case 1:return T=qA(z),R=g.qq(z.entityKey),h=R.entityId,W=[],g.AK(M,2),g.P(M,EeI(B,h),4);case 4:W=M.T;if((b=W)==null||!b.length){M.jI(5);break}return g.P(M,k3F(B.T,z.entityKey),5);case 5:g.yz(M,3);break;case 2:return l=g.JK(M),w="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",l instanceof g.Ih&&l.type==="QUOTA_EXCEEDED"&&(w="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
M.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",T,void 0,w,q));case 3:return c=[],g.P(M,rGP(B.T,"musicTrack",W),7);case 7:W=M.T;if(W.length)for(L=g.d(W),C=L.next();!C.done;C=L.next())if(r=C.value,F=r.offlineVideoData,A=void 0,(A=F)==null?0:A.videoId)a=void 0,V=Number(((a=z.actionMetadata)==null?void 0:a.priority)||0)+1,c.push(xG("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",F.videoId,"musicTrack",V,sm,JP(z,F,h)));return M.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",T,c))}})},
BL7=function(B,z){var T,R,h,W,b,l,w,q,c,L,C,r,F,A,a,V,M,x,v,n,Z,N,TP,hK,zP,ld,t,UH,Qz,vb,AI,lW,gX,Vz,hI,U,Yr,tI,Av,gF,rF,mB,v7,JI,y,J,p,k,H,az,Bb,Iz,Rz,p5,el,Up,aP,Ph,OO;
return g.D(function(jz){switch(jz.U){case 1:return T=qA(z),R=z.entityKey,h=g.qq(R).entityId,W=[],b=!1,h==="!*$_ALL_ENTITIES_!*$"?(b=!0,g.P(jz,S7(B.T,"musicAlbumRelease"),5)):g.P(jz,Ei(B.T,R,"musicAlbumRelease"),4);case 4:(l=jz.T)&&W.push(l);jz.jI(3);break;case 5:W=jz.T;case 3:if((w=W)==null||!w.length)return jz.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",T));if(b){q=[];c=g.d(W);for(L=c.next();!L.done;L=c.next())C=L.value,r=g.qq(C.id).entityId,q.push(xG("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
r,"musicAlbumRelease",0,sm));return jz.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",T,q))}F=[];A=W[0];a=void 0;if(!A.downloadMetadata){jz.jI(6);break}return g.P(jz,Ei(B.T,A.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:V=jz.T,a=Number((x=(M=V)==null?void 0:M.addedTimestampMillis)!=null?x:"0")/1E3;case 6:return g.AK(jz,8),g.P(jz,EeI(B,h,(v=a)==null?void 0:v.toString()),10);case 10:F=jz.T;g.yz(jz,9);break;case 8:n=g.JK(jz);if(!(n instanceof Error&&n.message===
"No data")){if(n instanceof Error&&n.message==="Empty response body")hP(n.message);else return Z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",n instanceof g.Ih&&n.type==="QUOTA_EXCEEDED"&&(Z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),jz.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",T,void 0,Z,N));jz.jI(9);break}return g.P(jz,yo(h,"musicAlbumRelease",B.T,
z,B.Y),9);case 9:TP=[];hK=new Map;if((zP=F)==null?0:zP.length)for(ld=g.d(F),t=ld.next();!t.done;t=ld.next())UH=t.value,Qz=UH.offlineVideoData,vb=void 0,((vb=Qz)==null?0:vb.videoId)&&hK.set(Qz.videoId,Qz);AI=new Map;lW=[];if((gX=A)==null?0:(Vz=gX.tracks)==null?0:Vz.length)for(hI=g.d(A.tracks),U=hI.next();!U.done;U=hI.next())if(Yr=U.value,tI=g.qq(Yr).entityId)hK.has(tI)?(AI.set(tI,hK.get(tI)),hK.delete(tI)):lW.push(tI);gF=Number(((Av=z.actionMetadata)==null?void 0:Av.priority)||0)+1;rF=g.d(hK.entries());
for(mB=rF.next();!mB.done;mB=rF.next())v7=mB.value,JI=g.d(v7),y=JI.next().value,J=JI.next().value,p=y,k=J,TP.push(xG("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",p,"musicTrack",gF,sm,JP(z,k)));H=g.d(AI.entries());for(az=H.next();!az.done;az=H.next())Bb=az.value,Iz=g.d(Bb),Rz=Iz.next().value,p5=Iz.next().value,el=Rz,Up=p5,TP.push(xG("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",el,"musicTrack",gF,sm,JP(z,Up)));aP=g.d(lW);for(Ph=aP.next();!Ph.done;Ph=aP.next())OO=Ph.value,TP.push(xG("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
OO,"musicTrack",0,sm));return jz.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",T,TP))}})},zWF=function(B,z){var T,R;
return g.D(function(h){switch(h.U){case 1:return T=qA(z),g.AK(h,2),R=g.qq(z.entityKey).entityId,R==="!*$_ALL_ENTITIES_!*$"?g.P(h,gE(B.T,z,B.Y),5):g.P(h,yo(R,"musicAlbumRelease",B.T,z,B.Y),6);case 6:return g.P(h,KgW(B.T,z.entityKey),5);case 5:g.yz(h,3);break;case 2:return g.JK(h),h.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",T,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return h.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
T))}})},EeI=function(B,z,T){var R,h,W;
return g.D(function(b){switch(b.U){case 1:return g.P(b,fcs([z]),2);case 2:return R=b.T,g.P(b,TLp(B,R[0],T),3);case 3:return h=b.T,W=Fg(h.thumbnailDetails),g.P(b,aO(W),4);case 4:return b.return(R[0].videos)}})},TLp=function(B,z,T){var R,h,W,b,l,w,q,c,L,C,r,F,A,a;
return g.D(function(V){if(V.U==1){R=z.additionalMetadadatas;h=void 0;if(R&&R.length>0)for(W=g.d(R),b=W.next();!b.done;b=W.next())if(l=b.value,l.offlineMusicPlaylistData){h=l.offlineMusicPlaylistData;break}w=z.playlistId;q=m8s(z);c=q.Mq;L=q.Jw;C=T?(Number(T)*1E3).toString():Date.now().toString();r=z.lastModifiedTimestamp?(Number(z.lastModifiedTimestamp)*1E3).toString():"0";F={id:g.iZ(w,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:L,lastModifiedTimestampMillis:r,addedTimestampMillis:C,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};A={id:g.iZ(w,"musicAlbumRelease"),title:z.title,audioPlaylistId:w,trackCount:z.totalVideoCount,tracks:c,downloadMetadata:F.id};h&&(A.thumbnailDetails=(a=h.albumHqThumbnail)!=null?a:h.albumArtistThumbnail,A.artistDisplayName=h.albumArtistDisplayName,A.releaseDate=h.albumReleaseDate,A.contentRating={explicitType:h.albumReleaseExplicitType},A.releaseType=h.albumReleaseType);return g.P(V,e7(B.T,{mode:"readwrite",cB:!0},function(M){var x=t6(M,A,"musicAlbumRelease");
M=t6(M,F,"musicAlbumReleaseDownloadMetadataEntity");return g.VD.all([x,M])}),2)}return V.return(A)})},RWF=function(B,z){this.T=B;
this.Y=z},WT5=function(B,z){var T,R,h,W,b,l,w,q,c,L,C,r,F,A,a,V;
return g.D(function(M){switch(M.U){case 1:return T=qA(z),R=g.qq(z.entityKey),h=R.entityId,W=[],g.AK(M,2),g.P(M,hWU(B,h),4);case 4:W=M.T;if((b=W)==null||!b.length){M.jI(5);break}return g.P(M,k3F(B.T,z.entityKey),5);case 5:g.yz(M,3);break;case 2:return l=g.JK(M),w="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",l instanceof g.Ih&&l.type==="QUOTA_EXCEEDED"&&(w="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
M.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",T,void 0,w,q));case 3:return c=[],g.P(M,rGP(B.T,"musicTrack",W),7);case 7:W=M.T;if(W.length)for(L=g.d(W),C=L.next();!C.done;C=L.next())if(r=C.value,F=r.offlineVideoData,A=void 0,(A=F)==null?0:A.videoId)a=void 0,V=Number(((a=z.actionMetadata)==null?void 0:a.priority)||0)+1,c.push(xG("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",F.videoId,"musicTrack",V,Em,JP(z,F,h)));return M.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",T,c))}})},
bEF=function(B,z){var T,R,h,W,b,l,w,q,c,L,C,r,F,A,a,V,M,x,v,n,Z,N,TP,hK,zP,ld,t,UH,Qz,vb,AI,lW,gX,Vz,hI,U,Yr,tI,Av,gF,rF,mB,v7,JI,y,J,p,k,H,az,Bb,Iz,Rz,p5,el,Up,aP,Ph,OO,jz,Na,GB,q1,Jp,oA,pJ,NF,tl,QX,h2,t4;
return g.D(function(Wh){switch(Wh.U){case 1:return T=qA(z),R=z.entityKey,h=g.qq(R).entityId,W=[],b=!1,h==="!*$_ALL_ENTITIES_!*$"?(b=!0,g.P(Wh,S7(B.T,"musicPlaylist"),5)):g.P(Wh,Ei(B.T,R,"musicPlaylist"),4);case 4:(l=Wh.T)&&W.push(l);Wh.jI(3);break;case 5:W=Wh.T;case 3:if((w=W)==null||!w.length)return Wh.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",T));q=g.u(z.actionMetadata,naq);L=(c=q)==null?void 0:c.autoSync;C=[];F=r=!0;A=!1;a=void 0;if(!b&&L===!1){Wh.jI(6);break}g.AK(Wh,7);return g.P(Wh,
ZPq(0,!!L,!0,W),9);case 9:C=Wh.T;g.yz(Wh,8);break;case 7:V=g.JK(Wh);if(!(V instanceof Error&&V.message==="No data")){V instanceof Error&&V.message==="Empty response body"&&hP(V.message);Wh.jI(8);break}return h==="!*$_ALL_ENTITIES_!*$"?g.P(Wh,gE(B.T,z,B.Y),8):g.P(Wh,yo(h,"musicPlaylist",B.T,z,B.Y),8);case 8:if(!C.length||!b&&C[0].playlistId!==h)return Wh.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",T));case 6:if(b){M=[];x=g.d(C);for(v=x.next();!v.done;v=x.next())n=v.value,n.upToDate||
L&&!n.shouldAutoSyncMetadata||!n.playlistId||(Z={autoSync:L},M.push(xG("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",n.playlistId,"musicPlaylist",0,Em,{musicPlaylistEntityActionMetadata:Z})));return Wh.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",T,M))}C.length&&(N=C[0],A=!!N.upToDate,L&&(r=(TP=N.shouldAutoSyncMetadata)!=null?TP:!0,F=(hK=N.shouldAutoSyncVideos)!=null?hK:!0,N.checkInSeconds&&(a=N.checkInSeconds)));if(A||!r)return Wh.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
T));zP=[];ld=W[0];t=void 0;if(!ld.downloadMetadata){Wh.jI(15);break}return g.P(Wh,Ei(B.T,ld.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:UH=Wh.T,t=Number((vb=(Qz=UH)==null?void 0:Qz.addedTimestampMillis)!=null?vb:"0")/1E3;case 15:return g.AK(Wh,17),g.P(Wh,hWU(B,h,(AI=t)==null?void 0:AI.toString(),a),19);case 19:zP=Wh.T;g.yz(Wh,18);break;case 17:lW=g.JK(Wh);if(!(lW instanceof Error&&lW.message==="No data")){if(lW instanceof Error&&lW.message==="Empty response body")hP(lW.message);
else return gX="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Vz="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",lW instanceof g.Ih&&lW.type==="QUOTA_EXCEEDED"&&(gX="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Vz="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Wh.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",T,void 0,gX,Vz));Wh.jI(18);break}return g.P(Wh,yo(h,"musicPlaylist",B.T,z,B.Y),18);case 18:if(!F)return Wh.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
T));hI=[];U=new Map;if((Yr=zP)==null?0:Yr.length)for(tI=g.d(zP),Av=tI.next();!Av.done;Av=tI.next())gF=Av.value,rF=gF.offlineVideoData,mB=void 0,((mB=rF)==null?0:mB.videoId)&&U.set(rF.videoId,rF);v7=new Map;JI=[];if((y=ld)==null?0:(J=y.tracks)==null?0:J.length)for(p=g.d(ld.tracks),k=p.next();!k.done;k=p.next())if(H=k.value,az=g.qq(H).entityId)U.has(az)?(v7.set(az,U.get(az)),U.delete(az)):JI.push(az);Iz=Number(((Bb=z.actionMetadata)==null?void 0:Bb.priority)||0)+1;Rz=g.d(U.entries());for(p5=Rz.next();!p5.done;p5=
Rz.next())el=p5.value,Up=g.d(el),aP=Up.next().value,Ph=Up.next().value,OO=aP,jz=Ph,hI.push(xG("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",OO,"musicTrack",Iz,Em,JP(z,jz)));Na=g.d(v7.entries());for(GB=Na.next();!GB.done;GB=Na.next())q1=GB.value,Jp=g.d(q1),oA=Jp.next().value,pJ=Jp.next().value,NF=oA,tl=pJ,hI.push(xG("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",NF,"musicTrack",Iz,Em,JP(z,tl)));QX=g.d(JI);for(h2=QX.next();!h2.done;h2=QX.next())t4=h2.value,hI.push(xG("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
t4,"musicTrack",0,Em));return Wh.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",T,hI))}})},YEq=function(B,z){var T,R;
return g.D(function(h){switch(h.U){case 1:return T=qA(z),g.AK(h,2),R=g.qq(z.entityKey).entityId,R==="!*$_ALL_ENTITIES_!*$"?g.P(h,gE(B.T,z,B.Y),5):g.P(h,yo(R,"musicPlaylist",B.T,z,B.Y),6);case 6:return g.P(h,KgW(B.T,z.entityKey),5);case 5:g.yz(h,3);break;case 2:return g.JK(h),h.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",T,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return h.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
T))}})},hWU=function(B,z,T,R){var h,W,b;
return g.D(function(l){switch(l.U){case 1:return g.P(l,fcs([z]),2);case 2:return h=l.T,g.P(l,leK(B,h[0],T,R),3);case 3:return W=l.T,b=Fg(W.thumbnailDetails),g.P(l,aO(b),4);case 4:return l.return(h[0].videos)}})},leK=function(B,z,T,R){var h,W,b,l,w,q,c,L,C;
return g.D(function(r){return r.U==1?(h=z.playlistId,W=m8s(z),b=W.Mq,l=W.Jw,w=T?(Number(T)*1E3).toString():Date.now().toString(),q=z.lastModifiedTimestamp?(Number(z.lastModifiedTimestamp)*1E3).toString():"0",c={id:g.iZ(h,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:l,lastModifiedTimestampMillis:q,addedTimestampMillis:w,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},L={id:g.iZ(h,"musicPlaylist"),title:z.title,playlistId:h,thumbnailDetails:z.thumbnail,visibility:wfP(z),trackCount:z.totalVideoCount,
tracks:b,downloadMetadata:c.id},R&&(((C=L)==null?0:C.entityMetadata)?L.entityMetadata.nextAutoRefreshIntervalSeconds=String(R):L&&(L.entityMetadata={nextAutoRefreshIntervalSeconds:String(R)})),g.P(r,e7(B.T,{mode:"readwrite",cB:!0},function(F){var A=t6(F,L,"musicPlaylist");F=t6(F,c,"musicPlaylistDownloadMetadataEntity");return g.VD.all([A,F])}),2)):r.return(L)})},wfP=function(B){switch(B.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},qEW=function(B,z){this.T=B;
this.Y=z},C7h=function(B,z){var T,R,h,W,b,l,w,q,c,L,C,r,F;
return g.D(function(A){switch(A.U){case 1:return T=qA(z),R=g.qq(z.entityKey),h=R.entityId,W=g.u(z.actionMetadata,iER),g.AK(A,2),g.P(A,cr5(B,h,void 0,(b=W)==null?void 0:b.track,(l=W)==null?void 0:l.albumRelease),4);case 4:if((w=W)==null?0:w.playlistId){A.jI(5);break}return g.P(A,k3F(B.T,z.entityKey),5);case 5:g.yz(A,3);break;case 2:return q=g.JK(A),c="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",L="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",q instanceof g.Ih&&q.type==="QUOTA_EXCEEDED"&&
(c="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",L="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),A.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",T,void 0,c,L));case 3:r=Number(((C=z.actionMetadata)==null?void 0:C.priority)||0)+1;var a=(a=g.u(z.actionMetadata,iER))?{playbackDataActionMetadata:{maximumDownloadQuality:a.maximumDownloadQuality}}:void 0;F=xG("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",h,"playbackData",r,LTU,a);return A.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
T,[F]))}})},rr7=function(B,z){var T,R,h,W,b,l,w,q,c,L,C,r,F,A,a;
return g.D(function(V){switch(V.U){case 1:return T=qA(z),R=g.qq(z.entityKey),h=R.entityId,g.P(V,Ei(B.T,z.entityKey,"musicTrack"),2);case 2:W=V.T;if(!W){b=void 0;V.jI(3);break}return g.P(V,Ei(B.T,W.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:b=V.T;case 3:l=b;if(!W||!l)return V.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",T));q=g.u(z.actionMetadata,iER);g.AK(V,5);return g.P(V,cr5(B,h,l.addedTimestampMillis,(c=q)==null?void 0:c.track,(L=q)==null?void 0:L.albumRelease),
7);case 7:r=Number(((C=z.actionMetadata)==null?void 0:C.priority)||0)+1;w=xG("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",h,"playbackData",r,LTU);g.yz(V,6);break;case 5:F=g.JK(V);if(!(F instanceof Error&&F.message==="No data")){if(F instanceof Error&&F.message==="Empty response body")hP(F.message);else return A="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",a="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",F instanceof g.Ih&&F.type==="QUOTA_EXCEEDED"&&(A="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
a="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),V.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",T,void 0,A,a));V.jI(6);break}return g.P(V,Qo(h,B.T,z,B.Y),6);case 6:return V.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",T,w?[w]:void 0))}})},o0I=function(B,z){var T,R;
return g.D(function(h){switch(h.U){case 1:return T=qA(z),g.AK(h,2),R=g.qq(z.entityKey).entityId,R==="!*$_ALL_ENTITIES_!*$"?g.P(h,gE(B.T,z,B.Y),5):g.P(h,Qo(R,B.T,z,B.Y),6);case 6:return g.P(h,KgW(B.T,z.entityKey),5);case 5:g.yz(h,3);break;case 2:return g.JK(h),h.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",T,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return h.return(new v9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
T))}})},cr5=function(B,z,T,R,h){var W,b,l,w,q,c;
return g.D(function(L){switch(L.U){case 1:if(W=R){L.jI(2);break}return g.P(L,HPU([z]),3);case 3:b=L.T,l=b[0],W=D8P(l);case 2:return g.P(L,FTs(B,W,z,h,T),4);case 4:w=L.T;q=w.musicTrackEntity;c=w.Bx;var C=Fg(q.thumbnailDetails),r=[];c&&(r=Fg(c.thumbnailDetails));return g.P(L,aO(C.concat(r)),0)}})},FTs=function(B,z,T,R,h){var W;
return g.D(function(b){return b.U==1?(h||(h=Date.now().toString()),W={id:g.iZ(T,"musicTrackDownloadMetadataEntity"),playbackData:g.iZ(T,"playbackData"),addedTimestampMillis:h,videoDownloadContextEntity:g.iZ(T,"videoDownloadContextEntity")},R&&(z.albumRelease=R.id),g.P(b,e7(B.T,{mode:"readwrite",cB:!0},function(l){var w=[],q=t6(l,W,"musicTrackDownloadMetadataEntity");w.push(q);q=t6(l,z,"musicTrack");w.push(q);R&&(l=t6(l,R,"musicAlbumRelease"),w.push(l));return g.VD.all(w)}),2)):b.U!=3?g.P(b,Cc(T,"musicTrackDownloadMetadataEntity",
B.T,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):b.return({musicTrackEntity:z,
Bx:R})})},Su=function(){ju.apply(this,arguments);
this.N="musicTrack"},Iep=function(B,z,T){z=z===void 0?43200:z;
T=T===void 0?!0:T;var R=R===void 0?!1:R;var h,W;return g.D(function(b){switch(b.U){case 1:if(!B.X.zO())return b.return([]);h=[];g.AK(b,2);return g.P(b,ZPq(z,T,R),4);case 4:h=b.T;g.yz(b,3);break;case 2:g.JK(b);case 3:return W=MWp(B,h,T,"musicPlaylist"),b.return(W)}})},Gqh=function(){g.I$.apply(this,arguments);
var B=this;this.events=new g.kb(this);this.dF=this.player.K();this.Yi={DkD:function(){return B.T},
Ww:function(){return B.Ww()},
pH:function(z){return B.pH(z)}}},dGs=function(B){var z;
B=g.u((z=B.getWatchNextResponse())==null?void 0:z.currentVideoEndpoint,g.E2);if(B==null?0:B.playlistId)var T=B.playlistId;return T},ArU=function(B,z){var T,R,h,W;
return g.D(function(b){if(b.U==1){T=z.clientPlaybackNonce;R={cpn:T,offlineSourceVisualElement:g.Vl(z.lO||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};z.U&&(R.videoFmt=Number(z.U.itag));z.W&&(R.audioFmt=Number(z.W.itag));if((h=dGs(z))&&z.videoId){var l=z.videoId;l=h!=="PPSV"?Promise.resolve(!1):B.T.hE(l);b=g.P(b,l,3)}else b=b.jI(2);return b}b.U!=2&&(W=b.T)&&(R.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");B.U=T;g.ip("offlinePlaybackStarted",R);g.dX(b)})};
g.M2.prototype.TA=g.bd(51,function(B){return this.app.TA(B)});
g.ob.prototype.TA=g.bd(50,function(B){return g.Hc5(this,9,B)});
g.G(KK,kq);g.wX.Object.defineProperties(KK.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.T.entityMetadata},
set:function(B){this.T.entityMetadata=B}}});
g.G(Lzg,KK);Lzg.prototype.U=function(){return[]};
g.G(CQR,KK);CQR.prototype.U=function(){return[]};
g.G(rlP,KK);rlP.prototype.U=function(){return[]};
g.G(o5p,KK);o5p.prototype.U=function(){return[]};
g.G(FzF,KK);FzF.prototype.U=function(){var B=[];this.T.alternateChannel&&B.push(this.T.alternateChannel);this.T.alternateChannelList&&B.push.apply(B,g.Q(this.T.alternateChannelList));this.T.oneofChannelEntity&&B.push(this.T.oneofChannelEntity);return[].concat(g.Q(new Set(B)))};
g.G(IJc,KK);IJc.prototype.U=function(){var B=[];this.T.entryCollection&&B.push(this.T.entryCollection);return[].concat(g.Q(new Set(B)))};
g.G(Gac,kq);Gac.prototype.U=function(){var B=[];this.T.video&&B.push(this.T.video);return[].concat(g.Q(new Set(B)))};
g.G(dFq,KK);dFq.prototype.U=function(){var B=[];this.T.parentPlaylist&&B.push(this.T.parentPlaylist);if(this.T.entries)for(var z=g.d(this.T.entries),T=z.next();!T.done;T=z.next())B.push.apply(B,g.Q((new Gac(T.value)).U()));return[].concat(g.Q(new Set(B)))};
g.G(Al7,KK);Al7.prototype.U=function(){var B=[];this.T.descriptionEntity&&B.push(this.T.descriptionEntity);this.T.creators&&B.push.apply(B,g.Q(this.T.creators));this.T.theBiggestFan&&B.push(this.T.theBiggestFan);return[].concat(g.Q(new Set(B)))};
g.G(aJp,KK);aJp.prototype.U=function(){return[]};
g.G(UF5,KK);UF5.prototype.U=function(){return[]};
g.G(Mw5,KK);Mw5.prototype.U=function(){return[]};
g.G(Vwh,KK);Vwh.prototype.U=function(){return[]};
g.G(Q0K,KK);Q0K.prototype.U=function(){return[]};
g.G(ylI,KK);ylI.prototype.U=function(){return[]};
g.G(g55,KK);g55.prototype.U=function(){return[]};
g.G(JlR,KK);JlR.prototype.U=function(){return[]};
g.G(pQq,KK);pQq.prototype.U=function(){return[]};
g.G($FP,KK);$FP.prototype.U=function(){var B=[];this.T.downloadsList&&B.push(this.T.downloadsList);this.T.smartDownloadsList&&B.push(this.T.smartDownloadsList);this.T.recommendedDownloadsList&&B.push(this.T.recommendedDownloadsList);this.T.refresh&&B.push(this.T.refresh);return[].concat(g.Q(new Set(B)))};
g.G(PQF,kq);PQF.prototype.U=function(){var B=[];this.T.video&&B.push(this.T.video);this.T.playlist&&B.push(this.T.playlist);this.T.videoItem&&B.push(this.T.videoItem);this.T.playlistItem&&B.push(this.T.playlistItem);return[].concat(g.Q(new Set(B)))};
g.G(xFW,KK);xFW.prototype.U=function(){var B=[];this.T.refresh&&B.push(this.T.refresh);if(this.T.downloads)for(var z=g.d(this.T.downloads),T=z.next();!T.done;T=z.next())B.push.apply(B,g.Q((new PQF(T.value)).U()));return[].concat(g.Q(new Set(B)))};
g.G(v5g,KK);v5g.prototype.U=function(){var B=[];this.T.localImageEntities&&B.push.apply(B,g.Q(this.T.localImageEntities));return[].concat(g.Q(new Set(B)))};
g.G(DFW,KK);DFW.prototype.U=function(){var B=[];this.T.playbackData&&B.push(this.T.playbackData);this.T.localImageEntities&&B.push.apply(B,g.Q(this.T.localImageEntities));this.T.videoDownloadContextEntity&&B.push(this.T.videoDownloadContextEntity);return[].concat(g.Q(new Set(B)))};
g.G(kaI,KK);kaI.prototype.U=function(){return[]};
g.G(KzR,KK);KzR.prototype.U=function(){var B=[];this.T.fakeChildren&&B.push.apply(B,g.Q(this.T.fakeChildren));return[].concat(g.Q(new Set(B)))};
g.G(mFF,KK);mFF.prototype.U=function(){var B=[];this.T.video&&B.push(this.T.video);this.T.playbackData&&B.push(this.T.playbackData);this.T.offlineVideoPolicy&&B.push(this.T.offlineVideoPolicy);return[].concat(g.Q(new Set(B)))};
g.G(n5q,KK);n5q.prototype.U=function(){return[]};
g.G(ud7,KK);ud7.prototype.U=function(){var B=[];this.T.channelOwner&&B.push(this.T.channelOwner);this.T.videos&&B.push.apply(B,g.Q(this.T.videos));this.T.collaboratorChannels&&B.push.apply(B,g.Q(this.T.collaboratorChannels));this.T.downloadState&&B.push(this.T.downloadState);this.T.refresh&&B.push(this.T.refresh);return[].concat(g.Q(new Set(B)))};
g.G(H4s,KK);H4s.prototype.U=function(){var B=[];this.T.video&&B.push(this.T.video);this.T.channelContributor&&B.push(this.T.channelContributor);return[].concat(g.Q(new Set(B)))};
g.G(fJc,kq);fJc.prototype.U=function(){var B=[];this.T.localImageEntities&&B.push.apply(B,g.Q(this.T.localImageEntities));this.T.videoDownloadContextEntity&&B.push(this.T.videoDownloadContextEntity);return[].concat(g.Q(new Set(B)))};
g.G(O4R,kq);O4R.prototype.U=function(){var B=[];this.T.recommendedVideoMetadata&&B.push.apply(B,g.Q((new fJc(this.T.recommendedVideoMetadata)).U()));return[].concat(g.Q(new Set(B)))};
g.G(NsU,kq);NsU.prototype.U=function(){var B=[];this.T.playbackPosition&&B.push(this.T.playbackPosition);return[].concat(g.Q(new Set(B)))};
g.G(twh,KK);twh.prototype.U=function(){var B=[];this.T.owner&&B.push(this.T.owner);this.T.downloadState&&B.push(this.T.downloadState);this.T.userState&&B.push.apply(B,g.Q((new NsU(this.T.userState)).U()));this.T.additionalMetadata&&B.push.apply(B,g.Q((new O4R(this.T.additionalMetadata)).U()));return[].concat(g.Q(new Set(B)))};
g.G(j0W,KK);j0W.prototype.U=function(){var B=[];this.T.userChannelDetails&&B.push(this.T.userChannelDetails);return[].concat(g.Q(new Set(B)))};
g.G(XQW,KK);XQW.prototype.U=function(){var B=[];this.T.channelOwner&&B.push(this.T.channelOwner);this.T.playbackPosition&&B.push(this.T.playbackPosition);this.T.localImageEntities&&B.push.apply(B,g.Q(this.T.localImageEntities));this.T.downloadStatus&&B.push(this.T.downloadStatus);return[].concat(g.Q(new Set(B)))};
g.G(Z4W,KK);Z4W.prototype.U=function(){return[]};
g.G(eH5,KK);eH5.prototype.U=function(){return[]};
g.G(s0F,KK);s0F.prototype.U=function(){return[]};
g.G(E5c,KK);E5c.prototype.U=function(){return[]};
g.G(SoK,KK);SoK.prototype.U=function(){return[]};
g.G(Bb5,KK);Bb5.prototype.U=function(){return[]};
g.G(z6p,KK);z6p.prototype.U=function(){return[]};
g.G(Tbg,KK);Tbg.prototype.U=function(){return[]};
g.G(R6W,KK);R6W.prototype.U=function(){return[]};
g.G(h6W,KK);h6W.prototype.U=function(){return[]};
g.G(Wr5,KK);Wr5.prototype.U=function(){return[]};
g.G(b8U,KK);b8U.prototype.U=function(){var B=[];this.T.trackDownloadMetadatas&&B.push.apply(B,g.Q(this.T.trackDownloadMetadatas));return[].concat(g.Q(new Set(B)))};
g.G(Y3R,KK);
Y3R.prototype.U=function(){var B=[];this.T.downloadedTracks&&B.push.apply(B,g.Q(this.T.downloadedTracks));this.T.smartDownloadedTracks&&B.push.apply(B,g.Q(this.T.smartDownloadedTracks));this.T.downloadedEpisodes&&B.push.apply(B,g.Q(this.T.downloadedEpisodes));this.T.downloadedAlbumReleases&&B.push.apply(B,g.Q(this.T.downloadedAlbumReleases));this.T.smartDownloadedAlbumReleases&&B.push.apply(B,g.Q(this.T.smartDownloadedAlbumReleases));this.T.downloadedPlaylists&&B.push.apply(B,g.Q(this.T.downloadedPlaylists));this.T.smartDownloadedPlaylists&&
B.push.apply(B,g.Q(this.T.smartDownloadedPlaylists));this.T.metadataOnlyTracks&&B.push.apply(B,g.Q(this.T.metadataOnlyTracks));return[].concat(g.Q(new Set(B)))};
g.G(l4q,KK);l4q.prototype.U=function(){var B=[];this.T.trackDownloadMetadatas&&B.push.apply(B,g.Q(this.T.trackDownloadMetadatas));return[].concat(g.Q(new Set(B)))};
g.G(w5K,KK);w5K.prototype.U=function(){var B=[];this.T.playbackData&&B.push(this.T.playbackData);this.T.localImageEntities&&B.push.apply(B,g.Q(this.T.localImageEntities));this.T.videoDownloadContextEntity&&B.push(this.T.videoDownloadContextEntity);return[].concat(g.Q(new Set(B)))};
g.G(q37,KK);q37.prototype.U=function(){var B=[];this.T.musicLibraryStatusEntity&&B.push(this.T.musicLibraryStatusEntity);this.T.primaryArtists&&B.push.apply(B,g.Q(this.T.primaryArtists));this.T.details&&B.push(this.T.details);this.T.userDetails&&B.push(this.T.userDetails);this.T.tracks&&B.push.apply(B,g.Q(this.T.tracks));this.T.share&&B.push(this.T.share);this.T.downloadMetadata&&B.push(this.T.downloadMetadata);this.T.refresh&&B.push(this.T.refresh);return[].concat(g.Q(new Set(B)))};
g.G(i8c,KK);i8c.prototype.U=function(){var B=[];this.T.albumRelease&&B.push(this.T.albumRelease);this.T.tracks&&B.push.apply(B,g.Q(this.T.tracks));return[].concat(g.Q(new Set(B)))};
g.G(cBg,KK);cBg.prototype.U=function(){var B=[];this.T.albumRelease&&B.push(this.T.albumRelease);return[].concat(g.Q(new Set(B)))};
g.G(LrF,KK);LrF.prototype.U=function(){var B=[];this.T.details&&B.push(this.T.details);this.T.userDetails&&B.push(this.T.userDetails);return[].concat(g.Q(new Set(B)))};
g.G(CjP,KK);CjP.prototype.U=function(){var B=[];this.T.parentArtist&&B.push(this.T.parentArtist);return[].concat(g.Q(new Set(B)))};
g.G(rBF,KK);rBF.prototype.U=function(){var B=[];this.T.parentArtist&&B.push(this.T.parentArtist);return[].concat(g.Q(new Set(B)))};
g.G(oy5,KK);oy5.prototype.U=function(){return[]};
g.G(Frh,KK);Frh.prototype.U=function(){return[]};
g.G(I4K,kq);I4K.prototype.U=function(){var B=[];this.T.creatorEntity&&B.push(this.T.creatorEntity);return[].concat(g.Q(new Set(B)))};
g.G(GTK,KK);
GTK.prototype.U=function(){var B=[];this.T.tracks&&B.push.apply(B,g.Q(this.T.tracks));this.T.refresh&&B.push(this.T.refresh);this.T.musicLibraryStatusEntity&&B.push(this.T.musicLibraryStatusEntity);this.T.details&&B.push(this.T.details);this.T.downloadMetadata&&B.push(this.T.downloadMetadata);this.T.sideloadMetadata&&B.push(this.T.sideloadMetadata);this.T.userDetails&&B.push(this.T.userDetails);this.T.entryCollection&&B.push(this.T.entryCollection);this.T.share&&B.push(this.T.share);this.T.podcastShowAdditionalMetadata&&B.push.apply(B,
g.Q((new I4K(this.T.podcastShowAdditionalMetadata)).U()));return[].concat(g.Q(new Set(B)))};
g.G(dHq,KK);dHq.prototype.U=function(){return[]};
g.G(ABU,KK);
ABU.prototype.U=function(){var B=[];this.T.musicLibraryStatusEntity&&B.push(this.T.musicLibraryStatusEntity);this.T.artists&&B.push.apply(B,g.Q(this.T.artists));this.T.audioModeVersion&&B.push(this.T.audioModeVersion);this.T.videoModeVersion&&B.push(this.T.videoModeVersion);this.T.userDetails&&B.push(this.T.userDetails);this.T.details&&B.push(this.T.details);this.T.albumRelease&&B.push(this.T.albumRelease);this.T.share&&B.push(this.T.share);this.T.libraryEdit&&B.push(this.T.libraryEdit);this.T.downloadMetadata&&
B.push(this.T.downloadMetadata);this.T.playbackPosition&&B.push(this.T.playbackPosition);this.T.lyrics&&B.push(this.T.lyrics);return[].concat(g.Q(new Set(B)))};
g.G(a4q,KK);a4q.prototype.U=function(){var B=[];this.T.parentTrack&&B.push(this.T.parentTrack);return[].concat(g.Q(new Set(B)))};
g.G(UHh,KK);UHh.prototype.U=function(){var B=[];this.T.parentTrack&&B.push(this.T.parentTrack);return[].concat(g.Q(new Set(B)))};
g.G(MYh,KK);MYh.prototype.U=function(){return[]};
g.G(VYW,KK);VYW.prototype.U=function(){return[]};
g.G(QNR,KK);QNR.prototype.U=function(){return[]};
g.G(yBq,KK);yBq.prototype.U=function(){return[]};
g.G(gyF,KK);gyF.prototype.U=function(){var B=[];this.T.transfer&&B.push(this.T.transfer);this.T.adsPlaybackData&&B.push.apply(B,g.Q(this.T.adsPlaybackData));this.T.drmLicense&&B.push(this.T.drmLicense);this.T.offlineVideoPolicy&&B.push(this.T.offlineVideoPolicy);this.T.videoDownloadContextEntity&&B.push(this.T.videoDownloadContextEntity);return[].concat(g.Q(new Set(B)))};
g.G(JBs,KK);JBs.prototype.U=function(){return[]};
g.G(p5p,KK);p5p.prototype.U=function(){var B=[];this.T.offlineVideoStreams&&B.push.apply(B,g.Q(this.T.offlineVideoStreams));this.T.captionTrack&&B.push.apply(B,g.Q(this.T.captionTrack));return[].concat(g.Q(new Set(B)))};
g.G($Hs,KK);$Hs.prototype.U=function(){return[]};
g.G(Pjc,KK);Pjc.prototype.U=function(){return[]};
g.G(xHh,KK);xHh.prototype.U=function(){return[]};
g.G(vyh,KK);vyh.prototype.U=function(){return[]};
g.G(DHs,KK);DHs.prototype.U=function(){return[]};
g.G(kTU,KK);kTU.prototype.U=function(){return[]};
g.G(KrU,KK);KrU.prototype.U=function(){return[]};
g.G(mHF,KK);mHF.prototype.U=function(){return[]};
g.G(nyp,KK);nyp.prototype.U=function(){return[]};
g.G(u3W,KK);u3W.prototype.U=function(){return[]};
g.G(H8F,KK);H8F.prototype.U=function(){return[]};
g.G(f4P,KK);f4P.prototype.U=function(){return[]};
g.G(O8h,KK);O8h.prototype.U=function(){return[]};
g.G(NbU,KK);NbU.prototype.U=function(){return[]};
g.G(tYI,KK);tYI.prototype.U=function(){return[]};
g.G(jNq,KK);jNq.prototype.U=function(){return[]};
g.G(X55,KK);X55.prototype.U=function(){return[]};
g.G(Z8F,KK);Z8F.prototype.U=function(){return[]};
g.G(e6g,KK);e6g.prototype.U=function(){return[]};
g.G(sN7,KK);sN7.prototype.U=function(){return[]};
var eMF=["browse","music/browse","unplugged/browse"],z0g=["offline/playlist_sync_check"],uh5=["offline"],ssR=["offline/offline_video_playback_position_sync"],S7q=["offline/get_playback_data_entity"],mD;nK.getInstance=function(){return g.D(function(B){return B.return(new Promise(function(z){g.Sd().then(function(T){T?(nK.instance||(nK.instance=new nK(T)),z(nK.instance)):z(void 0)})}))})};
nK.prototype.get=function(B){var z=this,T,R,h;return g.D(function(W){if(W.U==1)return g.P(W,ztW(z.token),2);if(W.U!=3)return T=W.T,g.P(W,T.get("prefs",B),3);R=W.T;if(!R)return W.return();h=(0,g.f)();return R.expirationTimestampMs<=h?W.return():W.return(R.value)})};
nK.prototype.set=function(B,z,T){T=T===void 0?31536E3:T;var R=this,h,W,b;return g.D(function(l){if(l.U==1)return h=(0,g.f)(),W={key:B,value:z,expirationTimestampMs:h+T*1E3},g.P(l,ztW(R.token),2);b=l.T;return g.P(l,g.v4(b,"prefs",W),0)})};
nK.prototype.remove=function(B){var z=this,T;return g.D(function(R){if(R.U==1)return g.P(R,ztW(z.token),2);T=R.T;return g.P(R,T.delete("prefs",B),0)})};
g.G(u4,g.Z_);g.G(H_,bhF);H_.prototype.Y=function(B,z){z=lEU(z);B=(new TextEncoder).encode(JSON.stringify(B));return this.T.encrypt(B,z)};
H_.prototype.U=function(B,z){if(!(B instanceof Uint8Array))throw TWP(1);var T=new TextDecoder;z=lEU(z);B=this.T.decrypt(B,z);return JSON.parse(T.decode(B))};
var w0U={accountLinkStatusEntity:Mw5,booleanEntity:rlP,buttonEntity:O8h,captionTrack:MYh,channelHandle:Lzg,commerceAcquisitionClientPayloadEntity:tYI,commerceCartListEntity:jNq,contextNoteFeedEntityPayload:CQR,continuationTokenEntity:n5q,downloadQualityPickerEntity:g55,downloadsPageRefreshTokenEntity:pQq,downloadsPageViewConfigurationEntity:Z4W,downloadStatusEntity:JlR,dismissState:KrU,sfvAudioItemCurrentlyPlayingEntity:vyh,emojiFountainDataEntity:H8F,emojiCustomizationSetEntity:u3W,fakeChannel:FzF,
fakePlaylist:IJc,fakePlaylistEntryCollection:dFq,fakeVideo:Al7,fakeVideoDescription:aJp,featuredProductsEntity:R6W,flowStateEntity:UF5,iconBadgeEntity:X55,interstitialInteractionStateEntity:Q0K,likeButtonAnimationEntity:eH5,liveChatPollStateEntity:ylI,liveViewerLeaderboardChatEntryPointStateEntity:Pjc,liveViewerLeaderboardPointsEntity:xHh,liveReactionsDataEntity:f4P,logoEntity:Vwh,macroMarkerEntity:s0F,mainDownloadsLibraryEntity:$FP,mainDownloadsListEntity:xFW,mainPlaylistDownloadStateEntity:v5g,
mainPlaylistEntity:ud7,mainPlaylistVideoEntity:H4s,mainVideoDownloadStateEntity:DFW,mainVideoEntity:twh,markersEngagementPanelSyncEntity:E5c,markersVisibilityOverrideEntity:SoK,musicAlbumReleaseDetail:i8c,musicAlbumReleaseDownloadMetadataEntity:b8U,musicAlbumRelease:q37,musicAlbumReleaseUserDetail:cBg,musicArtistDetail:CjP,musicArtist:LrF,musicArtistUserDetail:rBF,musicDownloadsLibraryEntity:Y3R,musicLibraryEdit:oy5,musicLibraryStatusEntity:Frh,musicPlaylist:GTK,musicPlaylistDownloadMetadataEntity:l4q,
musicShare:dHq,musicTrackDetail:a4q,musicTrackDownloadMetadataEntity:w5K,musicTrack:ABU,musicTrackUserDetail:UHh,offlineOrchestrationActionWrapperEntity:VYW,offlineVideoPolicy:QNR,offlineVideoStreams:yBq,offlineabilityEntity:kaI,orchestrationWebSamplingEntity:KzR,pageHeaderEntity:mHF,pdpStateEntity:Z8F,pinnedProductEntity:h6W,playbackData:gyF,playerStateEntity:Bb5,quantityIncrementerEntity:e6g,refresh:JBs,saveToPlaylistListEntity:DHs,settingEntity:kTU,stringEntity:o5p,suggestedFeedbackChipStateEntity:z6p,
transfer:p5p,trendingOfferEntity:Wr5,videoDownloadContextEntity:$Hs,videoOverviewAsyncDataEntity:sN7,videoPlaybackPositionEntity:NbU,votingEntity:nyp,ytMainChannelEntity:j0W,youchatPendingResponseEntity:Tbg,ytMainDownloadedVideoEntity:mFF,ytMainVideoEntity:XQW};g.G(XG,bhF);XG.prototype.Y=function(B){return B};
XG.prototype.U=function(B){if(B instanceof Uint8Array)throw TWP(0);return B};
g.G(ZB,g.K);ZB.prototype.observe=function(B){var z=this;this.observers.push(B);return function(){var T=z.observers.indexOf(B);T>=0&&z.observers.splice(T,1)}};
ZB.prototype.U=function(B){UW5(this,B.data)};
ZB.prototype.gF=function(){this.channel.close()};
var gtq,QsK=new g.gL("elementsCommand");var MA=new g.gL("entityBatchUpdate");var C8U=new g.gL("downloadStatusEntity");var pi7=new g.gL("mainPlaylistEntityActionMetadata");var eu=new g.gL("mainVideoEntityActionMetadata");var naq=new g.gL("musicPlaylistEntityActionMetadata");var iER=new g.gL("musicTrackEntityActionMetadata");var tWp=new g.gL("localImageEntityActionMetadata");var DC=new g.gL("playbackDataActionMetadata");var yXh=new g.gL("transferEntityActionMetadata");var cXR=new g.gL("videoPlaybackPositionEntityActionMetadata");var OhF;new g.CP;new g.CP;Zhs.prototype.request=function(B,z,T){z=z===void 0?{}:z;return this.locks.request(B,z,function(R){return T(R)})};var RO=g.XK.caches,T6,BUF;z6.prototype.open=function(B){return RO.open(Etq(B))};
z6.prototype.has=function(B){return RO.has(Etq(B))};
z6.prototype.delete=function(B){return RO.delete(Etq(B))};
z6.prototype.match=function(B,z){var T=this,R,h,W,b,l,w;return g.D(function(q){switch(q.U){case 1:return g.P(q,T.keys(),2);case 2:R=q.T,h=g.d(R),W=h.next();case 3:if(W.done){q.jI(5);break}b=W.value;return g.P(q,T.open(b),6);case 6:return l=q.T,g.P(q,l.match(B,z),7);case 7:if(w=q.T)return q.return(w);W=h.next();q.jI(3);break;case 5:return q.return()}})};
g.G(s9R,z6);s9R.prototype.keys=function(){var B,z,T,R,h,W,b,l,w;return g.D(function(q){if(q.U==1)return B=[],z=g.eT("CacheStorage keys"),g.P(q,RO.keys(),2);T=q.T;R=g.d(T);for(h=R.next();!h.done;h=R.next()){W=h.value;var c=W.indexOf(":");b=c===-1?{L9:W}:{L9:W.substring(0,c),datasyncId:W.substring(c+1)};l=b.L9;w=b.datasyncId;w===z&&B.push(l)}return q.return(B)})};g.G(W9,g.K);W9.prototype.Y=function(B){this.api.uO("onOfflineOperationFailure",B.data)};
W9.prototype.W=function(B){this.api.publish("offlinetransferpause",B.data)};
W9.prototype.gF=function(){var B;(B=this.T)==null||B.close();var z;(z=this.U)==null||z.close()};RMU.prototype.UJ=function(){this.T&&YG(this)};
RMU.prototype.Us=function(){this.U&&this.U.resolve();this.Y=this.T=!1;this.N()};var OiW=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var U87="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var vaP="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.G(R0g,P9);R0g.prototype.U=function(B){return iV(B)?bic(this,B):c9(B)?wuW(this,B):Promise.reject(Error("Unsupported action type: "+B.actionType))};g.G(qws,P9);qws.prototype.U=function(B){return c9(B)?iiW(this,B):Lgp(B)?LSF(this,B):Lc(B)?Cbs(this,B):Promise.reject(Error("Unsupported action type: "+B.actionType))};g.I=rXR.prototype;g.I.PKd=function(B){var z=this,T,R,h,W;return g.D(function(b){if(!g.X(B.state,128))return b.jI(0);T=B.state.pp;var l=(R=T)==null?void 0:R.errorCode,w=(h=T)==null?void 0:h.pJ;W=l==="net.connect"&&w===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(l==null?0:l.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.P(b,z.N7(z.player.getVideoData().videoId,W),0)})};
g.I.N7=function(B,z){var T=this;return g.D(function(R){if(R.U==1){if(T.U)return R.return();T.U=!0;return z==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(mn(T,B,!1,!0),R.jI(0)):g.P(R,Kc(T,B),3)}g.$O(B,4);return g.P(R,T.T.N7(z),0)})};
g.I.Bt=function(B){B.status===2?(B.status!==this.Y&&(i25(this.T),g.$O(B.videoId,2)),B.Id&&oes(this.T,B.videoId,B.Id)):B.status===4?(Kc(this,B.videoId),this.N7(B.videoId,B.sx?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):B.status===1&&rnp(this.T);this.Y=B.status;this.api.uO("localmediachange",{videoId:B.videoId,status:B.status})};
g.I.qT=function(){var B=this,z;return g.D(function(T){if(T.U==1){if(B.U)return T.return();B.U=!0;z=B.player.getVideoData().videoId;return g.P(T,Kc(B,z),2)}return g.P(T,B.T.qT(),0)})};
g.I.gi=function(B){switch(B){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.I.D=function(B){return this.api.K().D(B)};g.G(av7,P9);av7.prototype.U=function(B){return iV(B)?Mig(this,B):c9(B)?ViU(this,B):Lgp(B)?QCg(this,B):Promise.reject(Error("Unsupported action type: "+B.actionType))};Pbc.prototype.T=function(B,z){var T=B.action.actionMetadata.priority-z.action.actionMetadata.priority;T===0&&(B.T<z.T?T=-1:B.T>z.T&&(T=1));return T};g.G(nc,g.K);nc.prototype.gF=function(){this.N&&this.N();g.K.prototype.gF.call(this)};
nc.prototype.createAction=function(B,z){var T=g.qq(B.entityKey).entityType,R=g.V6(16);return new IO(T,R,B,z.actionId,z.rootActionId)};
nc.prototype.UE=function(B){var z=this,T,R,h,W,b,l,w,q,c;return g.D(function(L){if(L.U==1){if(z.xd())return L.return();R=(T=B.offlineOrchestrationActionWrapperEntity)!=null?T:new Set;h=[];W=g.d(R);for(b=W.next();!b.done;b=W.next())l=b.value,w=g.qq(l),q=w.entityId,DoP(z.T,q)||h.push(l);return g.P(L,jC5(z,h),2)}c=L.T;return g.P(L,tiK(z,c),0)})};
nc.prototype.retry=function(){var B=this;return g.D(function(z){return g.P(z,Xuq(B),0)})};e0R.prototype.pX=function(B,z){z=z===void 0?!0:z;var T=this,R,h,W,b,l,w,q,c;return g.D(function(L){switch(L.U){case 1:if(!T.T)return L.return();R=[];h=g.h5(T.T.U,z);W=[];for(b={X8:0};b.X8<h.length;b={X8:b.X8},b.X8++)l=h[b.X8],w=T.T.f6(l,"json3"),q=g.$v(w,{withCredentials:!0,format:"RAW"},3,500).then(function(C){return function(r){r={metadata:g.ro(h[C.X8]),trackData:r.xhr.responseText};W.push(r)}}(b)).d2(function(C){hP("Caption fetch error",C)}),R.push(q);
return g.P(L,clq(R),2);case 2:return g.AK(L,3),g.P(L,kSq(B,W),5);case 5:g.yz(L,0);break;case 3:c=g.JK(L),hP("Caption DB transaction error",c),g.dX(L)}})};g.G(uV,g.K);uV.prototype.gF=function(){this.U&&this.U();g.K.prototype.gF.call(this)};
uV.prototype.Y=function(B){var z=this,T,R,h,W,b,l,w,q;return g.D(function(c){R=(T=B.transfer)!=null?T:new Set;h=[];W=g.d(R);for(b=W.next();!b.done;b=W.next())l=b.value,w=g.qq(l),q=w.entityId,h.push(q);return h.length===0?c.return():g.P(c,Sw5(z,h),0)})};g.G(h_W,g.K);g.I=h_W.prototype;g.I.gF=function(){this.WD&&this.WD();this.RK.dispose();this.W.dispose();this.lO&&g.TS(this.X.H3,this.lO);this.zZ&&g.TS(this.X.H3,this.zZ);g.K.prototype.gF.call(this)};
g.I.a4u=function(B){var z=this,T,R,h;return g.D(function(W){switch(W.U){case 1:T=g.iZ(B,"transfer");if(z.T&&T===z.T.key){mn(z.L,z.V,!0);z.W.stop();W.jI(0);break}return g.P(W,e7(z.U,{mode:"readwrite",cB:!0},function(b){return fK(b,T,"transfer").then(function(l){if(l&&l.transferState!=="TRANSFER_STATE_COMPLETE"&&l.transferState!=="TRANSFER_STATE_FAILED")return l.transferState="TRANSFER_STATE_PAUSED_BY_USER",t6(b,l,"transfer").then(function(){return l})})}),3);
case 3:R=W.T;if(!R){W.jI(0);break}if(!B||!z.Y){W.jI(5);break}return g.P(W,Cc(B,z.Y,z.U,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.P(W,Om(z,B),7);case 7:h=W.T,iPK({videoId:B,gI:R,offlineModeType:h}),g.dX(W)}})};
g.I.kYu=function(){var B=this;if(this.T&&this.V){mn(this.L,this.V,!1);var z=this.T,T=(z==null?0:z.key)?g.qq(z.key).entityId:"";T&&this.Y&&(new Promise(function(R,h){Cc(T,B.Y,B.U,"DOWNLOAD_STATE_PAUSED").catch(function(W){h(W)})})).catch(function(R){hP("Download state setting error",R)})}this.W.stop()};
g.I.wZ=function(){this.T?Yqq(this,this.T):fc(this)};
g.I.H9=function(B){var z=this;return g.D(function(T){switch(T.U){case 1:if(!z.T){T.jI(2);break}if(z.T.transferState==="TRANSFER_STATE_COMPLETE"||z.T.transferState==="TRANSFER_STATE_FAILED"||!B.transfer||!B.transfer.has(z.T.key)){T.jI(3);break}return g.P(T,Ei(z.U,z.T.key,"transfer"),4);case 4:z.T=T.T;if(z.T){T.jI(3);break}return g.P(T,lIU(z),3);case 3:if(z.T)return T.return();case 2:return g.P(T,fc(z),0)}})};
g.I.N7=function(B,z){var T=this,R,h,W,b,l;return g.D(function(w){switch(w.U){case 1:if(!T.T){NA(T,"onTransferFailure: "+B);w.jI(2);break}R=T.T;W=((h=R)==null?0:h.key)?g.qq(R.key).entityId:"";a:switch(B){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var q=!1;break a;default:q=!0}return q&&Fhg(T)?g.P(w,tP(T,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.P(w,
IIU(T,B),5);case 5:if(!W||!T.Y){w.jI(2);break}return g.P(w,Cc(W,T.Y,T.U,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.P(w,Om(T,W),9);case 9:b=w.T;wE({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:W,gI:R,offlineModeType:b});if(!W||!T.Y){w.jI(2);break}return g.P(w,Cc(W,T.Y,T.U,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:H9(T),l=fc(T,!0),z&&z(l),g.dX(w)}})};
g.I.qT=function(B){var z=this,T,R,h,W,b,l,w,q,c,L,C,r;return g.D(function(F){switch(F.U){case 1:if(!z.T){NA(z,"onMaybeTransferStreamsExpired");F.jI(2);break}return Fhg(z)?g.P(F,tP(z,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.P(F,IIU(z,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!z.Y){F.jI(2);break}T=z.T;h=((R=T)==null?0:R.key)?g.qq(T.key).entityId:"";if(!h){F.jI(2);break}return g.P(F,Cc(h,z.Y,z.U,"DOWNLOAD_STATE_FAILED"),2);case 9:return z.T||NA(z,"onMaybeTransferStreamsExpiredRetryAttempting"),
W=z.T,l=((b=W)==null?0:b.key)?g.qq(W.key).entityId:"",g.P(F,Om(z,l),10);case 10:return w=F.T,wE({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:l,gI:W,offlineModeType:w}),q=FgU(),g.YZ(q,DC,{isEnqueuedForExpiredStreamUrlRefetch:!0}),c=g.iZ(l,"playbackData"),L={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:c,actionMetadata:q},C=dE(new IO("playbackData",l,L)),g.P(F,si(z.U,C,"offlineOrchestrationActionWrapperEntity"),2);case 2:H9(z),r=fc(z,!0),
B&&B(r),g.dX(F)}})};
var ae5={},GEP=(ae5.TRANSFER_STATE_TRANSFERRING=1,ae5.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,ae5);g.I=ju.prototype;g.I.bA=function(){return this.V.promise};
g.I.Sq=function(){if(this.U&&this.L)return this.V.promise;aI7(this).then(this.V.resolve).catch(this.V.reject);return this.V.promise};
g.I.J4=function(B){var z={};return z.playbackData=new R0g(B,this.dF,this.T),z.transfer=new av7(B,this.dF),z.videoPlaybackPositionEntity=new qws(B,this.dF),z};
g.I.wr=function(){var B=this;return g.D(function(z){return B.U?g.P(z,Wh7(B.U),0):z.jI(0)})};
g.I.eq=function(){var B=this,z,T;return g.D(function(R){if(R.U==1)return B.U||B.L?g.P(R,B.bA(),2):R.return();B.J!==void 0&&(g.dJ(B.J),B.J=void 0);B.W!==void 0&&(g.dJ(B.W),B.W=void 0);(z=B.U)==null||z.dispose();B.U=void 0;(T=B.L)==null||T.dispose();B.L=void 0;B.api.uO("onOrchestrationLostLeader");B.V=new g.CP;g.dX(R)})};
g.I.isOrchestrationLeader=function(){return this.Y.T};
g.I.hE=function(){return g.D(function(B){return B.return(!1)})};
g.I.Um=function(B){var z=this.T;z.api.publish("offlinetransferpause",B);var T;(T=z.U)==null||T.postMessage(B)};
g.I.wZ=function(B){var z,T;return g.D(function(R){if(R.U==1)return g.P(R,B9(),2);z=R.T;if(!z)return R.return();T=g.iZ(B,"transfer");return g.P(R,e7(z,{mode:"readwrite",cB:!0},function(h){var W=fK(h,T,"transfer"),b=fK(h,g.iZ(B,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.VD.all([W,b]).then(function(l){l=g.d(l);var w=l.next().value;var q=l.next().value;return w&&w.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(w.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",t6(h,w,"transfer").then(function(){wE({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:B,gI:w,offlineModeType:q==null?void 0:q.offlineModeType});return g.VD.resolve(null)})):g.VD.resolve(null)})}),0)})};
g.I.Pg=function(B){B=B===void 0?43200:B;var z=this,T,R,h,W,b,l,w,q;return g.D(function(c){if(c.U==1)return z.X.zO()?g.P(c,B9(),2):c.return(UvP());if(c.U!=3){T=c.T;if(!T)return c.return([]);R=Date.now()/1E3;return g.P(c,S7(T,"offlineVideoPolicy"),3)}h=c.T;W=[];b=g.d(h);for(l=b.next();!l.done;l=b.next())w=l.value,Number(w.lastUpdatedTimestampSeconds)+B<=R&&(q=g.qq(w.key).entityId,W.push(q));return W.length?c.return(Xg(z,W,z.N,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):c.return([])})};
g.I.deleteAll=function(){return Xg(this,["!*$_ALL_ENTITIES_!*$"],this.N,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.I.refreshAllStaleEntities=function(B){var z=this;return g.D(function(T){return T.U==1?g.P(T,z.Pg(B),2):T.return(T.T)})};
g.I.setUpPositionSyncInterval=function(B){var z=this;this.W!==void 0&&(g.dJ(this.W),this.W=void 0);var T=B!=null?B:864E5;this.W=g.Ic(function(){z.N2(T)},T)};
g.I.N2=function(B){var z=this,T,R,h,W,b,l;return g.D(function(w){switch(w.U){case 1:return g.AK(w,2),g.P(w,nK.getInstance(),4);case 4:T=w.T;if(!T)throw Error("prefStorage is undefined");return g.P(w,T.get("psi"),5);case 5:R=w.T;W=((h=R)==null?0:h.rS)?Number(R.rS)/1E3:0;b=Date.now();if(!(W+B<=b)){w.jI(6);break}return g.P(w,Xg(z,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.yz(w,0);break;case 2:l=g.JK(w),hP("Offline manager error",l),
g.dX(w)}})};
g.I.Ce=function(){var B=this,z,T,R,h,W,b,l;return g.D(function(w){if(w.U==1)return g.P(w,B9(),2);if(w.U!=3)return(z=w.T)?g.P(w,S7(z,"transfer"),3):w.return([]);T=w.T;R=[];h=g.d(T);for(W=h.next();!W.done;W=h.next())b=W.value,b.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&b.key&&(l=g.qq(b.key).entityId,R.push(l));return w.return(VWW(B,R))})};
g.I.Nu=function(){return g.D(function(B){return B.return([])})};
g.I.Ie=function(){return g.D(function(B){g.dX(B)})};
g.I.UV=function(){return g.D(function(B){g.dX(B)})};g.G(Qmh,P9);Qmh.prototype.U=function(B){return iV(B)?JnK(this,B):c9(B)?$vF(this,B):Lc(B)?PHq(this,B):Promise.reject(Error("Unsupported action type: "+B.actionType))};
var ZC=[10];g.G(KhP,P9);KhP.prototype.U=function(B){return iV(B)?ufh(this,B):c9(B)?H2F(this,B):Lc(B)?fIs(this,B):Promise.reject(Error("Unsupported action type: "+B.actionType))};
var neK=[10];g.G(Nwq,P9);Nwq.prototype.U=function(B){return c9(B)?jm5(this,B):Promise.reject(Error("Unsupported action type: "+B.actionType))};g.G(XiI,ju);g.I=XiI.prototype;g.I.J4=function(B){var z=ju.prototype.J4.call(this,B);z.mainVideoEntity=new KhP(B,this.dF,this.T);z.mainPlaylistEntity=new Qmh(B,this.dF,this.T);z.mainDownloadsListEntity=new Nwq(B,this.dF,this.T);return z};
g.I.refreshAllStaleEntities=function(B,z){var T=this,R,h,W,b,l,w,q,c,L,C,r;return g.D(function(F){switch(F.U){case 1:R=[];if(!T.dF.D("web_player_offline_playlist_auto_refresh")){F.jI(2);break}return g.P(F,Z2p(T,B,z),3);case 3:R=F.T;case 2:return g.P(F,nK.getInstance(),4);case 4:return h=F.T,g.P(F,(W=h)==null?void 0:W.get("sdois"),5);case 5:return b=F.T,g.P(F,(l=h)==null?void 0:l.get("lmqf"),6);case 6:w=F.T;if(!b){F.jI(7);break}c=R;L=c.concat;return g.P(F,e_p(T,b,(q=w)!=null?q:"SD",B===0),8);case 8:R=
L.call(c,F.T);case 7:return C=R,r=C.concat,g.P(F,ju.prototype.refreshAllStaleEntities.call(T,B,z),9);case 9:return R=r.call(C,F.T),F.return(R)}})};
g.I.hE=function(B){var z,T,R,h,W,b,l,w;return g.D(function(q){if(q.U==1)return g.P(q,B9(),2);if(q.U!=3)return(z=q.T)?g.P(q,Ei(z,g.vA,"mainDownloadsListEntity"),3):q.return(!1);T=q.T;if((R=T)==null?0:(h=R.downloads)==null?0:h.length)for(W=g.iZ(B,"mainVideoEntity"),b=g.d(T.downloads),l=b.next();!l.done;l=b.next())if(w=l.value,w.videoItem===W)return q.return(!0);return q.return(!1)})};
g.I.Nu=function(){var B=this,z,T,R,h,W,b,l,w;return g.D(function(q){if(q.U==1)return g.P(q,B9(),2);if(q.U!=3)return(z=q.T)?g.P(q,S7(z,"downloadStatusEntity"),3):q.return([]);T=q.T;R=[];h=g.d(T);for(W=h.next();!W.done;W=h.next())b=W.value,b.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&b.key&&(l=g.qq(b.key).entityId,R.push(l));return R.length?(w={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},q.return(Xg(B,R,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
w))):q.return([])})};
g.I.UV=function(){var B;return g.D(function(z){return z.U==1?g.P(z,B9(),2):(B=z.T)?g.P(z,e7(B,{mode:"readwrite",cB:!0},function(T){return Oi(T,"mainVideoEntity").then(function(R){var h=[];R=g.d(R);for(var W=R.next();!W.done;W=R.next()){W=W.value;var b=void 0;(b=W.userState)!=null&&b.playbackPosition||(b=g.qq(W.key).entityId,b={key:g.iZ(b,"videoPlaybackPositionEntity"),videoId:b,lastPlaybackPositionSeconds:"0"},h.push(t6(T,b,"videoPlaybackPositionEntity")),W.userState={playbackPosition:b.key},h.push(t6(T,
W,"mainVideoEntity")))}return g.VD.all(h)})}),0):z.return()})};
g.I.Ie=function(){var B,z,T,R,h,W,b,l,w,q,c,L,C,r,F,A,a,V,M,x,v,n,Z,N,TP,hK,zP,ld,t,UH,Qz,vb,AI,lW,gX,Vz,hI,U;return g.D(function(Yr){if(Yr.U==1)return g.P(Yr,B9(),2);if(Yr.U!=3){B=Yr.T;if(!B)return Yr.return();z=g.iZ("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.P(Yr,e7(B,{mode:"readonly",cB:!0},function(tI){return g.VD.all([fK(tI,z,"mainDownloadsListEntity"),fK(tI,g.vA,"mainDownloadsListEntity"),Oi(tI,"mainVideoEntity"),Oi(tI,"mainPlaylistEntity")])}),3)}T=Yr.T;
R=g.d(T);h=R.next().value;W=R.next().value;b=R.next().value;l=R.next().value;w=h;q=W;c=b;L=l;C=new Set;if((r=w)==null?0:(F=r.downloads)==null?0:F.length)for(A=g.d(w.downloads),a=A.next();!a.done;a=A.next())V=a.value,M=void 0,(x=(M=V.videoItem)!=null?M:V.playlistItem)&&C.add(x);if((v=q)==null?0:(n=v.downloads)==null?0:n.length)for(Z=g.d(q.downloads),N=Z.next();!N.done;N=Z.next())TP=N.value,TP.videoItem&&C.add(TP.videoItem);hK=new Set;zP=[];ld=g.d(L);for(t=ld.next();!t.done;t=ld.next()){UH=t.value;
if(UH.videos)for(Qz=g.d(UH.videos),vb=Qz.next();!vb.done;vb=Qz.next())AI=vb.value,(lW=JSON.parse(g.qq(AI).entityId).videoId)&&hK.add(lW);UH.key&&!C.has(UH.key)&&zP.push(UH.key)}gX=g.d(c);for(Vz=gX.next();!Vz.done;Vz=gX.next())hI=Vz.value,hI.key&&!C.has(hI.key)&&(U=g.qq(hI.key).entityId,hK.has(U)||zP.push(hI.key));return zP.length?g.P(Yr,p1g(B,zP),0):Yr.jI(0)})};g.G(smW,P9);smW.prototype.U=function(B){return iV(B)?Sqh(this,B):c9(B)?BL7(this,B):Lc(B)?zWF(this,B):Promise.reject(Error("Unsupported action type: "+B.actionType))};
var sm=[10];g.G(RWF,P9);RWF.prototype.U=function(B){return iV(B)?WT5(this,B):c9(B)?bEF(this,B):Lc(B)?YEq(this,B):Promise.reject(Error("Unsupported action type: "+B.actionType))};
var Em=[10];g.G(qEW,P9);qEW.prototype.U=function(B){return iV(B)?C7h(this,B):c9(B)?rr7(this,B):Lc(B)?o0I(this,B):Promise.reject(Error("Unsupported action type: "+B.actionType))};
var LTU=[10];g.G(Su,ju);Su.prototype.J4=function(B){var z=ju.prototype.J4.call(this,B);z.musicTrack=new qEW(B,this.T);z.musicPlaylist=new RWF(B,this.T);z.musicAlbumRelease=new smW(B,this.T);return z};
Su.prototype.refreshAllStaleEntities=function(B,z){var T=this,R,h,W;return g.D(function(b){if(b.U==1)return g.P(b,Iep(T,B,z),2);if(b.U!=3)return h=R=b.T,W=h.concat,g.P(b,ju.prototype.refreshAllStaleEntities.call(T,B,z),3);R=W.call(h,b.T);return b.return(R)})};g.G(Gqh,g.I$);g.I=Gqh.prototype;g.I.create=function(){var B=this;g.m(this,this.events);if(g.Zf(this.dF))this.T=new XiI(this.dF,this.player);else if(g.f0(this.dF)||g.Sg(this.dF)==="WEB_MUSIC_INTEGRATIONS")this.T=new Su(this.dF,this.player);this.events.Z(this.player,"onPlaybackStartExternal",function(){B.Ww()});
this.events.Z(this.player,"videodatachange",function(){B.Ww()});
this.dF.D("html5_offline_playback_position_sync")&&this.events.Z(this.player,"presentingplayerstatechange",this.pH)};
g.I.g_=function(){return!1};
g.I.OS=function(B,z,T,R){var h=this;return g.D(function(W){return h.T?W.return(Xg(h.T,B,z,T,R)):W.return(Promise.reject())})};
g.I.deleteAll=function(){return this.T.deleteAll()};
g.I.Pg=function(B){return this.T.Pg(B)};
g.I.refreshAllStaleEntities=function(B){return this.T.refreshAllStaleEntities(B)};
g.I.setUpPositionSyncInterval=function(B){this.T.setUpPositionSyncInterval(B)};
g.I.Um=function(B){this.T.Um(B)};
g.I.wZ=function(B){return this.T.wZ(B)};
g.I.Ww=function(){var B=this,z;return g.D(function(T){z=B.player.getVideoData();return g.Np(z)?dGs(z)&&B.U!==z.clientPlaybackNonce?g.P(T,ArU(B,z),0):T.jI(0):T.return()})};
g.I.pH=function(B){var z=this,T,R,h,W,b,l,w;return g.D(function(q){if(q.U==1)return T=z.player.getVideoData(),R=T.s0,g.dK(B,2)||g.dK(B,512)?g.P(q,B9(),2):q.return();if(q.U!=3){h=q.T;if(!h)return hP("PES is undefined"),q.return();W=T.videoId;return g.P(q,Ei(h,g.iZ(W,"mainVideoEntity"),"mainVideoEntity"),3)}b=q.T;if(!b)return q.return();l=Math.floor(R).toString();w={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:l}};return g.P(q,z.OS([W],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
w),0)})};
g.I.isOrchestrationLeader=function(){return this.T.isOrchestrationLeader()};
g.I.updateDownloadState=function(B,z){var T,R,h,W;return g.D(function(b){if(b.U==1)return g.P(b,B9(),2);T=b.T;if(!T)return hP("PES is undefined"),b.return();R=g.qq(B);h=R.entityType;W=R.entityId;return g.P(b,Cc(W,h,T,z,!0),0)})};g.Fj("offline",Gqh);})(_yt_player);
